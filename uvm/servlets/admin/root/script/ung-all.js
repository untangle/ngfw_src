Ext.define("Ung.rpc.Rpc",{alternateClassName:"Rpc",singleton:!0,getDashboardSettings:function(){console.time("dashboardSettings");var e=new Ext.Deferred;return this.rpc.dashboardManager.getSettings(function(t,n){console.timeEnd("dashboardSettings"),n&&e.reject(n),e.resolve(t)}),e.promise},getReports:function(){console.time("loadReports");var e=new Ext.Deferred;return this.rpc.nodeManager.node("untangle-node-reports")?(this.rpc.reportsManager=this.rpc.nodeManager.node("untangle-node-reports").getReportsManager(),this.rpc.reportsManager.getReportEntries(function(t,n){console.timeEnd("loadReports"),n&&e.reject(n),e.resolve(t)})):e.resolve(null),e.promise},getUnavailableApps:function(){console.time("unavailApps");var e=new Ext.Deferred;return rpc.reportsManager?rpc.reportsManager.getUnavailableApplicationsMap(function(t,n){console.timeEnd("unavailApps"),n&&e.reject(n),e.resolve(t)}):e.resolve(null),e.promise},getReportData:function(e,t){var n=new Ext.Deferred;return this.rpc.reportsManager.getDataForReportEntry(function(e,t){t&&n.reject(t),n.resolve(e)},e,t,-1),n.promise},getRpcNode:function(e){var t=new Ext.Deferred;return this.rpc.nodeManager.node(function(e,n){n&&t.reject(n),t.resolve(e)},e),t.promise},getNodeSettings:function(e){var t=new Ext.Deferred;return e.getSettings(function(e,n){n&&t.reject(n),t.resolve(e)}),t.promise},setNodeSettings:function(e,t){console.log(t);var n=new Ext.Deferred;return e.setSettings(function(e,t){console.log(e),t&&n.reject(t),n.resolve(e)},t),n.promise},readRecords:function(){return console.log("read"),{}}}),Ext.define("Ung.util.Util",{alternateClassName:"Ung.Util",singleton:!0,nodeClassMapping:{"untangle-node-web-filter":"Ung.node.WebFilter","untangle-node-web-filter-lite":"Ung.node.WebFilterLite","untangle-node-virus-blocker":"Ung.node.VirusBlocker","untangle-node-virus-blocker-lite":"Ung.node.VirusBlockerLite","untangle-node-spam-blocker":"Ung.node.SpamBlocker","untangle-node-spam-blocker-lite":"Ung.node.SpamBlockerLite","untangle-node-phish-blocker":"Ung.node.PhishBlocker","untangle-node-web-cache":"Ung.node.WebCache","untangle-node-bandwidth-control":"Ung.node.BandwidthControl","untangle-casing-ssl-inspector":"Ung.node.SslInspector","untangle-node-application-control":"Ung.node.ApplicationControl","untangle-node-application-control-lite":"Ung.node.ApplicationControlLite","untangle-node-captive-portal":"Ung.node.CaptivePortal","untangle-node-firewall":"Ung.node.Firewall","untangle-node-ad-blocker":"Ung.node.AdBlocker","untangle-node-reports":"Ung.node.Reports"},iconTitle:function(e,t){var n=t.split("-")[0],i=t.split("-")[1]||24;return'<i class="material-icons" style="font-size: '+i+'px">'+n+'</i> <span style="vertical-align: middle;">'+e+"</span>"},iconReportTitle:function(e){var t;switch(e.get("type")){case"TEXT":t="subject";break;case"EVENT_LIST":t="format_list_bulleted";break;case"PIE_GRAPH":t="pie_chart","COLUMN"===e.get("pieStyle")||"COLUMN_3D"===e.get("pieStyle")?t="insert_chart":"DONUT"!==e.get("pieStyle")&&"DONUT_3D"!==e.get("pieStyle")||(t="donut_large");break;case"TIME_GRAPH":case"TIME_GRAPH_DYNAMIC":t=e.get("timeStyle").indexOf("BAR")>=0?"insert_chart":"show_chart";break;default:t="subject"}return'<i class="material-icons" style="font-size: 18px">'+t+"</i>"},bytesToHumanReadable:function(e,t){var n=t?1e3:1024;if(Math.abs(e)<n)return e+" B";var i=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],a=-1;do e/=n,++a;while(Math.abs(e)>=n&&a<i.length-1);return e.toFixed(1)+" "+i[a]},formatBytes:function(e,t){if(0===e)return"0";var n=1e3,i=t||3,a=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(i))+" "+a[o]},successToast:function(e){Ext.toast({html:this.iconTitle(e,"check-20"),bodyPadding:"8 10",baseCls:"toast",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:30,paddingY:50})},exceptionToast:function(e){Ext.toast({html:this.iconTitle('<span style="color: #FFF; font-weight: bold;">Exception!</span> '+e,"error-20"),bodyPadding:"10",baseCls:"toast",cls:"exception",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:30,paddingY:50})},urlValidator:function(e){var t=e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g);return!!t||"Url missing or in wrong format!".t()},getClassOrder:function(){var e=[],t=[];Ext.Loader.history.forEach(function(n){0===n.indexOf("Ung")?e.push(n.replace("Ung","app").replace(/\./g,"/")+".js"):t.push(n)}),e.pop(),Ext.create("Ext.Window",{title:"Untangle Classes Load Order",width:600,height:600,modal:!0,draggable:!1,resizable:!1,layout:{type:"hbox",align:"stretch",pack:"end"},items:[{xtype:"textarea",border:!1,flex:1,editable:!1,fieldStyle:{background:"#FFF",fontSize:"11px"},value:e.join("\r\n")},{xtype:"textarea",border:!1,flex:1,editable:!1,fieldStyle:{background:"#FFF",fontSize:"11px"},value:t.join("\r\n")}]}).show()}}),Ext.define("Ung.util.Metrics",{singleton:!0,frequency:3e3,interval:null,running:!1,start:function(){var e=this;e.stop(),e.run(),e.interval=window.setInterval(function(){e.run()},e.frequency)},stop:function(){null!==this.interval&&window.clearInterval(this.interval)},run:function(){var e=[];rpc.metricManager.getMetricsAndStats(Ext.bind(function(t,n){n&&console.log(n),e=[],Ext.getStore("stats").loadRawData(t.systemStats);for(var i in t.metrics)t.metrics.hasOwnProperty(i)&&e.push({nodeId:i,metrics:t.metrics[i]});Ext.getStore("metrics").loadData(e)}))}}),Ext.define("Ung.overrides.form.field.VTypes",{override:"Ext.form.field.VTypes",validators:function(){},ipall:function(e){if(e.indexOf("/")===-1&&e.indexOf(",")===-1&&e.indexOf("-")===-1)switch(e){case"any":return!0;default:return this.ip4(e)}return e.indexOf(",")!==-1?this.ipList(e):e.indexOf("-")!==-1?this.ipRange(e):e.indexOf("/")!==-1?this.cidrRange(e)||this.ipNetmask(e):(console.log("Unhandled case while handling vtype for ipAddr:",e," returning true!"),!0)},ipallText:"Invalid IP Address.".t(),ip:function(e){return this.ip4Re.test(e)||this.ip6Re.test(e)},ipText:"Invalid IP Address.".t(),ip4:function(e){return this.ip4Re.test(e)},ip4Re:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ip4Text:"Invalid IPv4 Address.".t(),ip6:function(e){return this.ip6Re.test(e)},ip6Re:"/^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$/",ip6Text:"Invalid IPv6 Address.".t(),ip4List:function(e){var t,n=e.split(",");for(t=0;t<n.length;t++)if(!this.ip4Re.test(n[t]))return!1;return!0},ip4ListText:"Invalid IPv4 Address(es).".t(),mac:function(e){return this.macRe.test(e)},macRe:/^[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}$/,macText:"Invalid Mac Address.".t(),cidr:function(e){return this.cidrRe.test(e)},cidrRe:/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\/\d{1,2}$/,cidrText:"Must be a network in CIDR format.".t()+" (192.168.123.0/24)",cidrList:function(e){var t,n=e.split(",");for(t=0;t<n.length;t++)if(!this.cidrRe.test(n[t]))return!1;return!0},cidrListText:"Must be a comma seperated list of networks in CIDR format.".t()+" (192.168.123.0/24,1.2.3.4/24)",cidrBlock:function(e){var t,n=e.split("\n");for(t=0;t<n.length;t++)if(!this.cidrRe.test(n[t]))return!1;return!0},cidrBlockText:"Must be a one-per-line list of networks in CIDR format.".t()+" (192.168.123.0/24)",port:function(e){var t=1,n=65535;return e>=t&&e<=n},portText:Ext.String.format("The port must be an integer number between {0} and {1} or one of the following values: any, all, n/a, none.".t(),1,65535),ipRange:function(e){return this.ipRangeRe.test(e)},ipRangeRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipRangeText:"Invalid IP range".t(),cidrRange:function(e){return this.cidrRangeRe.test(e)},cidrRangeRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/[0-3]?[0-9]$/,ipNetmask:function(e){return this.cidrRangeRe.test(e)},ipNetmaskRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipList:function(e){for(var t=e.split(","),n=!0,i=0;i<t.length;i++)if(n=t[i].indexOf("-")!==-1?n&&this.ipRange(t[i]):t[i].indexOf("/")!==-1?n&&(this.cidRange(t[i])||this.ipNetmask(t[i])):n&&this.ip4(t[i]),!n)return!1;return!0}}),Ext.define("Ung.view.main.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",control:{"#":{beforerender:"onBeforeRender"}},init:function(e){var t=e.getViewModel();t.set("reports",Ext.getStore("reports")),t.set("policyId",1)},routes:{"":"onDashboard",apps:"onApps","apps/:policyId":"onApps","apps/:policyId/:node":"onApps",config:"onConfig","config/:configName":"onConfig",reports:"onReports",sessions:"onSessions",hosts:"onHosts",devices:"onDevices"},onBeforeRender:function(e){var t=e.getViewModel();t.bind("{reportsEnabled}",function(t){t?e.down("#main").insert(3,{xtype:"ung.reports",itemId:"reports"}):e.down("#main").remove("reports")}),t.set("reportsInstalled",null!==rpc.nodeManager.node("untangle-node-reports")),rpc.nodeManager.node("untangle-node-reports")&&t.set("reportsRunning","RUNNING"===rpc.nodeManager.node("untangle-node-reports").getRunState()),t.notify(),e.getViewModel().set("policies",Ext.getStore("policies")),e.getViewModel().set("policy",Ext.getStore("policies").findRecord("policyId",1))},afterRender:function(){this.redirectTo(Ext.util.History.getHash(),!0)},onDashboard:function(){console.log("on dashboard"),this.getViewModel().set("activeItem","dashboard")},onApps:function(e,t){console.log("on apps");var n=this.getViewModel();n.get("policyId");n.set("policyId",e),t?"install"===t?n.set("activeItem","appsinstall"):(n.set("nodeName",t),n.set("activeItem","settings")):n.set("activeItem","apps",!0)},onConfig:function(e){e?(console.log("conf settings"),this.getViewModel().set("activeItem","configsettings")):this.getViewModel().set("activeItem","config")},onReports:function(){this.getViewModel().set("activeItem","reports")},onSessions:function(){this.setShd("sessions")},onHosts:function(){this.setShd("hosts")},onDevices:function(){this.setShd("devices")},setShd:function(e){this.getViewModel().set("activeItem","shd"),this.getViewModel().set("shdActiveItem",e),this.getView().down("#shdcenter").setActiveItem(e)}}),Ext.define("Ung.view.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{reportsInstalled:!1,reportsRunning:!1},formulas:{reportsEnabled:function(e){return e("reportsInstalled")&&e("reportsRunning")},isDashboard:function(e){return"dashboard"===e("activeItem")},isApps:function(e){return"apps"===e("activeItem")},isConfig:function(e){return"config"===e("activeItem")},isReports:function(e){return"reports"===e("activeItem")},isSessions:function(e){return"sessions"===e("shdActiveItem")},isHosts:function(e){return"hosts"===e("shdActiveItem")},isDevices:function(e){return"devices"===e("shdActiveItem")}}}),Ext.define("Ung.view.shd.Devices",{extend:"Ext.panel.Panel",xtype:"ung.devices",requires:[],viewModel:{data:{autoRefresh:!1}},layout:"border",defaults:{border:!1},title:"Devices".t(),items:[{region:"center",html:"devices"}]}),Ext.define("Ung.view.dashboard.DashboardController",{extend:"Ext.app.ViewController",alias:"controller.dashboard",control:{"#":{afterrender:"loadWidgets"}},listen:{global:{nodeinstall:"onNodeInstall",removewidget:"onRemoveWidget",addwidget:"onAddWidget",reportsInstall:"loadWidgets"},store:{"#stats":{datachanged:"onStatsUpdate"}}},init:function(e){var t=e.getViewModel();t.set("managerOpen",!1)},initDashboard:function(){var e=this;e.getViewModel()},loadWidgets:function(){var e,t,n,i=this.getViewModel(),a=this.getView().lookupReference("dashboard"),o=Ext.getStore("widgets").getRange();for(this.getView().lookupReference("dashboardNav").getView().refresh(),a.removeAll(!0),e=0;e<o.length;e+=1)t=o[e],"ReportEntry"!==t.get("type")?a.add({xtype:t.get("type").toLowerCase()+"widget",itemId:t.get("type"),viewModel:{data:{widget:t}}}):i.get("reportsEnabled")?(n=Ext.getStore("reports").findRecord("uniqueId",t.get("entryId")),n&&!Ext.getStore("unavailableApps").first().get(n.get("category"))&&t.get("enabled")?a.add({xtype:"reportwidget",itemId:t.get("entryId"),refreshIntervalSec:t.get("refreshIntervalSec"),viewModel:{data:{widget:t,entry:n}}}):a.add({xtype:"component",itemId:t.get("entryId"),hidden:!0})):a.add({xtype:"component",itemId:t.get("entryId"),hidden:!0});console.timeEnd("all")},onNodeInstall:function(e,t){this.getView().lookupReference("dashboardNav").getView().refresh();var n,i,a,o=this.getView().lookupReference("dashboard"),r=Ext.getStore("widgets").getRange();for(a=0;a<r.length;a+=1)n=r[a],i=Ext.getStore("reports").findRecord("uniqueId",n.get("entryId")),i&&i.get("category")===t.displayName&&(o.remove(n.get("entryId")),"install"===e?o.insert(a,{xtype:"reportwidget",itemId:n.get("entryId"),refreshIntervalSec:n.get("refreshIntervalSec"),viewModel:{data:{widget:n,entry:i}}}):o.insert(a,{xtype:"component",itemId:n.get("entryId"),hidden:!0}))},enableRenderer:function(e,t,n){var i=this.getViewModel();if("ReportEntry"!==n.get("type"))return'<i class="material-icons">'+(e?"check_box":"check_box_outline_blank")+"</i>";var a=Ext.getStore("reports").findRecord("uniqueId",n.get("entryId"));return a&&!Ext.getStore("unavailableApps").first().get(a.get("category"))&&i.get("reportsRunning")?'<i class="material-icons">'+(e?"check_box":"check_box_outline_blank")+"</i>":'<i class="material-icons" style="color: #F00;">info_outline</i>'},settingsRenderer:function(){},widgetTitleRenderer:function(e,t,n){var i,a,o,r,s=this.getViewModel();return r=n.get("enabled"),e?s.get("reportsInstalled")?(i=Ext.getStore("reports").findRecord("uniqueId",e),i?(o=Ext.getStore("unavailableApps").first().get(i.get("category")),a='<span style="font-weight: 600; '+(o||!r?"color: #999;":"")+'">'+(i.get("readOnly")?i.get("title").t():i.get("title"))+"</span>",i.get("timeDataInterval")&&"AUTO"!==i.get("timeDataInterval")&&(a+='<span style="text-transform: lowercase; color: #333; font-weight: 300;"> per '+i.get("timeDataInterval")+"</span>"),a+=o?'<br/><span style="font-size: 10px; color: #AAA;">'+i.get("category")+"</span>":'<br/><span style="font-size: 10px; color: #AAA;">'+i.get("category")+"</span>"):"Some "+"Widget".t()):'<span style="color: #999; line-height: 26px;">'+"App Widget".t()+"</span>":'<span style="font-weight: 600; '+(r?"":"color: #999;")+'">'+n.get("type")+'</span><br/><span style="font-size: 10px; color: #AAA;">Common</span>'},applyChanges:function(){console.log("apply"),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),rpc.dashboardManager.setSettings(function(e,t){return t?void Ung.Util.exceptionToast(t):(Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">Dashboard Saved!</span>'),void Ext.getStore("widgets").sync())},Ung.dashboardSettings)},managerHandler:function(){var e=this.getViewModel().get("managerOpen");this.getViewModel().set("managerOpen",!e)},onItemClick:function(e,t,n,i,a,o){var r,s,l=this,d=l.getView().lookupReference("dashboard"),c=this.getViewModel();if(1===n)if("ReportEntry"!==i.get("type"))i.set("enabled",!i.get("enabled"));else{if(!c.get("reportsInstalled"))return void Ext.Msg.alert("Install required".t(),"To enable App Widgets please install Reports first!".t());if(!c.get("reportsRunning"))return void Ext.Msg.alert("Reports".t(),"To view App Widgets enable the Reports App first!".t());r=Ext.getStore("reports").findRecord("uniqueId",i.get("entryId")),s=d.down("#"+i.get("entryId")),r&&s?Ext.getStore("unavailableApps").first().get(r.get("category"))?Ext.Msg.alert("Install required".t(),Ext.String.format("To enable this Widget please install <strong>{0}</strong> app first!".t(),r.get("category"))):(s.destroy(),i.get("enabled")?d.insert(o,{xtype:"component",itemId:i.get("entryId"),hidden:!0}):(d.insert(o,{xtype:"reportwidget",itemId:i.get("entryId"),refreshIntervalSec:i.get("refreshIntervalSec"),viewModel:{data:{widget:i,entry:r}}}),s=d.down("#"+i.get("entryId")),setTimeout(function(){d.scrollTo(0,d.getEl().getScrollTop()+s.getEl().getY()-121,{duration:300})},100)),i.set("enabled",!i.get("enabled"))):Ung.Util.exceptionToast("This entry is not available and it should be removed!")}2===n&&(s=d.down("#"+i.get("entryId"))||d.down("#"+i.get("type")),s&&!s.isHidden()&&(d.addCls("highlight"),s.addCls("highlight-item"),d.scrollTo(0,d.getEl().getScrollTop()+s.getEl().getY()-121,{duration:500})))},removeWidget:function(e,t,n,i,a,o){o.drop()},onItemLeave:function(e,t){this.tout&&window.clearTimeout(this.tout);var n,i=this.getView().lookupReference("dashboard");n="ReportEntry"!==t.get("type")?i.down("#"+t.get("type")):i.down("#"+t.get("entryId")),n&&(i.removeCls("highlight"),n.removeCls("highlight-item"))},onDrop:function(e,t,n,i){var a=this.getView().lookupReference("dashboard"),o=this.getView().down("#"+t.records[0].get("entryId"))||this.getView().down("#"+t.records[0].get("type")),r=this.getView().down("#"+n.get("entryId"))||this.getView().down("#"+n.get("type"));"before"===i?a.moveBefore(o,r):a.moveAfter(o,r)},resetDashboard:function(){var e=this,t=this.getViewModel();Ext.MessageBox.confirm("Warning".t(),"This will overwrite the current dashboard settings with the defaults.".t()+"<br/><br/>"+"Do you want to continue?".t(),function(n){"yes"===n&&rpc.dashboardManager.resetSettingsToDefault(function(n,i){return i?void Ung.Util.exceptionToast(i):(Ung.Util.successToast("Dashboard reset done!"),void Rpc.getDashboardSettings().then(function(n){Ung.dashboardSettings=n,t.get("reportsInstalled")?rpc.reportsManager.getUnavailableApplicationsMap(function(t,i){return i?(Ung.Util.exceptionToast(i),!1):(Ext.getStore("unavailableApps").loadRawData(t.map),Ext.getStore("widgets").loadData(n.widgets.list),void e.loadWidgets())}):(Ext.getStore("widgets").loadData(n.widgets.list),e.loadWidgets()),e.populateMenus()}))})})},onRemoveWidget:function(e){var t=this.getView().lookupReference("dashboard");t.down("#"+e)&&t.remove(e)},onAddWidget:function(e,t){var n=this.getView().lookupReference("dashboard");t?n.add({xtype:"reportwidget",itemId:e.get("entryId"),refreshIntervalSec:e.get("refreshIntervalSec"),viewModel:{data:{widget:e,entry:t}}}):(console.log(e),n.add({xtype:e.get("type").toLowerCase()+"widget",itemId:e.get("type"),viewModel:{data:{widget:e}}}))},onStatsUpdate:function(){var e=this.getViewModel();e.set("stats",Ext.getStore("stats").first()),rpc.deviceTable.getDevices(function(t,n){return n?(Ung.Util.exceptionToast(n),!1):void e.set("deviceCount",t.list.length)})},populateMenus:function(){var e,t=this.getView().down("#addWidgetBtn"),n=[],i=[];t.getMenu()&&t.getMenu().remove(),n.push({text:"Common",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png",iconCls:"menu-icon",menu:{plain:!0,items:[{text:"Information",type:"Information"},{text:"Resources",type:"Resources"},{text:"CPU Load",type:"CPULoad"},{text:"Network Information",type:"NetworkInformation"},{text:"Network Layout",type:"NetworkLayout"},{text:"Map Distribution",type:"MapDistribution"}],listeners:{click:function(e,t){if(Ext.getStore("widgets").findRecord("type",t.type))return void Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.text+"</span> is already in Dashboard!");var n=Ext.create("Ung.model.Widget",{displayColumns:null,enabled:!0,entryId:null,javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:0,timeframe:null,type:t.type});Ext.getStore("widgets").add(n),Ext.GlobalEvents.fireEvent("addwidget",n,null)}}}}),rpc.reportsManager?rpc.reportsManager.getCurrentApplications(function(a,o){e=[{displayName:"Hosts",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png"},{displayName:"Devices",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_devices.png"},{displayName:"Network",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_network.png"},{displayName:"Administration",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_admin.png"},{displayName:"System",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_system.png"},{displayName:"Shield",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/untangle-node-shield_17x17.png"}],a.list.forEach(function(t){e.push({displayName:t.displayName,icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/"+t.name+"_17x17.png"})}),e.forEach(function(e){i=[],Ext.getStore("reports").filter({property:"category",value:e.displayName,exactMatch:!0}),Ext.getStore("reports").getRange().forEach(function(e){i.push({text:Ung.Util.iconReportTitle(e)+" "+e.get("title"),report:e})}),Ext.getStore("reports").clearFilter(),n.push({text:e.displayName,icon:e.icon,iconCls:"menu-icon",menu:{plain:!0,items:i,listeners:{click:function(e,t){if(Ext.getStore("widgets").findRecord("entryId",t.report.get("uniqueId")))return void Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.report.get("title")+"</span> is already in Dashboard!");var n=Ext.create("Ung.model.Widget",{displayColumns:t.report.get("displayColumns"),enabled:!0,entryId:t.report.get("uniqueId"),javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:60,timeframe:3600,type:"ReportEntry"});Ext.getStore("widgets").add(n),Ext.GlobalEvents.fireEvent("addwidget",n,t.report)}}}})}),t.setMenu({items:n,mouseLeaveDelay:0})}):t.setMenu({items:n,mouseLeaveDelay:0})}}),Ext.define("Ung.view.dashboard.Queue",{alternateClassName:"DashboardQueue",singleton:!0,processing:!1,paused:!1,queue:[],queueMap:{},tout:null,add:function(e){this.queueMap[e.id]||(this.queue.push(e),this.process())},addFirst:function(e){this.queueMap[e.id]||(this.queue.unshift(e),this.process())},next:function(){this.processing=!1,this.process()},remove:function(e){console.log("removing"),this.processing&&(this.processing=!1)},process:function(){var e=this;if(clearTimeout(this.tout),this.tout=setTimeout(function(){e.processing=!1,e.queue=[]},3e3),!this.paused&&!this.processing&&this.queue.length>0){this.processing=!0;var t=this.queue.shift();delete this.queueMap[t.id],t.isHidden()?(t.toQueue=!0,Ung.view.dashboard.Queue.next()):t.fetchData()}},reset:function(){this.queue=[],this.queueMap={},this.processing=!1},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.process()},inView:function(e){if(!e.getEl())return!1;var t=e.getEl().dom.getBoundingClientRect();return t.top+t.height/2>0&&t.height/2+t.top<window.innerHeight}}),Ext.define("Ung.view.grid.ActionColumn",{extend:"Ext.grid.column.Action",xtype:"ung.actioncolumn",defaultRenderer:function(e,t,n,i,a,o,r){var s,l,d,c,p,g,u,m,h,f,y,b,x,v=this,w=v.origScope||v,C=v.items,T=C.length;for(d=Ext.isFunction(v.origRenderer)?v.origRenderer.apply(w,arguments)||"":"",t.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell",s=0;s<T;s++)l=C[s],u=l.icon,m=l.glyph,b=l.materialIcon,x=l.materialIconColor,c=l.disabled||!!l.isDisabled&&Ext.callback(l.isDisabled,l.scope||v.origScope,[r,i,a,l,n],0,v),p=l.tooltip||(l.getTip?Ext.callback(l.getTip,l.scope||v.origScope,arguments,0,v):null),g=l.getAltText?Ext.callback(l.getAltText,l.scope||v.origScope,arguments,0,v):l.altText||v.altText,y=l.dragEnabled,l.hasActionConfiguration||(l.stopSelection=v.stopSelection,l.disable=Ext.Function.bind(v.disableAction,v,[s],0),l.enable=Ext.Function.bind(v.enableAction,v,[s],0),l.hasActionConfiguration=!0),m&&(m=Ext.Glyph.fly(m)),h=l!==v&&void 0!==l.tabIndex?l.tabIndex:v.itemTabIndex,f=l!==v&&void 0!==l.ariaRole?l.ariaRole:v.itemAriaRole,d+=b?'<i style="font-size: 18px; '+(x?"color: "+x+";":"")+'"'+("number"==typeof h?' tabIndex="'+h+'"':"")+(f?' role="'+f+'"':' role="presentation"')+' class="material-icons '+v.actionIconCls+" "+Ext.baseCSSPrefix+"action-col-"+String(s)+" "+(c?v.disabledCls+" ":" ")+(l.hidden?Ext.baseCSSPrefix+"hidden-display ":"")+(y?" draggable":" ")+(l.getClass?Ext.callback(l.getClass,l.scope||v.origScope,arguments,void 0,v):l.iconCls||v.iconCls||"")+'"'+(p?' data-qtip="'+p+'"':"")+">"+b+"</i>":"<"+(u?"img":"div")+("number"==typeof h?' tabIndex="'+h+'"':"")+(f?' role="'+f+'"':' role="presentation"')+(u?' alt="'+g+'" src="'+l.icon+'"':"")+' class="'+v.actionIconCls+" "+Ext.baseCSSPrefix+"action-col-"+String(s)+" "+(c?v.disabledCls+" ":" ")+(l.hidden?Ext.baseCSSPrefix+"hidden-display ":"")+(l.getClass?Ext.callback(l.getClass,l.scope||v.origScope,arguments,void 0,v):l.iconCls||v.iconCls||"")+'"'+(p?' data-qtip="'+p+'"':"")+(u?"/>":m?' style="font-family:'+m.fontFamily+'">'+m.character+"</div>":"></div>");return d}}),Ext.define("Ung.widget.WidgetController",{extend:"Ext.app.ViewController",alias:"controller.widget",control:{"#":{afterrender:"onAfterRender",afterdata:"onAfterData",beforedestroy:"onBeforeRemove"},"#header":{render:"headerRender"}},listen:{},headerRender:function(e){var t=this;e.getEl().on({click:function(e){"refresh"===e.target.dataset.action&&t.addToQueue()}})},init:function(e){var t,n=e.getViewModel();n.get("entry")&&(t=n.get("entry.type"),"TIME_GRAPH"!==t&&"TIME_GRAPH_DYNAMIC"!==t||e.add({xtype:"timechart",reference:"chart",height:250}),"PIE_GRAPH"===t&&e.add({xtype:"piechart",reference:"chart",height:250}),"EVENT_LIST"===t&&e.add({xtype:"component",html:"Not Implemented",height:250}))},onAfterRender:function(e){setTimeout(function(){e.removeCls("adding")},100),e.getViewModel().bind("{widget.enabled}",function(t){t&&Ext.isFunction(e.fetchData)&&Ung.view.dashboard.Queue.add(e)}),e.getViewModel().notify()},onAfterData:function(){var e=this.getView();Ung.view.dashboard.Queue.next(),e.refreshIntervalSec&&e.refreshIntervalSec>0&&(e.refreshTimeoutId=setTimeout(function(){Ung.view.dashboard.Queue.add(e)},1e3*e.refreshIntervalSec))},onBeforeRemove:function(e){Ung.view.dashboard.Queue.remove(e)},onShow:function(e){console.log("onShow"),e.removeCls("adding")},addToQueue:function(){console.log("fetch data");var e=this.getView();e.refreshTimeoutId&&clearTimeout(e.refreshTimeoutId),Ung.view.dashboard.Queue.addFirst(e)},resizeWidget:function(){var e=this.getView();e.hasCls("small")?e.removeCls("small").addCls("medium"):e.hasCls("medium")?e.removeCls("medium").addCls("large"):e.hasCls("large")?e.removeCls("large").addCls("x-large"):e.hasCls("x-large")&&e.removeCls("x-large").addCls("small"),e.updateLayout()}}),Ext.define("Ung.widget.Information",{extend:"Ext.container.Container",alias:"widget.informationwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget small info-widget adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"Information".t()+"</h1>"},{xtype:"component",cls:"info-host",padding:5,bind:{html:'<p class="hostname">{stats.hostname}</p><p class="version">{stats.version}</p>'}},{xtype:"component",margin:"10 0",bind:{html:'<span class="info-lbl">'+"uptime".t()+':</span><span class="info-val">{stats.uptimeFormatted}</span><br/><span class="info-lbl">'+"Server".t()+':</span><span class="info-val">{stats.appliance}</span><br/><span class="info-lbl">'+"CPU Count".t()+':</span><span class="info-val">{stats.numCpus}</span><br/><span class="info-lbl">'+"CPU Type".t()+':</span><span class="info-val">{stats.cpuModel}</span><br/><span class="info-lbl">'+"Architecture".t()+':</span><span class="info-val">{stats.architecture}</span><br/><span class="info-lbl">'+"Memory".t()+':</span><span class="info-val">{stats.totalMemory}</span><br/><span class="info-lbl">'+"Disk".t()+':</span><span class="info-val">{stats.totalDisk}</span>'}}]}),Ext.define("Ung.widget.Resources",{extend:"Ext.container.Container",alias:"widget.resourceswidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget",cls:"small adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"Resources".t()+"</h1>"},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Memory".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeMemoryPercent}%;"></div><p>{stats.totalMemory}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedMemoryPercent}%</strong> used<br/><span>{stats.usedMemory}</span></div><div class="load-free">free <strong>{stats.freeMemoryPercent}%</strong><br/><span>{stats.freeMemory}</span></div></div></div>'}},{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Swap".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeSwapPercent}%;"></div><p>{stats.totalSwap}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedSwapPercent}%</strong> used<br/><span>{stats.usedSwap}</span></div><div class="load-free">free <strong>{stats.freeSwapPercent}%</strong><br/><span>{stats.freeSwap}</span></div></div></div>'}},{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Disk".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeDiskPercent}%;"></div><p>{stats.totalDisk}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedDiskPercent}%</strong> used<br/><span>{stats.usedDisk}</span></div><div class="load-free">free <strong>{stats.freeDiskPercent}%</strong><br/><span>{stats.freeDisk}</span></div></div></div>'}}]}]}),Ext.define("Ung.widget.NetworkInformation",{extend:"Ext.container.Container",alias:"widget.networkinformationwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget small adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},viewModel:!0,refreshIntervalSec:3,items:[{xtype:"component",cls:"header",itemId:"header",html:"<h1>"+"Network Information".t()+'</h1><button class="action-btn"><i class="material-icons" data-action="refresh">refresh</i></button>'},{xtype:"container",items:[{xtype:"component",bind:{html:'<div class="info-box" style="border-bottom: 1px #EEE solid;"><div class="info-item">'+"Currently Active".t()+'<br/><span>{stats.activeHosts}</span></div><div class="info-item">'+"Maximum Active".t()+'<br/><span>{stats.maxActiveHosts}</span></div><div class="info-item">'+"Known Devices".t()+'<br/><span>{stats.knownDevices}</span></div><div class="info-actions"><a class="wg-button" href="#hosts" style="flex: 1;">'+"Hosts".t()+'</a><a class="wg-button" href="#devices" style="flex: 1;">'+"Devices".t()+"</a></div></div>"
}},{xtype:"component",bind:{html:'<div class="info-box"><div class="info-item">'+"Total Sessions".t()+'<br/><span>{sessions.totalSessions}</span></div><div class="info-item">'+"Scanned Sessions".t()+'<br/><span>{sessions.scannedSessions}</span></div><div class="info-item">'+"Bypassed Sessions".t()+'<br/><span>{sessions.bypassedSessions}</span></div><div class="info-actions"><a class="wg-button" href="#sessions" style="flex: 1;">'+"Sessions".t()+"</a> </div></div>"}}]}],fetchData:function(){var e=this,t=this.getViewModel();t&&rpc.sessionMonitor.getSessionStats(function(n,i){t.set("sessions",n),e.fireEvent("afterdata")})}}),Ext.define("Ung.widget.MapDistribution",{extend:"Ext.container.Container",alias:"widget.mapdistributionwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget",cls:"adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},refreshIntervalSec:5,items:[{xtype:"container",layout:{type:"hbox",align:"top"},cls:"header",style:{height:"50px"},items:[{xtype:"component",flex:1,html:"<h1>"+"Map Distribution".t()+"</h1>"},{xtype:"container",margin:"10 5 0 0",layout:{type:"hbox",align:"middle"},items:[{xtype:"button",baseCls:"action",text:'<i class="material-icons">refresh</i>',listeners:{click:"fetchData"}}]}]},{xtype:"container",html:"Under construction"}],fetchData:function(){var e=this;e.fireEvent("afterdata")}}),Ext.define("Ung.view.apps.AppsController",{extend:"Ext.app.ViewController",alias:"controller.apps",control:{"#":{beforeactivate:"updateNodes"}},listen:{global:{nodestatechange:"updateNodes"},store:{"#policies":{datachanged:"updateNodes"}}},init:function(e){e.getViewModel().bind({bindTo:"{policyId}"},this.onPolicy,this)},onNodeStateChange:function(e,t){console.log(t)},updateNodes:function(){var e,t,n=this.getViewModel();rpc.nodeManager.getAppsViews(function(i,a){var o=i.filter(function(e){return parseInt(e.policyId)===parseInt(n.get("policyId"))})[0],r=o.nodeProperties.list,s=o.instances.list;for(t=0;t<r.length;t+=1)e=s.filter(function(e){return e.nodeName===r[t].name})[0],r[t].policyId=n.get("policyId"),r[t].state=e.targetState.toLowerCase();n.set("nodes",r)})},onPolicy:function(){},setPolicy:function(e,t,n){null!==n&&(this.redirectTo("#apps/"+t,!1),this.updateNodes())},onItemAfterRender:function(e){Ext.defer(function(){e.removeCls("insert")},50)}}),Ext.define("Ung.view.apps.AppsModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.apps",data:{nodes:[]},stores:{nodesStore:{data:"{nodes}",sorters:[{property:"viewPosition",direction:"ASC"}]}}}),Ext.define("Ung.view.apps.AppItem",{extend:"Ext.Button",xtype:"ung.appitem",baseCls:"app-item",viewModel:!0,hrefTarget:"_self",renderTpl:['<span id="{id}-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style="{btnWrapStyle}" <span class="app-icon"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{node.name}_80x80.png" width=80 height=80/><span class="app-name">{node.displayName}</span></span><span class="app-state {state}"><i class="material-icons">power_settings_new</i></span></span>'],initRenderData:function(){var e=this.callParent();return Ext.apply(e,{node:this.node,state:this.state}),e},listeners:{}}),Ext.define("Ung.view.apps.Apps",{extend:"Ext.container.Container",xtype:"ung.apps",layout:"border",requires:["Ung.view.apps.AppsController","Ung.view.apps.AppsModel","Ung.view.apps.AppItem"],controller:"apps",viewModel:"apps",config:{policy:void 0},defaults:{border:!1},items:[{region:"north",border:!1,height:44,itemId:"apps-topnav",bodyStyle:{background:"#555",padding:"0 5px"},layout:{type:"hbox",align:"middle"},items:[{xtype:"combobox",editable:!1,multiSelect:!1,queryMode:"local",bind:{value:"{policyId}",store:"{policies}"},valueField:"policyId",displayField:"displayName",listeners:{change:"setPolicy"}},{xtype:"button",baseCls:"heading-btn",html:Ung.Util.iconTitle("Install Apps".t(),"file_download-16"),hrefTarget:"_self",bind:{href:"#apps/{policyId}/install"}},{xtype:"component",flex:1},{xtype:"button",baseCls:"heading-btn",html:"Sessions".t(),href:"#sessions",hrefTarget:"_self"},{xtype:"button",baseCls:"heading-btn",html:"Hosts".t(),href:"#hosts",hrefTarget:"_self"},{xtype:"button",baseCls:"heading-btn",html:"Devices".t(),href:"#devices",hrefTarget:"_self"}]},{region:"center",itemId:"apps-list",border:!1,scrollable:!0,bodyStyle:{background:"transparent"},items:[{xtype:"dataview",itemId:"filters",margin:10,tpl:'<tpl for="."><tpl if="type == \'FILTER\'"><a class="app-item" href="#apps/{policyId}/{name}"><span class="app-icon"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><span class="app-name">{displayName}</span></span><span class="app-state {state}"><i class="material-icons">power_settings_new</i></span></a></tpl></tpl>',itemSelector:"a",bind:{store:"{nodesStore}"},style:{display:"inline-block"}},{xtype:"component",cls:"apps-separator",html:"Service Apps".t()},{xtype:"dataview",margin:10,tpl:'<tpl for="."><tpl if="type == \'SERVICE\'"><a class="app-item" href="#apps/{policyId}/{name}"><span class="app-icon"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><span class="app-name">{displayName}</span></span><tpl if="hasPowerButton"><span class="app-state {state}"><i class="material-icons">power_settings_new</i></span></tpl></a></tpl></tpl>',itemSelector:"a",bind:{store:"{nodesStore}"},style:{display:"inline-block"}}]}],listeners:{}}),Ext.define("Ung.view.apps.install.InstallController",{extend:"Ext.app.ViewController",alias:"controller.appsinstall",control:{"#":{beforeactivate:"onPolicy"}},listen:{store:{"#policies":{}}},init:function(e){e.getViewModel().bind({bindTo:"{policyId}"},this.onPolicy,this)},onPolicy:function(){var e,t,n=Ext.getStore("policies").findRecord("policyId",this.getViewModel().get("policyId")),i=n.get("installable").list,a=[],o=[];for(e=0;e<i.length;e+=1)t=i[e],"FILTER"===t.type&&a.push({xtype:"ung.appinstallitem",node:t}),"SERVICE"===t.type&&o.push({xtype:"ung.appinstallitem",node:t});this.getView().lookupReference("filters").removeAll(!0),this.getView().lookupReference("filters").add(a),this.getView().lookupReference("services").removeAll(!0),this.getView().lookupReference("services").add(o)},setPolicy:function(e,t,n){null!==n&&this.redirectTo("#apps/"+t+"/install",!0)},installNode:function(e){var t=this.getViewModel(),n=this.getViewModel().get("policyId"),i=e.node.name;e.hasCls("installed")?Ung.app.redirectTo("#apps/"+n+"/"+i):(e.setDisabled(!0),e.addCls("progress"),rpc.nodeManager.instantiate(function(n,i){if(i)return void Ung.Util.exceptionToast(i);try{e.removeCls("progress"),e.addCls("installed"),e.setDisabled(!1)}catch(e){console.log(e)}Ung.Util.successToast(e.node.displayName+" installed successfully!"),rpc.nodeManager.getAppsViews(function(e,t){return t?void Ung.Util.exceptionToast(t):void Ext.getStore("policies").loadData(e)}),"untangle-node-reports"===e.node.name&&(rpc.reportsManager=rpc.nodeManager.node("untangle-node-reports").getReportsManager(),Rpc.getReports().then(function(e){Ext.getStore("reports").loadData(e.list),t.getParent().set({reportsInstalled:!0,reportsRunning:"RUNNING"===rpc.nodeManager.node("untangle-node-reports").getRunState()}),t.getParent().notify(),Ext.GlobalEvents.fireEvent("reportsinstall")})),rpc.reportsManager&&rpc.reportsManager.getUnavailableApplicationsMap(function(t,n){return n?void Ung.Util.exceptionToast(n):(Ext.getStore("unavailableApps").loadRawData(t.map),void Ext.GlobalEvents.fireEvent("nodeinstall","install",e.node))})},i,n))}}),Ext.define("Ung.view.apps.install.Item",{extend:"Ext.Button",xtype:"ung.appinstallitem",baseCls:"app-item install",hrefTarget:"_self",renderTpl:['<span id="{id}-btnWrap" data-ref="btnWrap" role="presentation" unselectable="on" style="{btnWrapStyle}" class="{btnWrapCls} {btnWrapCls}-{ui} {splitCls}{childElCls}"><span class="app-icon"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{node.name}_80x80.png" width=80 height=80/><span class="app-name">{node.displayName}</span></span><div class="app-install"><i class="material-icons">get_app</i></div><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div><div class="app-done"><i class="material-icons">check</i></div></span>'],initRenderData:function(){var e=this.callParent();return e.node=this.node,e},listeners:{click:"installNode"}}),Ext.define("Ung.view.apps.install.Install",{extend:"Ext.container.Container",xtype:"ung.appsinstall",layout:"border",requires:["Ung.view.apps.install.InstallController","Ung.view.apps.install.Item"],controller:"appsinstall",viewModel:!0,defaults:{border:!1},items:[{region:"north",border:!1,height:44,itemId:"apps-topnav",bodyStyle:{background:"#555",padding:"0 5px"},layout:{type:"hbox",align:"middle"},items:[{xtype:"button",baseCls:"heading-btn",html:Ung.Util.iconTitle("Back to Apps","arrow_back-16"),hrefTarget:"_self",bind:{href:"#apps/{policyId}"}},{xtype:"component",hidden:!0,style:{color:"#CCC"},flex:1,html:"Select Apps and Services to Install".t()}]},{region:"center",itemId:"apps-list",bodyStyle:{background:"transparent"},scrollable:!0,items:[{xtype:"component",cls:"apps-separator",html:Ung.Util.iconTitle("Apps".t(),"apps")},{xtype:"container",margin:10,reference:"filters",style:{display:"inline-block"}},{xtype:"component",cls:"apps-separator",html:Ung.Util.iconTitle("Service Apps".t(),"build")},{xtype:"container",margin:10,reference:"services",style:{display:"inline-block"}}]}]}),Ext.define("Ung.view.config.ConfigController",{extend:"Ext.app.ViewController",alias:"controller.config",init:function(){this.configItems=[{name:"Network",icon:"icon_config_network.png"},{name:"Administration",icon:"icon_config_admin.png"},{name:"Email",icon:"icon_config_email.png"},{name:"Local Directory",icon:"icon_config_directory.png"},{name:"Upgrade",icon:"icon_config_upgrade.png"},{name:"System",icon:"icon_config_system.png"},{name:"About",icon:"icon_config_about.png"}],this.toolItems=[{name:"Sessions",icon:"icon_config_sessions.png"},{name:"Hosts",icon:"icon_config_hosts.png"},{name:"Devices",icon:"icon_config_devices.png"}]},onBeforeRender:function(){var e,t,n,i=[],a=[];for(n=0;n<this.configItems.length;n+=1)e=this.configItems[n],i.push({xtype:"ung.configitem",name:e.name.t(),icon:e.icon,href:"#config/"+e.name.toLowerCase().replace(/ /g,"")});for(n=0;n<this.toolItems.length;n+=1)t=this.toolItems[n],a.push({xtype:"ung.configitem",name:t.name.t(),icon:t.icon,href:"#"+t.name.toLowerCase().replace(/ /g,"")});this.getView().lookupReference("configs").removeAll(!0),this.getView().lookupReference("configs").add(i),this.getView().lookupReference("tools").removeAll(!0),this.getView().lookupReference("tools").add(a)},onItemBeforeRender:function(e){e.el.on("click",function(){Ung.app.redirectTo("#config/"+e.getViewModel().get("name"),!0)})}}),Ext.define("Ung.view.config.ConfigItem",{extend:"Ext.Button",xtype:"ung.configitem",baseCls:"app-item",viewModel:!0,hrefTarget:"_self",renderTpl:'<span class="app-icon"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/config/{icon}" width=80 height=80/></span><span class="app-name">{name}</span>',initRenderData:function(){var e=this.callParent();return Ext.apply(e,{name:this.name,icon:this.icon}),e}}),Ext.define("Ung.view.config.ConfigSettings",{extend:"Ext.container.Container",xtype:"ung.configsettings",html:"config settings"}),Ext.define("Ung.view.config.Config",{extend:"Ext.panel.Panel",xtype:"ung.config",requires:["Ung.view.config.ConfigController","Ung.view.config.ConfigItem","Ung.view.config.ConfigSettings"],controller:"config",defaults:{border:!1},items:[{border:!1,scrollable:!0,bodyStyle:{background:"transparent"},items:[{xtype:"component",cls:"apps-separator",html:Ung.Util.iconTitle("Configuration".t(),"tune")},{xtype:"container",margin:10,reference:"configs",style:{display:"inline-block"}},{xtype:"component",cls:"apps-separator",html:Ung.Util.iconTitle("Tools".t(),"build")},{xtype:"container",margin:10,reference:"tools",style:{display:"inline-block"}}]}],listeners:{beforerender:"onBeforeRender"}}),Ext.define("Ung.view.reports.ReportsController",{extend:"Ext.app.ViewController",alias:"controller.reports",init:function(){this.getAvailableTables()},control:{"#":{beforeactivate:"onBeforeActivate",beforedeactivate:"onBeforeDeactivate"},"#categoriesGrid":{selectionchange:"onCategorySelect"},"#reportsGrid":{selectionchange:"onReportSelect"},"#chart":{afterrender:"fetchReportData"},"#startDate":{select:"onSelectStartDate"},"#startTime":{select:"onSelectStartTime"},"#startDateTimeBtn":{click:"setStartDateTime"},"#endDate":{select:"onSelectEndDate"},"#endTime":{select:"onSelectEndTime"},"#endtDateTimeBtn":{click:"setEndDateTime"},"#refreshBtn":{click:"fetchReportData"},"#applyBtn":{click:"fetchReportData"},"#chartStyleBtn":{toggle:"fetchReportData"},"#timeIntervalBtn":{toggle:"fetchReportData"},"#saveNewBtn":{click:"saveReport"},"#updateBtn":{click:"updateReport"},"#removeBtn":{click:"removeReport"},"#dashboardBtn":{click:"toggleDashboardWidget"}},onBeforeActivate:function(){var e=this.getViewModel();return this.getView().getInitCategory()?(e.set({isNodeReporting:!0,activeCard:"categoryCard",category:null,report:null,categoriesData:null,startDateTime:null,endDateTime:null}),this.getView().down("#categoriesGrid").setCollapsed(!1),Ext.getStore("reports").filter({property:"category",value:this.getView().getInitCategory().categoryName,exactMatch:!0}),void this.buildReportsList()):(e.set({isNodeReporting:!1,activeCard:"allCategoriesCard",category:null,report:null,categoriesData:null,startDateTime:null,endDateTime:null}),void this.getCurrentApplications())},onBeforeDeactivate:function(){this.getView().down("#categoriesGrid").getSelectionModel().deselectAll(),this.getView().down("#reportsGrid").getSelectionModel().deselectAll(),Ext.getStore("reports").clearFilter()},getCurrentApplications:function(){var e,t,n=this.getViewModel(),i=this,a=[{categoryName:"Hosts",displayName:"Hosts".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png"},{categoryName:"Devices",displayName:"Devices".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_devices.png"},{categoryName:"Network",displayName:"Network".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_network.png"},{categoryName:"Administration",displayName:"Administration".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_admin.png"},{categoryName:"System",displayName:"System".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_system.png"},{categoryName:"Shield",displayName:"Shield".t(),icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/untangle-node-shield_17x17.png"}];rpc.reportsManager.getCurrentApplications(function(o,r){if(r)return Ung.Util.exceptionToast(r),!1;for(t=0;t<o.list.length;t+=1)e=o.list[t],"untangle-node-branding-manager"!==e.name&&"untangle-node-live-support"!==e.name&&a.push({categoryName:e.displayName,appName:e.name,displayName:e.displayName,icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/"+e.name+"_80x80.png"});Ext.getStore("categories").loadData(a),n.set("categoriesData",Ext.getStore("categories").getRange());var s=[];a.forEach(function(e,t){s.push({xtype:"button",baseCls:"category-btn",html:'<img src="'+e.icon+'"/><br/><span>'+e.displayName+"</span>",index:t,handler:function(){i.getView().down("#categoriesGrid").getSelectionModel().select(this.index)}})}),i.getView().down("#allCategoriesList").removeAll(),i.getView().down("#categoriesLoader")&&i.getView().down("#categoriesLoader").destroy(),i.getView().down("#allCategoriesList").add(s)})},getAvailableTables:function(){var e=this;rpc.reportsManager&&rpc.reportsManager.getTables(function(t,n){return n?(Ung.Util.exceptionToast(n),!1):void e.getViewModel().set("tableNames",t)})},onCategorySelect:function(e,t){return 0!==t.length&&(this.getViewModel().set("activeCard","categoryCard"),this.getViewModel().set("category",t[0]),this.getViewModel().set("report",null),this.getView().down("#categoriesGrid").setCollapsed(!1),this.getView().down("#reportsGrid").getSelectionModel().deselectAll(),Ext.getStore("reports").filter({property:"category",value:t[0].get("categoryName"),exactMatch:!0}),void this.buildReportsList())},buildReportsList:function(){var e=this,t=[],n="";this.getView().down("#categoryReportsList").removeAll(),Ext.getStore("reports").getRange().forEach(function(i){n=Ung.Util.iconReportTitle(i),n+='<span class="ttl">'+(i.get("readOnly")?i.get("title").t():i.get("title"))+"</span><p>"+(i.get("readOnly")?i.get("description").t():i.get("description"))+"</p>",t.push({xtype:"button",html:n,baseCls:"entry-btn",border:!1,textAlign:"left",item:i,handler:function(){e.getView().down("#reportsGrid").getSelectionModel().select(this.item)}})}),this.getView().down("#categoryReportsList").add(t)},onReportSelect:function(e,t){if(0===t.length)return void this.getViewModel().set({activeCard:"categoryCard"});var n=t[0],i=this.getView().down("#report");this.getViewModel().set({activeCard:"reportCard",report:n}),this.getView().down("#customization").setActiveItem(0),i.remove("chart"),"TIME_GRAPH"!==n.get("type")&&"TIME_GRAPH_DYNAMIC"!==n.get("type")||i.add({xtype:"timechart",itemId:"chart",entry:n}),"PIE_GRAPH"===n.get("type")&&i.add({xtype:"piechart",itemId:"chart",entry:n}),"EVENT_LIST"===n.get("type")&&i.add({xtype:"eventchart",itemId:"chart",entry:n}),"TEXT"===n.get("type")&&i.add({xtype:"component",itemId:"chart",html:"Not Implemented"})},fetchReportData:function(){var e=this,t=e.getViewModel(),n=e.getView().down("#chart");if(n.fireEvent("beginfetchdata"),"EVENT_LIST"!==t.get("report.type"))rpc.reportsManager.getDataForReportEntry(function(e,t){return t?(Ung.Util.exceptionToast(t),!1):void n.fireEvent("setseries",e.list)},n.getEntry().getData(),t.get("startDateTime"),t.get("endDateTime"),-1);else{var i=null,a=100;rpc.reportsManager.getEventsForDateRangeResultSet(function(e,t){return t?(Ung.Util.exceptionToast(t),!1):void e.getNextChunk(function(e,t){return t?(Ung.Util.exceptionToast(t),!1):(console.log(e),void n.fireEvent("setdata",e.list))},100)},n.getEntry().getData(),i,a,t.get("startDateTime"),t.get("endDateTime"))}},onSelectStartDate:function(e,t){var n,i=this.getViewModel();i.get("startDateTime")?(n=new Date(i.get("startDateTime")),n.setDate(t.getDate()),n.setMonth(t.getMonth()),i.set("startDateTime",n)):this.getViewModel().set("startDateTime",t)},onSelectStartTime:function(e,t){var n,i=this.getViewModel();n=i.get("startDateTime")?new Date(i.get("startDateTime")):new Date,n.setHours(t.get("date").getHours()),n.setMinutes(t.get("date").getMinutes()),i.set("startDateTime",n)},setStartDateTime:function(){var e=this.getView();console.log(this.getViewModel().get("startDateTime")),e.down("#startDateTimeMenu").hide()},onSelectEndDate:function(e,t){var n,i=this.getViewModel();i.get("endDateTime")?(n=new Date(i.get("endDateTime")),n.setDate(t.getDate()),n.setMonth(t.getMonth()),i.set("endDateTime",n)):this.getViewModel().set("endDateTime",t)},onSelectEndTime:function(e,t){var n,i=this.getViewModel();n=i.get("endDateTime")?new Date(i.get("endDateTime")):new Date,n.setHours(t.get("date").getHours()),n.setMinutes(t.get("date").getMinutes()),i.set("endDateTime",n)},setEndDateTime:function(){var e=this.getView();e.down("#endDateTimeMenu").hide()},saveReport:function(){var e,t=this,n=this.getViewModel();e=n.get("report").copy(null),e.set("uniqueId","report-"+Math.random().toString(36).substr(2)),e.set("readOnly",!1),rpc.reportsManager.saveReportEntry(function(i,a){return a?(Ung.Util.exceptionToast(a),!1):(n.get("report").reject(),Ext.getStore("reports").add(e),e.commit(),t.getView().down("#reportsGrid").getSelectionModel().select(e),void Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+e.get("title")+" report added!"))},e.getData())},updateReport:function(){var e=this.getViewModel();rpc.reportsManager.saveReportEntry(function(t,n){return n?(Ung.Util.exceptionToast(n),!1):(e.get("report").commit(),void Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+e.get("report.title")+"</span> report updated!"))},e.get("report").getData())},removeReport:function(){var e=this,t=this.getViewModel();Ext.MessageBox.confirm("Warning".t(),"This will remove also the Widget from Dashboard".t()+"<br/><br/>"+"Do you want to continue?".t(),function(n){"yes"===n&&rpc.reportsManager.removeReportEntry(function(n,i){return i?(Ung.Util.exceptionToast(i),!1):(Ext.getStore("reports").remove(t.get("report")),e.buildReportsList(),e.getView().down("#reportsGrid").getSelectionModel().deselectAll(),Ung.Util.successToast("Report removed!"),void e.toggleDashboardWidget())},t.get("report").getData())})},toggleDashboardWidget:function(){var e,t=this.getViewModel(),n=this;t.get("isWidget")?(e=Ext.getStore("widgets").findRecord("entryId",t.get("report.uniqueId")),e?(Ext.getStore("widgets").remove(e),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),rpc.dashboardManager.setSettings(function(e,i){return i?void Ung.Util.exceptionToast(i):(Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.get("report.title")+"</span> was removed from dashboard!"),Ext.GlobalEvents.fireEvent("removewidget",t.get("report.uniqueId")),t.set("isWidget",!t.get("isWidget")),void n.getView().down("#reportsGrid").getView().refresh())},Ung.dashboardSettings)):Ung.Util.exceptionToast('<span style="color: yellow; font-weight: 600;">'+t.get("report.title")+"</span> was not found on Dashboard!")):(e=Ext.create("Ung.model.Widget",{displayColumns:t.get("report.displayColumns"),enabled:!0,entryId:t.get("report.uniqueId"),javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:60,timeframe:3600,type:"ReportEntry"}),Ext.getStore("widgets").add(e),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),rpc.dashboardManager.setSettings(function(i,a){return a?void Ung.Util.exceptionToast(a):(Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.get("report.title")+"</span> was added to dashboard!"),Ext.GlobalEvents.fireEvent("addwidget",e,t.get("report")),t.set("isWidget",!t.get("isWidget")),void n.getView().down("#reportsGrid").getView().refresh())},Ung.dashboardSettings))}}),Ext.define("Ung.view.reports.ReportsModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.reports",data:{isNodeReporting:!1,activeCard:"allCategoriesCard",category:null,report:null,categoriesData:null,startDateTime:null,endDateTime:null},formulas:{isCategorySelected:function(e){return"allCategoriesCard"!==e("activeCard")},areCategoriesHidden:function(e){return!e("isCategorySelected")||e("isNodeReporting")},reportHeading:function(e){return e("report.readOnly")?"<h2>"+e("report.title").t()+"</h2><p>"+e("report.description").t()+"</p>":"<h2>"+e("report.title")+"</h2><p>"+e("report.description")+"</p>"},isTimeGraph:function(e){return!!e("report.type")&&e("report.type").indexOf("TIME_GRAPH")>=0},isPieGraph:function(e){return!!e("report.type")&&e("report.type").indexOf("PIE_GRAPH")>=0},startDate:function(e){return e("startDateTime")?Ext.Date.format(e("startDateTime"),"M j, h:i a"):"One day ago".t()},endDate:function(e){return e("endDateTime")?Ext.Date.format(e("endDateTime"),"M j, h:i a"):"Present".t()},startTimeMax:function(e){var t=new Date,n=new Date(e("startDateTime"));if(t.getYear()===n.getYear()&&t.getMonth()===n.getMonth()&&t.getDate()===n.getDate())return t},customizeTitle:function(e){return e("report.readOnly")?"Customize".t()+' <span style="font-weight: 300; color: #777;">(Readonly report! Changes can be saved as a new custom report!)</span>':"Customize".t()},isWidget:function(e){return!!Ext.getStore("widgets").findRecord("entryId",e("report.uniqueId"))},dashboardBtnLabel:function(e){return e("isWidget")?Ung.Util.iconTitle("Remove from Dashboard".t(),"home-16"):Ung.Util.iconTitle("Add to Dashboard".t(),"home-16")}},stores:{categories:{model:"Ung.model.Category",data:"{categoriesData}"}}}),Ext.define("Ung.model.Category",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"displayName",type:"string"},{name:"icon",type:"string"}],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.view.reports.Reports",{extend:"Ext.container.Container",xtype:"ung.reports",layout:"border",requires:["Ung.view.reports.ReportsController","Ung.view.reports.ReportsModel","Ung.model.Category"],controller:"reports",viewModel:{type:"reports"},config:{initCategory:null},items:[{region:"west",xtype:"grid",itemId:"categoriesGrid",title:"Select Category".t(),width:200,hideHeaders:!0,shadow:!1,collapsible:!0,floatable:!1,titleCollapse:!0,animCollapse:!1,viewConfig:{stripeRows:!1},hidden:!0,bind:{hidden:"{areCategoriesHidden}",store:"{categories}"},columns:[{dataIndex:"icon",width:20,renderer:function(e,t){return t.tdCls="app-icon",'<img src="'+e+'"/>'}},{dataIndex:"displayName",flex:1}]},{region:"center",layout:"border",border:!1,items:[{region:"west",xtype:"grid",itemId:"reportsGrid",title:"Select Report".t(),width:250,hideHeaders:!0,shadow:!1,collapsible:!0,layout:"fit",animCollapse:!1,floatable:!1,titleCollapse:!0,viewConfig:{stripeRows:!1},bind:{hidden:"{!isCategorySelected}",store:"{reports}"},columns:[{dataIndex:"title",width:20,renderer:function(e,t,n){return t.tdCls="app-icon",Ung.Util.iconReportTitle(n)}},{dataIndex:"title",flex:1,renderer:function(e,t,n){return n.get("readOnly")?e.t():e}},{dataIndex:"readOnly",width:20,align:"center",renderer:function(e,t){return t.tdCls="app-icon",e?"":'<i class="material-icons" style="font-size: 14px; color: #999;">brush</i>'}},{dataIndex:"uniqueId",width:20,align:"center",renderer:function(e,t){return t.tdCls="app-icon",Ext.getStore("widgets").findRecord("entryId",e)?'<i class="material-icons" style="font-size: 14px; color: #999;">home</i>':""}}]},{region:"center",border:!1,layout:"card",bind:{activeItem:"{activeCard}"},defaults:{border:!1},items:[{itemId:"allCategoriesCard",scrollable:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"headline",margin:"50 0",html:"Please select a category first!"},{xtype:"component",itemId:"categoriesLoader",margin:"50 0",cls:"loader",html:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'},{xtype:"container",itemId:"allCategoriesList",style:{textAlign:"center"}}]},{itemId:"categoryCard",scrollable:!0,items:[{xtype:"component",cls:"headline",margin:"50 0",bind:{html:'<img src="{category.icon}" style="width: 80px; height: 80px;"/><br/>{category.displayName}'}},{xtype:"container",style:{textAlign:"center"},itemId:"categoryReportsList"}]},{layout:"border",itemId:"reportCard",defaults:{border:!1,bodyBorder:!1},items:[{region:"north",height:60,items:[{xtype:"component",cls:"report-header",bind:{html:"{reportHeading}"}}]},{region:"center",itemId:"report",layout:"fit",items:[],bbar:[{xtype:"component",margin:"0 5 0 5",html:Ung.Util.iconTitle("","date_range-16")},{xtype:"button",bind:{text:"{startDate}"},menu:{itemId:"startDateTimeMenu",plain:!0,showSeparator:!1,shadow:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"datepicker",maxDate:new Date,itemId:"startDate"},{xtype:"timefield",itemId:"startTime",format:"h:i a",increment:30,margin:"5",fieldLabel:"Time".t(),labelAlign:"right",labelWidth:60,width:160,plain:!0,editable:!1,value:"12:00 am",bind:{maxValue:"{startTimeMax}"}},{xtype:"button",itemId:"startDateTimeBtn",text:Ung.Util.iconTitle("OK".t(),"check-16")}]}},{xtype:"button",bind:{text:"{endDate}"},menu:{itemId:"endDateTimeMenu",plain:!0,showSeparator:!1,shadow:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"datepicker",maxDate:new Date,itemId:"endDate",bind:{minDate:"{startDateTime}"}},{xtype:"timefield",itemId:"endTime",format:"h:i a",increment:30,margin:"5",fieldLabel:"Time".t(),labelAlign:"right",labelWidth:60,width:160,plain:!0,editable:!1,value:"12:00 am",bind:{maxValue:"{endTimeMax}"}},{xtype:"button",itemId:"endDateTimeBtn",text:Ung.Util.iconTitle("OK".t(),"check-16")}]}},"-",{text:Ung.Util.iconTitle("Refresh".t(),"update-16"),itemId:"refreshBtn"},"->",{itemId:"downloadBtn",text:Ung.Util.iconTitle("Download".t(),"file_download-16")},"-",{itemId:"dashboardBtn",bind:{text:"{dashboardBtnLabel}"}}]},{region:"south",xtype:"form",layout:"fit",minHeight:300,shadow:!1,split:!0,collapsible:!0,collapsed:!1,floatable:!1,titleCollapse:!0,animCollapse:!1,border:!1,bodyBorder:!1,bind:{title:"{customizeTitle}"},items:[{xtype:"tabpanel",itemId:"customization",border:!1,defaults:{border:!1,bodyBorder:!1,bodyPadding:5},items:[{title:Ung.Util.iconTitle("Style".t(),"color_lens-16"),layout:{type:"vbox",align:"stretch"},items:[{xtype:"textfield",fieldLabel:"Title".t(),maxWidth:400,labelWidth:150,labelAlign:"right",allowBlank:!1,bind:{value:"{report.title}"}},{xtype:"textfield",fieldLabel:"Description".t(),labelWidth:150,labelAlign:"right",bind:{value:"{report.description}"}},{xtype:"container",layout:"hbox",margin:"0 0 5 0",items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Enabled".t()+":"},{xtype:"segmentedbutton",bind:{value:"{report.enabled}"},items:[{text:"YES".t(),value:!0},{text:"NO".t(),value:!1}]}]},{xtype:"container",layout:"hbox",margin:"0 0 5 0",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}"},items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Time Chart Style".t()+":"},{xtype:"segmentedbutton",itemId:"chartStyleBtn",bind:{value:"{report.timeStyle}"},items:[{text:"Line".t(),value:"LINE",styleType:"spline"},{text:"Area".t(),value:"AREA",styleType:"areaspline"},{text:"Stacked Area".t(),value:"AREA_STACKED",styleType:"areaspline",stacked:!0},{text:"Column".t(),value:"BAR",styleType:"column",grouped:!0},{text:"Overlapped Columns".t(),value:"BAR_OVERLAPPED",styleType:"column",overlapped:!0},{text:"Stacked Columns".t(),value:"BAR_STACKED",styleType:"column",stacked:!0}]}]},{xtype:"container",layout:"hbox",margin:"0 0 5 0",hidden:!0,bind:{disabled:"{!isPieGraph}",hidden:"{!isPieGraph}"},items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Style".t()+":"},{xtype:"segmentedbutton",itemId:"chartStyleBtn",bind:{value:"{report.pieStyle}"},items:[{text:"Pie",value:"PIE",styleType:"pie"},{text:"Donut",value:"DONUT",styleType:"pie"},{text:"Column",value:"COLUMN",styleType:"column"}]}]},{xtype:"container",layout:"hbox",margin:"0 0 5 0",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}"},items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Time Data Interval".t()+":"},{xtype:"segmentedbutton",itemId:"timeIntervalBtn",bind:{value:"{report.timeDataInterval}"},items:[{text:"Auto".t(),value:"AUTO"},{text:"Second".t(),value:"SECOND",defaultTimeFrame:60},{text:"Minute".t(),value:"MINUTE",defaultTimeFrame:60},{text:"10 Minutes".t(),value:"TENMINUTE",defaultTimeFrame:600},{text:"Hour".t(),value:"HOUR",defaultTimeFrame:24},{text:"Day".t(),value:"DAY",defaultTimeFrame:7},{text:"Week".t(),value:"WEEK",defaultTimeFrame:12},{text:"Month".t(),value:"MONTH",defaultTimeFrame:6}]}]},{xtype:"numberfield",fieldLabel:"Pie Slices Number".t(),labelWidth:150,maxWidth:200,labelAlign:"right",minValue:1,maxValue:25,allowBlank:!1,hidden:!0,bind:{disabled:"{!isPieGraph}",hidden:"{!isPieGraph}",value:"{report.pieNumSlices}"}}]},{title:Ung.Util.iconTitle("Conditions".t(),"find_in_page-16")},{title:Ung.Util.iconTitle("Advanced".t(),"settings-16"),scrollable:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combobox",fieldLabel:"Table".t(),maxWidth:400,labelWidth:150,labelAlign:"right",editable:!1,hidden:!0,bind:{store:"{tableNames}",disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.table}"}},{xtype:"textfield",fieldLabel:"Units".t(),
maxWidth:305,labelWidth:150,labelAlign:"right",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.units}"}},{xtype:"textarea",fieldLabel:"Time Data Columns".t(),grow:!0,maxWidth:500,labelWidth:150,labelAlign:"right",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.timeDataColumns}"}},{xtype:"textfield",fieldLabel:"Series Renderer".t(),maxWidth:305,labelWidth:150,labelAlign:"right",hidden:!0,bind:{disabled:"{!isTimeGraph}",hidden:"{!isTimeGraph}",value:"{report.seriesRenderer}"}},{xtype:"container",layout:"hbox",margin:"0 0 5 0",items:[{xtype:"label",cls:"x-form-item-label-default",width:155,style:{textAlign:"right"},text:"Order By Column".t()+":"},{xtype:"textfield",bind:{value:"{report.orderByColumn}"}},{xtype:"segmentedbutton",margin:"0 0 0 5",bind:{value:"{report.orderDesc}"},items:[{text:Ung.Util.iconTitle("Ascending".t(),"arrow_upward-16"),value:!0},{text:Ung.Util.iconTitle("Descending".t(),"arrow_downward-16"),value:!1}]}]},{xtype:"numberfield",fieldLabel:"Display Order".t(),maxWidth:220,labelWidth:150,labelAlign:"right",bind:{value:"{report.displayOrder}"}}]}]}],fbar:[{text:Ung.Util.iconTitle("Remove".t(),"delete-16"),itemId:"removeBtn",bind:{hidden:"{report.readOnly}"}},{text:Ung.Util.iconTitle("Update".t(),"save-16"),itemId:"updateBtn",formBind:!0,bind:{hidden:"{report.readOnly}"}},{text:Ung.Util.iconTitle("Save as New Report".t(),"add-16"),itemId:"saveNewBtn",formBind:!0}]}]}]}]}]}),Ext.define("Ung.view.node.SettingsController",{extend:"Ext.app.ViewController",alias:"controller.nodesettings",config:{nodeManager:null},control:{"#":{beforeactivate:"onBeforeActivate",beforedeactivate:"onBeforeDeactivate"}},listen:{store:{"#metrics":{datachanged:"updateMetrics"}}},onBeforeActivate:function(){var e=this,t=this.getViewModel(),n=Ext.getStore("policies").findRecord("policyId",t.get("policyId")),i=n.get("instances").list.filter(function(e){return e.nodeName===t.get("nodeName")})[0],a=t.get("policy.nodeProperties.list").filter(function(e){return i.nodeName===e.name})[0];t.set("nodeInstance",i),t.set("nodeProps",a);var o=new Ext.LoadMask({msg:"Loading...".t(),target:this.getView()}).show();Ext.require(Ung.Util.nodeClassMapping[i.nodeName],function(){rpc.nodeManager.node(function(n,a){return a?(Ung.Util.exceptionToast(a),!1):(e.setNodeManager(n),void n.getSettings(function(n){e.getView().add({xtype:"ung."+i.nodeName,region:"center",itemId:"settings"}),console.log(n),t.set("settings",n),o.hide()}))},i.id)})},updateMetrics:function(){var e=this.getViewModel(),t=Ext.getStore("metrics").findRecord("nodeId",e.get("nodeInstance.id"));t&&e.set("metrics",t.get("metrics").list),this.getView().down("nodechart")&&this.getView().down("nodechart").fireEvent("addPoint")},onPower:function(e){var t=this.getNodeManager(),n=this.getViewModel();e.setDisabled(!0),"RUNNING"===n.get("nodeInstance.targetState")?t.stop(function(i,a){return a?(Ung.Util.exceptionToast(a),!1):void t.getRunState(function(i,a){return a?(Ung.Util.exceptionToast(a),!1):(n.set("nodeInstance.targetState",i),n.notify(),e.setDisabled(!1),"untangle-node-reports"===t.getNodeProperties().name&&n.getParent().set("reportsRunning",!1),Ung.Util.successToast(n.get("powerMessage")),void Ext.GlobalEvents.fireEvent("nodestatechange",i,n.get("nodeInstance")))})}):t.start(function(i,a){return a?(Ext.Msg.alert("Error",a.message),e.setDisabled(!1),!1):void t.getRunState(function(i,a){return a?(Ung.Util.exceptionToast(a),!1):(n.set("nodeInstance.targetState",i),n.notify(),e.setDisabled(!1),"untangle-node-reports"===t.getNodeProperties().name&&n.getParent().set("reportsRunning",!0),Ung.Util.successToast(n.get("powerMessage")),void Ext.GlobalEvents.fireEvent("nodestatechange",i,n.get("nodeInstance")))})})},onBeforeDeactivate:function(e){console.log("on deactivate"),e.remove("settings",{destroy:!0})},saveSettings:function(){var e=this,t=this.getViewModel(),n=this.getNodeManager();this.getView().query("grid").forEach(function(e){e.fireEvent("save")});var i=new Ext.LoadMask({msg:"Saving ...",target:this.getView()}).show();n.setSettings(function(a,o){return i.hide(),o?(Ung.Util.exceptionToast(o),!1):(Ung.util.Util.successToast("Settings saved!"),void n.getSettings(function(n,i){return i?(Ung.Util.exceptionToast(i),!1):(t.set("settings",n),void e.getView().query("grid").forEach(function(e){e.fireEvent("reloaded")}))}))},t.get("settings"))},removeNode:function(){var e=this.getViewModel(),t=this.getView(),n=Ext.String.format("{0} will be uninstalled from this policy.".t(),"display name")+"<br/>"+"All of its settings will be lost.".t()+"\n<br/><br/>"+"Would you like to continue?".t();Ext.Msg.confirm("Warning:".t(),n,function(n){if("yes"===n){var i=t.up("#main").down("#apps").down("#"+e.get("nodeInstance.nodeName"));i.addCls("remove"),Ung.app.redirectTo("#apps/"+e.get("policyId")),rpc.nodeManager.destroy(function(t,n){return n?(Ung.Util.exceptionToast(n),!1):(rpc.nodeManager.getAppsViews(function(e,t){return t?void Ung.Util.exceptionToast(t):void Ext.getStore("policies").loadData(e)}),"untangle-node-reports"===i.node.name&&(delete rpc.reportsManager,e.getParent().set("reportsInstalled",!1),e.getParent().set("reportsRunning",!1),e.getParent().notify(),Ext.GlobalEvents.fireEvent("reportsinstall")),void(rpc.reportsManager&&rpc.reportsManager.getUnavailableApplicationsMap(function(e,t){return t?void Ung.Util.exceptionToast(t):(Ext.getStore("unavailableApps").loadRawData(e.map),void Ext.GlobalEvents.fireEvent("nodeinstall","remove",i.node))})))},e.get("nodeInstance.id"))}})}}),Ext.define("Ung.view.node.SettingsModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.nodesettings",data:{nodeInstance:null,nodeProps:null,metrics:null,nodeReports:null},formulas:{powerMessage:function(e){return"RUNNING"===e("nodeInstance.targetState")?Ext.String.format("{0} is enabled.".t(),e("nodeProps.displayName")):Ext.String.format("{0} is disabled.".t(),e("nodeProps.displayName"))},powerButton:function(e){return"RUNNING"===e("nodeInstance.targetState")?Ung.Util.iconTitle("Disable","power_settings_new-16"):Ung.Util.iconTitle("Enable","power_settings_new-16")}},stores:{nodeMetrics:{model:"Ung.model.NodeMetric",data:"{metrics}"},areports:{model:"Ung.model.Report",data:"{nodeReports}"}}}),Ext.define("Ung.view.node.Reports",{extend:"Ext.panel.Panel",xtype:"nodereports",requires:[],layout:"border",border:!1,title:"Reports".t(),items:[{region:"west",xtype:"grid",width:300,border:!1,bodyBorder:!1,header:!1,hideHeaders:!0,trackMouseOver:!1,viewConfig:{stripeRows:!1},bind:{store:"{reports}"},columns:[{dataIndex:"title",flex:1}]},{region:"center",html:"center"}]}),Ext.define("Ung.model.NodeMetric",{extend:"Ext.data.Model",fields:[{name:"displayName",type:"string"},{name:"name",type:"string"},{name:"value",type:"int"},{name:"javaClass",type:"string",defaultValue:"com.untangle.uvm.node.NodeMetric"}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.model.GenericRule",{extend:"Ext.data.Model",fields:[{name:"name",type:"string",defaultValue:null},{name:"string",type:"string",defaultValue:""},{name:"blocked",type:"boolean",defaultValue:!0},{name:"flagged",type:"boolean",defaultValue:!0},{name:"category",type:"string",defaultValue:null},{name:"description",type:"string",defaultValue:""},{name:"enabled",type:"boolean",defaultValue:!0},{name:"id",defaultValue:null},{name:"readOnly",type:"boolean",defaultValue:null},{name:"javaClass",type:"string",defaultValue:"com.untangle.uvm.node.GenericRule"}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.view.shd.SessionsController",{extend:"Ext.app.ViewController",alias:"controller.sessions",control:{"#":{beforeactivate:"getSessions"},"#list":{select:"onSelect"},"toolbar textfield":{change:"globalFilter"}},refreshInterval:null,setAutoRefresh:function(e){var t=this,n=this.getViewModel();n.set("autoRefresh",e.pressed),console.log(e.pressed),e.pressed?(t.getSessions(),this.refreshInterval=setInterval(function(){t.getSessions()},5e3)):clearInterval(this.refreshInterval)},getSessions:function(){console.log("get sessions");var e=this,t=e.getView().down("#list");t.getView().setLoading(!0),rpc.sessionMonitor.getMergedSessions(function(e,n){return t.getView().setLoading(!1),n?void Ung.Util.exceptionToast(n):(Ext.getStore("sessions").loadData(e.list),void t.getSelectionModel().select(0))})},onSelect:function(e,t){var n=this.getViewModel(),i=t.getData();delete i._id,delete i.javaClass,delete i.mark,delete i.localAddr,delete i.remoteAddr,n.set("selectedSession",i)},globalFilter:function(e,t){var n=this.getView().down("#list"),i=new RegExp(t,"gi");t.length>0?(n.getStore().clearFilter(),n.getStore().filterBy(function(e){return i.test(e.get("protocol"))||i.test(e.get("preNatClient"))||i.test(e.get("postNatServer"))||i.test(e.get("preNatClientPort"))||i.test(e.get("postNatServerPort"))})):n.getStore().clearFilter(),n.getSelectionModel().select(0)}}),Ext.define("Ung.view.shd.Sessions",{extend:"Ext.panel.Panel",xtype:"ung.sessions",requires:["Ung.view.shd.SessionsController"],controller:"sessions",viewModel:{data:{autoRefresh:!1}},layout:"border",defaults:{border:!1},title:"Current Sessions".t(),items:[{region:"center",xtype:"grid",itemId:"list",store:"sessions",plugins:"gridfilters",columnLines:!0,columns:[{header:"Creation Time".t(),dataIndex:"creationTime",hidden:!0},{header:"Protocol".t(),dataIndex:"protocol",width:70,filter:{type:"list",options:["TCP","UDP"]}},{header:"Bypassed".t(),dataIndex:"bypassed",width:70},{header:"Policy".t(),dataIndex:"policy",hidden:!0},{header:"Hostname".t(),dataIndex:"platform-hostname",flex:1},{header:"NATd".t(),dataIndex:"natted",hidden:!0},{header:"Port Forwarded".t(),dataIndex:"portForwarded",hidden:!0},{header:"Username".t(),dataIndex:"platform-username",hidden:!0},{header:"Client".t(),columns:[{header:"Interface".t(),dataIndex:"clientIntf"},{header:"Pre-NAT".t(),dataIndex:"preNatClient"},{header:"Port (Pre-NAT)".t(),dataIndex:"preNatClientPort"},{header:"Post-NAT".t(),dataIndex:"postNatClient",hidden:!0},{header:"Port (Post-NAT)".t(),dataIndex:"postNatClientPort",hidden:!0},{header:"Country".t(),dataIndex:"clientCountry",hidden:!0},{header:"Latitude".t(),dataIndex:"clientLatitude",hidden:!0},{header:"Longitude".t(),dataIndex:"clientLlongitude",hidden:!0}]},{header:"Server".t(),columns:[{header:"Interface".t(),dataIndex:"serverIntf"},{header:"Pre-NAT".t(),dataIndex:"preNatServer",hidden:!0},{header:"Port (Pre-NAT)".t(),dataIndex:"preNatServerPort",hidden:!0},{header:"Post-NAT".t(),dataIndex:"postNatServer"},{header:"Port (Post-NAT)".t(),dataIndex:"postNatServerPort"},{header:"Country".t(),dataIndex:"serverCountry",hidden:!0},{header:"Latitude".t(),dataIndex:"serverLatitude",hidden:!0},{header:"Longitude".t(),dataIndex:"serverLlongitude",hidden:!0}]},{header:"Speed (KB/s)".t(),columns:[{header:"Client".t(),dataIndex:"clientKBps",filter:"number",align:"right"},{header:"Server".t(),dataIndex:"serverKBps",filter:"number",align:"right"},{header:"Total".t(),dataIndex:"totalKBps",filter:"number",align:"right"}]}]},{region:"east",xtype:"propertygrid",itemId:"details",editable:!1,width:400,title:"Session Details".t(),split:!0,collapsible:!0,resizable:!0,shadow:!1,animCollapse:!1,titleCollapse:!0,cls:"prop-grid",viewConfig:{stripeRows:!1,getRowClass:function(e){if(null===e.get("value")||""===e.get("value"))return"empty"}},nameColumnWidth:150,bind:{source:"{selectedSession}"},sourceConfig:{attachments:{displayName:"Attachments".t()},bypassed:{displayName:"Bypassed".t()},clientCountry:{displayName:"Client Country".t()},clientIntf:{displayName:"Client Interface".t()},clientKBps:{displayName:"Client KB/s".t()},clientLatitude:{displayName:"Client Latitude".t()},clientLongitude:{displayName:"Client Longitude".t()},creationTime:{displayName:"Creation Time".t()},hostname:{displayName:"Hostname".t()},natted:{displayName:"NATd".t()},pipeline:{displayName:"Pipeline".t()},policy:{displayName:"Policy".t()},portForwarded:{displayName:"Port Forwarded".t()},postNatClient:{displayName:"Client (Post-NAT)".t()},postNatClientPort:{displayName:"Client Port (Post-NAT)".t()},postNatServer:{displayName:"Server (Post-NAT)".t()},postNatServerPort:{displayName:"Server Port (Post-NAT)".t()},preNatClient:{displayName:"Client (Pre-NAT)".t()},preNatClientPort:{displayName:"Client Port (Pre-NAT)".t()},preNatServer:{displayName:"Server (Pre-NAT)".t()},preNatServerPort:{displayName:"Server Port (Pre-NAT)".t()},priority:{displayName:"Priority".t()},protocol:{displayName:"Protocol".t()},qosPriority:{displayName:"Priority".t()+"(QoS)"},serverCountry:{displayName:"Server Country".t()},serverIntf:{displayName:"Server Interface".t()},serverKBps:{displayName:"Server KB/s".t()},serverLatitude:{displayName:"Server Latitude".t()},serverLongitude:{displayName:"Server Longitude".t()},sessionId:{displayName:"Session ID".t()},state:{displayName:"State".t()},totalKBps:{displayName:"Total KB/s".t()}},listeners:{beforeedit:function(){return!1}}}],tbar:[{xtype:"button",text:Ung.Util.iconTitle("Refresh".t(),"refresh-16"),handler:"getSessions",bind:{disabled:"{autoRefresh}"}},{xtype:"button",text:Ung.Util.iconTitle("Auto Refresh".t(),"autorenew-16"),enableToggle:!0,toggleHandler:"setAutoRefresh"},"-","Filter:".t(),{xtype:"textfield",checkChangeBuffer:200}]}),Ext.define("Ung.view.shd.HostsController",{extend:"Ext.app.ViewController",alias:"controller.hosts",control:{"#":{beforeactivate:"onBeforeActivate"},"#hostsgrid":{beforerender:"onBeforeRenderHostsGrid"}},onBeforeActivate:function(e){e.setActiveItem(0)},onBeforeRenderHostsGrid:function(e){this.getHosts()},getHosts:function(){console.log("get hosts");var e=this,t=e.getView().down("#hostsgrid");t.getView().setLoading(!0),rpc.hostTable.getHosts(function(e,n){return t.getView().setLoading(!1),n?void Ung.Util.exceptionToast(n):void Ext.getStore("hosts").loadData(e.list)})}}),Ext.define("Ung.view.shd.Hosts",{extend:"Ext.tab.Panel",xtype:"ung.hosts",requires:["Ung.view.shd.HostsController"],controller:"hosts",layout:"border",defaults:{border:!1},items:[{xtype:"grid",itemId:"hostsgrid",title:"Current Hosts".t(),store:"hosts",columns:[{header:"IP".t(),dataIndex:"address"},{header:"MAC Address".t(),dataIndex:"macAddress"},{header:"MAC Vendor".t(),dataIndex:"macVendor"},{header:"Interface".t(),dataIndex:"interfaceId"},{header:"Last Access Time".t(),dataIndex:"lastAccessTimeDate",hidden:!0},{header:"Last Session Time".t(),dataIndex:"lastSessionTimeDate",hidden:!0},{header:"Last Completed TCP Session Time".t(),dataIndex:"lastCompletedTcpSessionTime",hidden:!0},{header:"Entitled Status".t(),dataIndex:"entitledStatus",hidden:!0},{header:"Active".t(),dataIndex:"active"},{header:"Hostname".t(),dataIndex:"hostname"},{header:"User Name".t(),dataIndex:"username"},{header:"Penalty".t(),columns:[{header:"Boxed".t(),dataIndex:"penaltyBoxed"},{header:"Entry Time".t(),dataIndex:"penaltyBoxEntryTime",hidden:!0},{header:"Exit Time".t(),dataIndex:"penaltyBoxExitTime",hidden:!0}]},{header:"Quota".t(),columns:[{header:"Size".t(),dataIndex:"quotaSize"},{header:"Remaining".t(),dataIndex:"quotaRemaining"},{header:"Issue Time".t(),dataIndex:"quotaIssueTime",hidden:!0},{header:"Expiration Time".t(),dataIndex:"quotaExpirationTime",hidden:!0}]}]},{title:"Penalty Box Hosts".t(),html:"penalty hosts"},{title:"Current Quotas".t(),html:"quotas"},{title:"Reports".t(),html:"reports"}]}),Ext.define("Ung.widget.ReportModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.reportwidget",formulas:{title:{get:function(e){return"<h1>"+e("entry.title")+(e("entry.timeDataInterval")?' <span style="text-transform: lowercase; color: #777; font-weight: 100;">per '+e("entry.timeDataInterval")+"</span>":"")+"</h1><p>since "+e("timeframe")+" ago</p></h1>"}},timeframe:{get:function(e){return e("widget.timeframe")}}}}),Ext.define("Ung.widget.CpuLoadController",{extend:"Ext.app.ViewController",alias:"controller.cpuload",control:{"#":{afterrender:"onAfterRender",resize:"onResize"}},listen:{store:{"#stats":{datachanged:"addPoint"}}},onAfterRender:function(e){setTimeout(function(){e.removeCls("adding")},100),this.lineChart=new Highcharts.Chart({chart:{type:"areaspline",renderTo:e.lookupReference("cpulinechart").getEl().dom,marginBottom:15,marginTop:20,backgroundColor:"transparent",animation:!1,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,credits:{enabled:!1},exporting:{enabled:!1},xAxis:[{type:"datetime",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Source Sans Pro",color:"#999",fontSize:"11px",fontWeight:600},y:12},maxPadding:0,minPadding:0}],yAxis:{min:0,minRange:2,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickAmount:4,tickLength:5,tickWidth:1,tickPosition:"inside",opposite:!1,labels:{align:"left",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#999",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:1,y:-2},title:null},legend:{enabled:!1},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+=': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span>",e+"<br/>"}},plotOptions:{areaspline:{fillOpacity:.15,lineWidth:2},series:{marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}},series:[{name:"load",data:function(){var e,t=[],n=Date.now();try{n=rpc.systemManager.getMilliseconds()}catch(e){console.log("Unable to get current millis.")}for(n=1e3*Math.round(n/1e3),e=-19;e<=0;e+=1)t.push({x:n+3e3*e,y:0});return t}()}]}),this.gaugeChart=new Highcharts.Chart({chart:{type:"gauge",renderTo:e.lookupReference("cpugaugechart").getEl().dom,height:140,margin:[-20,0,0,0],backgroundColor:"transparent",style:{margin:"0 auto"}},credits:{enabled:!1},title:null,exporting:{enabled:!1},pane:[{startAngle:-45,endAngle:45,background:null,center:["50%","135%"],size:280}],tooltip:{enabled:!1},yAxis:[{min:0,max:50,minorTickPosition:"outside",tickPosition:"outside",tickColor:"#555",minorTickColor:"#999",labels:{rotation:"auto",distance:20,step:1},plotBands:[{from:0,to:3,color:"rgba(112, 173, 112, 1)",innerRadius:"100%",outerRadius:"105%"},{from:3,to:6,color:"rgba(255, 255, 0, 1)",innerRadius:"100%",outerRadius:"105%"},{from:6,to:7,color:"rgba(255, 0, 0, 1)",innerRadius:"100%",outerRadius:"105%"}],title:null}],plotOptions:{gauge:{dataLabels:{enabled:!1},dial:{radius:"99%",backgroundColor:"#999"}}},series:[{data:[0]}]}),this.addPoint()},onResize:function(){this.lineChart.reflow(),this.gaugeChart.reflow()},addPoint:function(){if(this.gaugeChart&&this.lineChart){var e=Ext.getStore("stats"),t=this.getViewModel(),n=e.first().getData(),i=n.numCpus+1,a=n.numCpus+4;this.lineChart.yAxis[0].update({minRange:n.numCpus}),this.gaugeChart.yAxis[0].update({max:a+1,plotBands:[{from:0,to:i,color:"rgba(112, 173, 112, 1)",innerRadius:"100%",outerRadius:"105%"},{from:i,to:a,color:"rgba(255, 255, 0, 1)",innerRadius:"100%",outerRadius:"105%"},{from:a,to:a+1,color:"rgba(255, 0, 0, 1)",innerRadius:"100%",outerRadius:"105%"}]}),this.lineChart.series[0].addPoint({x:Date.now(),y:e.first().getData().oneMinuteLoadAvg},!0,!0),this.gaugeChart.series[0].points[0].update(n.oneMinuteLoadAvg<=a+1?n.oneMinuteLoadAvg:a+1,!0),n.oneMinuteLoadAvg<i&&t.set("loadLabel","low".t()),n.oneMinuteLoadAvg>i&&t.set("loadLabel","medium".t()),n.oneMinuteLoadAvg>a&&t.set("loadLabel","high".t())}}}),Ext.define("Ung.widget.CpuLoad",{extend:"Ext.container.Container",alias:"widget.cpuloadwidget",requires:["Ung.widget.CpuLoadController"],controller:"cpuload",viewModel:!0,hidden:!0,border:!1,baseCls:"widget",cls:"small adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"CPU Load".t()+"</h1>"},{xtype:"container",items:[{xtype:"component",height:120,reference:"cpulinechart"},{xtype:"component",reference:"cpugaugechart",height:140},{xtype:"component",cls:"cpu-gauge",bind:{html:"{stats.oneMinuteLoadAvg}<br/><span>{loadLabel}</span>"}}]}]}),Ext.define("Ung.widget.InterfaceItem",{extend:"Ext.Component",alias:"widget.interfaceitem",bind:{html:'<p class="name" style="display: {displayWan};">{iface.name}</p><div class="speeds"><div class="speed_up"><i class="material-icons">arrow_drop_up</i><span>{tx} kB/s</span></div><div class="speed_down"><i class="material-icons">arrow_drop_down</i><span>{rx} kB/s</span></div></div><p class="name" style="display: {displayNotWan};">{iface.name}</p><i class="material-icons pointer">arrow_drop_down</i>'},viewModel:{formulas:{displayWan:function(e){return e("iface.isWan")?"block":"none"},displayNotWan:function(e){return e("iface.isWan")?"none":"block"},tx:function(e){var t=e("stats").getData(),n="interface_"+e("iface.interfaceId")+"_txBps";return t.hasOwnProperty(n)?(t[n]/1024).toFixed(2):"-"},rx:function(e){var t=e("stats").getData(),n="interface_"+e("iface.interfaceId")+"_rxBps";return t.hasOwnProperty(n)?(t[n]/1024).toFixed(2):"-"}}}}),Ext.define("Ung.widget.NetworkLayout",{extend:"Ext.container.Container",alias:"widget.networklayoutwidget",requires:["Ung.widget.InterfaceItem"],controller:"widget",hidden:!0,border:!1,baseCls:"widget adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},refreshIntervalSec:0,items:[{xtype:"component",cls:"header",itemId:"header",html:"<h1>"+"Network Layout".t()+'</h1><button class="action-btn"><i class="material-icons" data-action="refresh">refresh</i></button>'},{cls:"net-layout",margin:10,layout:{type:"vbox",align:"stretch"},border:!1,defaults:{xtype:"component"},items:[{html:'<img src="'+resourcesBaseHref+'/skins/default/images/admin/icons/interface-cloud.png" style="margin: 0 auto; display: block; height: 30px;"/>'},{xtype:"container",cls:"ifaces",height:69,itemId:"externalInterface"},{xtype:"component",cls:"line"},{xtype:"container",cls:"ifaces",height:80,itemId:"internalInterface"},{xtype:"component",cls:"devices",margin:"5 0 0 0",height:40,bind:{html:'<img src="'+resourcesBaseHref+'/skins/default/images/admin/icons/interface-devices.png"><br/>{deviceCount}'}}]}],fetchData:function(){var e=this;rpc.networkManager.getNetworkSettings(function(t,n){return e.fireEvent("afterdata"),n?(Ung.Util.exceptionToast(n),!1):(e.down("#externalInterface").removeAll(),e.down("#internalInterface").removeAll(),void Ext.each(t.interfaces.list,function(t){t.disabled||(t.isWan?e.down("#externalInterface").add({xtype:"interfaceitem",cls:"iface wan",viewModel:{data:{iface:t}}}):e.down("#internalInterface").add({xtype:"interfaceitem",cls:"iface",viewModel:{data:{iface:t}}}))}))})}}),Ext.define("Ung.view.grid.GridController",{extend:"Ext.app.ViewController",alias:"controller.ung.grid",init:function(e){if(e.getToolbarFeatures()){var t=e.getToolbarFeatures(),n=Ext.create("Ext.toolbar.Toolbar");Ext.Array.contains(t,"add")&&n.add({text:Ung.Util.iconTitle("Add","add-16"),handler:"addRecord"}),Ext.Array.contains(t,"revert")&&n.add({text:Ung.Util.iconTitle("Revert","undo-16"),handler:"revertChanges"}),Ext.Array.contains(t,"delete")&&n.add({text:Ung.Util.iconTitle("Delete","delete-16"),handler:"deleteRecords"}),Ext.Array.contains(t,"importexport")&&n.add("->",{text:Ung.Util.iconTitle("Import","arrow_downward-16")},{text:Ung.Util.iconTitle("Export","arrow_upward-16")}),e.addDocked(n)}"cell"===e.getInlineEdit()&&e.addPlugin({ptype:"cellediting",clicksToEdit:2}),"row"===e.getInlineEdit()&&e.addPlugin({ptype:"rowediting",clicksToEdit:2,clicksToMoveEditor:1,errorSummary:!1,pluginId:"rowediting"})},onBeforeDestory:function(e){},checkChanges:function(e){this.getViewModel().set("isDirty",e.getUpdatedRecords().length>0||e.getRemovedRecords().length>0||e.getModifiedRecords().length>0)},addRecord:function(){var e=this,t=this.getViewModel(),n=Ext.create("Ung.view.grid.Editor",{title:"Add".t(),width:500,y:200,columns:e.getView().getColumns(),viewModel:{data:{record:Ext.create("Ung.model.GenericRule")}}}).show();n.on("close",function(){"save"===n.getCloseAction()&&t.get("store").add(n.getViewModel().get("record"))})},deleteRecords:function(){this.getViewModel().get("store").remove(this.getView().getSelectionModel().getSelection())},editRecord:function(e,t,n,i,a,o,r){var s=this.getViewModel(),l=o.copy(null),d=Ext.create("Ung.view.grid.Editor",{title:"Edit".t(),width:800,y:200,columns:i.up("grid").getColumns(),viewModel:{data:{record:l}}}).show();d.on("close",function(){o.copyFrom(d.getViewModel().get("record")),o.dirty=!0,o.commit(),s.get("store").update()})},deleteRecord:function(e,t,n,i,a,o,r){o.drop()},onSave:function(){var e=this.getViewModel();e.get("store")&&e.set("settings."+this.getView().getDataProperty()+".list",Ext.Array.pluck(e.get("store").getRange(),"data"))}}),Ext.define("Ung.view.grid.ConditionsController",{extend:"Ext.app.ViewController",alias:"controller.ung.gridconditions",init:function(e){},onBeforeRender:function(e){var t=e.getViewModel();t.get("record.conditions.list")},onChange:function(){console.log("on change")},typeRenderer:function(e){return Ext.getStore("conditions").findRecord("name",e).get("displayName")},valueRenderer:function(e,t,n){var i=Ext.getStore("conditions").findRecord("name",n.get("conditionType")).get("editorType");switch(i){case"countryselector":var a="";return e.split(",").forEach(function(e){a+=Ext.getStore("countries").findRecord("code",e).get("name")+", "}),a}return e},onConditionSelect:function(e,t,n){var i=this,a=Ext.create("Ung.view.grid.ConditionEditor",{bind:{title:"Edit".t()},width:400,y:250,viewModel:{data:{condition:t}}}).show();a.on("close",function(){console.log(this.getViewModel().get("condition"))}),i.getView().getSelectionModel().deselectAll()},onConditionTypeChange:function(){console.log("cond chage")},onAddCondition:function(){var e=Ext.create("Ung.model.Condition");Ext.create("Ung.view.grid.ConditionEditor",{bind:{title:"Add Condition".t()},width:400,y:250,viewModel:{data:{condition:e}}}).show()}}),Ext.define("Ung.store.Conditions",{extend:"Ext.data.Store",storeId:"conditions",fields:["name","displayName","type"],data:[{name:"DST_ADDR",displayName:"Destination Address".t(),editorType:"textfield",vtype:"ipall",visible:!0},{name:"DST_PORT",displayName:"Destination Port".t(),editorType:"textfield",vtype:"port",visible:!0},{name:"DST_INTF",displayName:"Destination Interface".t(),editorType:"checkgroup",visible:!0},{name:"SRC_ADDR",displayName:"Source Address".t(),editorType:"textfield",visible:!0,vtype:"ipall"},{name:"SRC_PORT",displayName:"Source Port".t(),editorType:"textfield",vtype:"portMatcher",visible:rpc.isExpertMode},{name:"SRC_INTF",displayName:"Source Interface".t(),editorType:"checkgroup",visible:!0},{name:"PROTOCOL",displayName:"Protocol".t(),editorType:"checkgroup",values:[["TCP","TCP"],["UDP","UDP"],["any","any"]],visible:!0},{name:"USERNAME",displayName:"Username".t(),editorType:"userselection",visible:!0},{name:"CLIENT_HOSTNAME",displayName:"Client Hostname".t(),editorType:"textfield",visible:!0},{name:"SERVER_HOSTNAME",displayName:"Server Hostname".t(),editorType:"textfield",visible:rpc.isExpertMode},{name:"SRC_MAC",displayName:"Client MAC Address".t(),editorType:"textfield",visible:!0},{name:"DST_MAC",displayName:"Server MAC Address".t(),editorType:"textfield",visible:!0},{name:"CLIENT_MAC_VENDOR",displayName:"Client MAC Vendor".t(),editorType:"textfield",visible:!0},{name:"SERVER_MAC_VENDOR",displayName:"Server MAC Vendor".t(),editorType:"textfield",visible:!0},{name:"CLIENT_IN_PENALTY_BOX",displayName:"Client in Penalty Box".t(),editorType:"boolean",visible:!0},{name:"SERVER_IN_PENALTY_BOX",displayName:"Server in Penalty Box".t(),editorType:"boolean",visible:!0},{name:"CLIENT_HAS_NO_QUOTA",displayName:"Client has no Quota".t(),editorType:"boolean",visible:!0},{name:"SERVER_HAS_NO_QUOTA",displayName:"Server has no Quota".t(),editorType:"boolean",visible:!0},{name:"CLIENT_QUOTA_EXCEEDED",displayName:"Client has exceeded Quota".t(),editorType:"boolean",visible:!0},{name:"SERVER_QUOTA_EXCEEDED",displayName:"Server has exceeded Quota".t(),editorType:"boolean",visible:!0},{name:"CLIENT_QUOTA_ATTAINMENT",displayName:"Client Quota Attainment".t(),editorType:"textfield",visible:!0},{name:"SERVER_QUOTA_ATTAINMENT",displayName:"Server Quota Attainment".t(),editorType:"textfield",visible:!0},{name:"HTTP_HOST",displayName:"HTTP: Hostname".t(),editorType:"textfield",visible:!0},{name:"HTTP_REFERER",displayName:"HTTP: Referer".t(),editorType:"textfield",visible:!0},{name:"HTTP_URI",displayName:"HTTP: URI".t(),editorType:"textfield",visible:!0},{name:"HTTP_URL",displayName:"HTTP: URL".t(),editorType:"textfield",visible:!0},{name:"HTTP_CONTENT_TYPE",displayName:"HTTP: Content Type".t(),editorType:"textfield",visible:!0},{name:"HTTP_CONTENT_LENGTH",displayName:"HTTP: Content Length".t(),editorType:"textfield",visible:!0},{name:"HTTP_USER_AGENT",displayName:"HTTP: Client User Agent".t(),editorType:"textfield",visible:!0},{name:"HTTP_USER_AGENT_OS",displayName:"HTTP: Client User OS".t(),editorType:"textfield",visible:!1},{name:"APPLICATION_CONTROL_APPLICATION",displayName:"Application Control: Application".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_CATEGORY",displayName:"Application Control: Application Category".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_PROTOCHAIN",displayName:"Application Control: Protochain".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_DETAIL",displayName:"Application Control: Detail".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_CONFIDENCE",displayName:"Application Control: Confidence".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_PRODUCTIVITY",displayName:"Application Control: Productivity".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_RISK",displayName:"Application Control: Risk".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_SIGNATURE",displayName:"Application Control Lite: Signature".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_CATEGORY",displayName:"Application Control Lite: Category".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_DESCRIPTION",displayName:"Application Control Lite: Description".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_CATEGORY",displayName:"Web Filter: Category".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_CATEGORY_DESCRIPTION",displayName:"Web Filter: Category Description".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_FLAGGED",displayName:"Web Filter: Website is Flagged".t(),editorType:"boolean",visible:!0},{name:"DIRECTORY_CONNECTOR_GROUP",displayName:"Directory Connector: User in Group".t(),type:"editor",visible:!0},{name:"CLIENT_COUNTRY",displayName:"Client Country".t(),editorType:"countryselector",visible:!0},{name:"SERVER_COUNTRY",displayName:"Server Country".t(),editorType:"countryselector",visible:!0}]}),Ext.define("Ung.store.Countries",{extend:"Ext.data.Store",storeId:"countries",data:[{code:"AF",name:"Afghanistan".t()},{code:"AX",name:"Aland Islands".t()},{code:"AL",name:"Albania".t()},{code:"DZ",name:"Algeria".t()},{code:"AS",name:"American Samoa".t()},{code:"AD",name:"Andorra".t()},{code:"AO",name:"Angola".t()},{code:"AI",name:"Anguilla".t()},{code:"AQ",name:"Antarctica".t()},{code:"AG",name:"Antigua and Barbuda".t()},{code:"AR",name:"Argentina".t()},{code:"AM",name:"Armenia".t()},{code:"AW",name:"Aruba".t()},{code:"AU",name:"Australia".t()
},{code:"AT",name:"Austria".t()},{code:"AZ",name:"Azerbaijan".t()},{code:"BS",name:"Bahamas".t()},{code:"BH",name:"Bahrain".t()},{code:"BD",name:"Bangladesh".t()},{code:"BB",name:"Barbados".t()},{code:"BY",name:"Belarus".t()},{code:"BE",name:"Belgium".t()},{code:"BZ",name:"Belize".t()},{code:"BJ",name:"Benin".t()},{code:"BM",name:"Bermuda".t()},{code:"BT",name:"Bhutan".t()},{code:"BO",name:"Bolivia, Plurinational State of".t()},{code:"BQ",name:"Bonaire, Sint Eustatius and Saba".t()},{code:"BA",name:"Bosnia and Herzegovina".t()},{code:"BW",name:"Botswana".t()},{code:"BV",name:"Bouvet Island".t()},{code:"BR",name:"Brazil".t()},{code:"IO",name:"British Indian Ocean Territory".t()},{code:"BN",name:"Brunei Darussalam".t()},{code:"BG",name:"Bulgaria".t()},{code:"BF",name:"Burkina Faso".t()},{code:"BI",name:"Burundi".t()},{code:"KH",name:"Cambodia".t()},{code:"CM",name:"Cameroon".t()},{code:"CA",name:"Canada".t()},{code:"CV",name:"Cape Verde".t()},{code:"KY",name:"Cayman Islands".t()},{code:"CF",name:"Central African Republic".t()},{code:"TD",name:"Chad".t()},{code:"CL",name:"Chile".t()},{code:"CN",name:"China".t()},{code:"CX",name:"Christmas Island".t()},{code:"CC",name:"Cocos (Keeling) Islands".t()},{code:"CO",name:"Colombia".t()},{code:"KM",name:"Comoros".t()},{code:"CG",name:"Congo".t()},{code:"CD",name:"Congo, the Democratic Republic of the".t()},{code:"CK",name:"Cook Islands".t()},{code:"CR",name:"Costa Rica".t()},{code:"CI",name:"Cote d'Ivoire".t()},{code:"HR",name:"Croatia".t()},{code:"CU",name:"Cuba".t()},{code:"CW",name:"Curacao".t()},{code:"CY",name:"Cyprus".t()},{code:"CZ",name:"Czech Republic".t()},{code:"DK",name:"Denmark".t()},{code:"DJ",name:"Djibouti".t()},{code:"DM",name:"Dominica".t()},{code:"DO",name:"Dominican Republic".t()},{code:"EC",name:"Ecuador".t()},{code:"EG",name:"Egypt".t()},{code:"SV",name:"El Salvador".t()},{code:"GQ",name:"Equatorial Guinea".t()},{code:"ER",name:"Eritrea".t()},{code:"EE",name:"Estonia".t()},{code:"ET",name:"Ethiopia".t()},{code:"FK",name:"Falkland Islands (Malvinas)".t()},{code:"FO",name:"Faroe Islands".t()},{code:"FJ",name:"Fiji".t()},{code:"FI",name:"Finland".t()},{code:"FR",name:"France".t()},{code:"GF",name:"French Guiana".t()},{code:"PF",name:"French Polynesia".t()},{code:"TF",name:"French Southern Territories".t()},{code:"GA",name:"Gabon".t()},{code:"GM",name:"Gambia".t()},{code:"GE",name:"Georgia".t()},{code:"DE",name:"Germany".t()},{code:"GH",name:"Ghana".t()},{code:"GI",name:"Gibraltar".t()},{code:"GR",name:"Greece".t()},{code:"GL",name:"Greenland".t()},{code:"GD",name:"Grenada".t()},{code:"GP",name:"Guadeloupe".t()},{code:"GU",name:"Guam".t()},{code:"GT",name:"Guatemala".t()},{code:"GG",name:"Guernsey".t()},{code:"GN",name:"Guinea".t()},{code:"GW",name:"Guinea-Bissau".t()},{code:"GY",name:"Guyana".t()},{code:"HT",name:"Haiti".t()},{code:"HM",name:"Heard Island and McDonald Islands".t()},{code:"VA",name:"Holy See (Vatican City State)".t()},{code:"HN",name:"Honduras".t()},{code:"HK",name:"Hong Kong".t()},{code:"HU",name:"Hungary".t()},{code:"IS",name:"Iceland".t()},{code:"IN",name:"India".t()},{code:"ID",name:"Indonesia".t()},{code:"IR",name:"Iran, Islamic Republic of".t()},{code:"IQ",name:"Iraq".t()},{code:"IE",name:"Ireland".t()},{code:"IM",name:"Isle of Man".t()},{code:"IL",name:"Israel".t()},{code:"IT",name:"Italy".t()},{code:"JM",name:"Jamaica".t()},{code:"JP",name:"Japan".t()},{code:"JE",name:"Jersey".t()},{code:"JO",name:"Jordan".t()},{code:"KZ",name:"Kazakhstan".t()},{code:"KE",name:"Kenya".t()},{code:"KI",name:"Kiribati".t()},{code:"KP",name:"Korea, Democratic People's Republic of".t()},{code:"KR",name:"Korea, Republic of".t()},{code:"KW",name:"Kuwait".t()},{code:"KG",name:"Kyrgyzstan".t()},{code:"LA",name:"Lao People's Democratic Republic".t()},{code:"LV",name:"Latvia".t()},{code:"LB",name:"Lebanon".t()},{code:"LS",name:"Lesotho".t()},{code:"LR",name:"Liberia".t()},{code:"LY",name:"Libya".t()},{code:"LI",name:"Liechtenstein".t()},{code:"LT",name:"Lithuania".t()},{code:"LU",name:"Luxembourg".t()},{code:"MO",name:"Macao".t()},{code:"MK",name:"Macedonia, the Former Yugoslav Republic of".t()},{code:"MG",name:"Madagascar".t()},{code:"MW",name:"Malawi".t()},{code:"MY",name:"Malaysia".t()},{code:"MV",name:"Maldives".t()},{code:"ML",name:"Mali".t()},{code:"MT",name:"Malta".t()},{code:"MH",name:"Marshall Islands".t()},{code:"MQ",name:"Martinique".t()},{code:"MR",name:"Mauritania".t()},{code:"MU",name:"Mauritius".t()},{code:"YT",name:"Mayotte".t()},{code:"MX",name:"Mexico".t()},{code:"FM",name:"Micronesia, Federated States of".t()},{code:"MD",name:"Moldova, Republic of".t()},{code:"MC",name:"Monaco".t()},{code:"MN",name:"Mongolia".t()},{code:"ME",name:"Montenegro".t()},{code:"MS",name:"Montserrat".t()},{code:"MA",name:"Morocco".t()},{code:"MZ",name:"Mozambique".t()},{code:"MM",name:"Myanmar".t()},{code:"NA",name:"Namibia".t()},{code:"NR",name:"Nauru".t()},{code:"NP",name:"Nepal".t()},{code:"NL",name:"Netherlands".t()},{code:"NC",name:"New Caledonia".t()},{code:"NZ",name:"New Zealand".t()},{code:"NI",name:"Nicaragua".t()},{code:"NE",name:"Niger".t()},{code:"NG",name:"Nigeria".t()},{code:"NU",name:"Niue".t()},{code:"NF",name:"Norfolk Island".t()},{code:"MP",name:"Northern Mariana Islands".t()},{code:"NO",name:"Norway".t()},{code:"OM",name:"Oman".t()},{code:"PK",name:"Pakistan".t()},{code:"PW",name:"Palau".t()},{code:"PS",name:"Palestine, State of".t()},{code:"PA",name:"Panama".t()},{code:"PG",name:"Papua New Guinea".t()},{code:"PY",name:"Paraguay".t()},{code:"PE",name:"Peru".t()},{code:"PH",name:"Philippines".t()},{code:"PN",name:"Pitcairn".t()},{code:"PL",name:"Poland".t()},{code:"PT",name:"Portugal".t()},{code:"PR",name:"Puerto Rico".t()},{code:"QA",name:"Qatar".t()},{code:"RE",name:"Reunion".t()},{code:"RO",name:"Romania".t()},{code:"RU",name:"Russian Federation".t()},{code:"RW",name:"Rwanda".t()},{code:"BL",name:"Saint Barthelemy".t()},{code:"SH",name:"Saint Helena, Ascension and Tristan da Cunha".t()},{code:"KN",name:"Saint Kitts and Nevis".t()},{code:"LC",name:"Saint Lucia".t()},{code:"MF",name:"Saint Martin (French part)".t()},{code:"PM",name:"Saint Pierre and Miquelon".t()},{code:"VC",name:"Saint Vincent and the Grenadines".t()},{code:"WS",name:"Samoa".t()},{code:"SM",name:"San Marino".t()},{code:"ST",name:"Sao Tome and Principe".t()},{code:"SA",name:"Saudi Arabia".t()},{code:"SN",name:"Senegal".t()},{code:"RS",name:"Serbia".t()},{code:"SC",name:"Seychelles".t()},{code:"SL",name:"Sierra Leone".t()},{code:"SG",name:"Singapore".t()},{code:"SX",name:"Sint Maarten (Dutch part)".t()},{code:"SK",name:"Slovakia".t()},{code:"SI",name:"Slovenia".t()},{code:"SB",name:"Solomon Islands".t()},{code:"SO",name:"Somalia".t()},{code:"ZA",name:"South Africa".t()},{code:"GS",name:"South Georgia and the South Sandwich Islands".t()},{code:"SS",name:"South Sudan".t()},{code:"ES",name:"Spain".t()},{code:"LK",name:"Sri Lanka".t()},{code:"SD",name:"Sudan".t()},{code:"SR",name:"Suriname".t()},{code:"SJ",name:"Svalbard and Jan Mayen".t()},{code:"SZ",name:"Swaziland".t()},{code:"SE",name:"Sweden".t()},{code:"CH",name:"Switzerland".t()},{code:"SY",name:"Syrian Arab Republic".t()},{code:"TW",name:"Taiwan, Province of China".t()},{code:"TJ",name:"Tajikistan".t()},{code:"TZ",name:"Tanzania, United Republic of".t()},{code:"TH",name:"Thailand".t()},{code:"TL",name:"Timor-Leste".t()},{code:"TG",name:"Togo".t()},{code:"TK",name:"Tokelau".t()},{code:"TO",name:"Tonga".t()},{code:"TT",name:"Trinidad and Tobago".t()},{code:"TN",name:"Tunisia".t()},{code:"TR",name:"Turkey".t()},{code:"TM",name:"Turkmenistan".t()},{code:"TC",name:"Turks and Caicos Islands".t()},{code:"TV",name:"Tuvalu".t()},{code:"UG",name:"Uganda".t()},{code:"UA",name:"Ukraine".t()},{code:"AE",name:"United Arab Emirates".t()},{code:"GB",name:"United Kingdom".t()},{code:"US",name:"United States".t()},{code:"UM",name:"United States Minor Outlying Islands".t()},{code:"UY",name:"Uruguay".t()},{code:"UZ",name:"Uzbekistan".t()},{code:"VU",name:"Vanuatu".t()},{code:"VE",name:"Venezuela, Bolivarian Republic of".t()},{code:"VN",name:"Viet Nam".t()},{code:"VG",name:"Virgin Islands, British".t()},{code:"VI",name:"Virgin Islands, U.S.".t()},{code:"WF",name:"Wallis and Futuna".t()},{code:"EH",name:"Western Sahara".t()},{code:"YE",name:"Yemen".t()},{code:"ZM",name:"Zambia".t()},{code:"ZW",name:"Zimbabwe".t()}]}),Ext.define("Ung.chart.TimeChartController",{extend:"Ext.app.ViewController",alias:"controller.timechart",control:{"#":{resize:"onResize"}},styles:{LINE:{styleType:"spline"},AREA:{styleType:"areaspline"},AREA_STACKED:{styleType:"areaspline",stacking:!0},BAR:{styleType:"column",grouping:!0},BAR_OVERLAPPED:{styleType:"column",overlapped:!0},BAR_STACKED:{styleType:"column",stacking:!0}},init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},setChartType:function(e){var t="areaspline";switch(e){case"LINE":t="spline";break;case"AREA":case"AREA_STACKED":t="areaspline";break;case"BAR":case"BAR_3D":case"BAR_OVERLAPPED":case"BAR_3D_OVERLAPPED":case"BAR_STACKED":t="column";break;default:t="areaspline"}return t},onAfterRender:function(e){var t=this;this.entry=e.getViewModel().get("entry")||this.getView().getEntry(),this.chart=new Highcharts.StockChart({chart:{type:t.setChartType(t.entry.get("timeStyle")),zoomType:"x",renderTo:e.lookupReference("timechart").getEl().dom,marginTop:10,padding:[0,0,0,0],backgroundColor:"transparent",animation:!1,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,noData:{style:{fontSize:"16px",fontWeight:"normal",color:"#999"}},colors:null!==t.entry.get("colors")&&t.entry.get("colors")>0?t.entry.get("colors"):t.defaultColors,navigator:{enabled:!1},rangeSelector:{enabled:!1,inputEnabled:!1},scrollbar:{enabled:!1},credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},xAxis:[{type:"datetime",alternateGridColor:"rgba(220, 220, 220, 0.1)",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600},y:12},maxPadding:0,minPadding:0}],yAxis:{allowDecimals:!0,min:0,minRange:"percent"===t.entry.get("units")?100:.4,maxRange:"percent"===t.entry.get("units")?100:void 0,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickLength:5,tickWidth:1,showFirstLabel:!1,showLastLabel:!0,endOnTick:"percent"!==t.entry.get("units"),tickInterval:"percent"===t.entry.get("units")?20:void 0,maxPadding:0,opposite:!1,labels:{align:"right",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:-10,y:5,formatter:function(){var e=this.value;return"bytes/s"===t.entry.get("units")&&(e=Ung.Util.bytesToHumanReadable(this.value,!0)),e}},title:{align:"high",offset:-10,y:3,text:t.entry.get("units"),style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"10px",fontWeight:600}}},legend:{enabled:!0,padding:5,margin:0,y:10,lineHeight:12,itemDistance:10,itemStyle:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"12px",fontWeight:600},symbolHeight:7,symbolWidth:7,symbolRadius:3},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+="bytes"===t.entry.get("units")||"bytes/s"===t.entry.get("units")?': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span>":': <spanstyle="color: '+this.color+'; font-weight: bold;">'+this.y+"</span> "+t.entry.get("units"),e+"<br/>"}},plotOptions:{column:{edgeWidth:0,borderWidth:0,pointPadding:0,groupPadding:.2,dataGrouping:{groupPixelWidth:40},pointPlacement:"on",dataLabels:{enabled:!1,align:"left",rotation:-45,x:0,y:-2,style:{fontSize:"9px",color:"#999",textShadow:!1}}},areaspline:{lineWidth:0},spline:{lineWidth:2,softThreshold:!1},series:{animation:!1,marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}}})},onResize:function(){this.chart.reflow()},onSetSeries:function(e){var t,n,i,a=this,o=[],r=Ext.clone(this.entry.get("timeDataColumns")),s=this.entry.get("timeStyle"),l=this.entry.get("colors")||this.defaultColors;if(this.getView().lookupReference("loader").hide(),r)for(t=0;t<r.length;t+=1)r[t]=r[t].split(" ").splice(-1)[0];else for(r=[],n=0;n<e.length;n+=1)for(i in e[n])e[n].hasOwnProperty(i)&&"time_trunc"!==i&&"time"!==i&&r.indexOf(i)<0&&r.push(i);for(t=0;t<r.length;t+=1){for(o=[],n=0;n<e.length;n+=1)o.push([e[n].time_trunc.time,e[n][r[t]]||0]);this.chart.get("series-"+r[t])?this.chart.get("series-"+r[t]).update({data:o,type:a.styles[s].styleType,color:l[t]||void 0,fillOpacity:"AREA_STACKED"===s||"BAR_STACKED"===s?1:.5,grouping:a.styles[s].grouping||!1,stacking:a.styles[s].stacking||void 0,pointPadding:a.styles[s].overlapped?(r.length<=3?.1:.075)*t:.1,visible:!("total"===r[t]&&a.styles[s].stacking)}):this.chart.addSeries({id:"series-"+r[t],name:r[t],data:o,type:a.styles[s].styleType,color:l[t]||void 0,fillOpacity:"AREA_STACKED"===s||"BAR_STACKED"===s?1:.5,grouping:a.styles[s].grouping||!1,stacking:a.styles[s].stacking||void 0,pointPlacement:0,pointPadding:a.styles[s].overlapped?(r.length<=3?.12:.075)*(t+1):.1,visible:!("total"===r[t]&&a.styles[s].stacking)},!1,!1)}this.chart.redraw()},onSetStyle:function(){var e=this,t=e.getViewModel().get("entry.timeStyle"),n=e.getViewModel().get("entry.colors")||this.defaultColors;if(this.chart){var i=this.chart.series.length;this.chart.series.forEach(function(a,o){a.update({type:e.styles[t].styleType,color:n[o]||void 0,fillOpacity:"AREA_STACKED"===t||"BAR_STACKED"===t?1:.5,grouping:e.styles[t].grouping||!1,stacking:e.styles[t].stacking||void 0,pointPadding:e.styles[t].overlapped?(i<=3?.15:.075)*o:.1,visible:!("total"===a.name&&e.styles[t].stacking)})})}},onBeginFetchData:function(){this.getView().lookupReference("loader").show()}}),Ext.define("Ung.chart.TimeChart",{extend:"Ext.container.Container",alias:"widget.timechart",requires:["Ung.chart.TimeChartController"],controller:"timechart",viewModel:!0,config:{widget:null,entry:null},listeners:{afterrender:"onAfterRender",resize:"onResize",setseries:"onSetSeries",beginfetchdata:"onBeginFetchData"},items:[{xtype:"component",reference:"timechart",cls:"chart"},{xtype:"component",reference:"loader",cls:"loader",hideMode:"visibility",html:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}]}),Ext.define("Ung.chart.PieChartController",{extend:"Ext.app.ViewController",alias:"controller.piechart",styles:{LINE:{styleType:"spline"},AREA:{styleType:"areaspline"},AREA_STACKED:{styleType:"areaspline",stacking:!0},BAR:{styleType:"column",grouping:!0},BAR_OVERLAPPED:{styleType:"column",overlapped:!0},BAR_STACKED:{styleType:"column",stacking:!0}},init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},onAfterRender:function(e){var t=this;this.entry=e.getViewModel().get("entry")||this.getView().getEntry(),this.chart=new Highcharts.Chart({chart:{type:t.entry.get("pieStyle").indexOf("COLUMN")>=0?"column":"pie",renderTo:e.lookupReference("piechart").getEl().dom,marginTop:10,marginRight:0,marginLeft:0,backgroundColor:"transparent",style:{fontFamily:"Source Sans Pro",fontSize:"12px"},options3d:{enabled:!1,alpha:45,beta:5}},title:null,lang:{noData:"No data available yet!",drillUpText:"< Back"},noData:{style:{fontSize:"16px",fontWeight:"normal",color:"#999"}},colors:null!==t.entry.get("colors")&&t.entry.get("colors")>0?t.entry.get("colors"):this.defaultColors,credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},xAxis:{type:"category",crosshair:!0,alternateGridColor:"rgba(220, 220, 220, 0.1)",labels:{style:{fontSize:"11px"}},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",maxPadding:0,minPadding:0},yAxis:{lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickLength:5,tickWidth:1,tickPosition:"inside",showFirstLabel:!1,showLastLabel:!0,endOnTick:!0,labels:{align:"left",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:9,y:6,formatter:function(){return this.isLast?'<span style="color: #555; font-size: 12px;"><strong>'+this.value+"</strong> ("+t.entry.get("units")+")</span>":this.value}}},tooltip:{headerFormat:'<span style="font-size: 14px; font-weight: bold;">aaa : {point.key}</span><br/>',hideDelay:0},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",center:["50%","50%"],showInLegend:!0,colorByPoint:!0,minSize:150,borderWidth:1,borderColor:"#EEE",dataLabels:{enabled:!0,distance:5,padding:0,reserveSpace:!1,style:{fontSize:"11px",color:"#777",fontFamily:"Source Sans Pro",fontWeight:400},formatter:function(){return this.point.percentage<3?null:this.point.name.length>25?this.point.name.substring(0,25)+"...":this.point.name}}},column:{borderWidth:0,colorByPoint:!0,depth:25,dataLabels:{enabled:!1,align:"center"}},series:{animation:!1}},legend:{enabled:!1,backgroundColor:"#EEE",borderRadius:3,padding:15,style:{overflow:"hidden"},title:{text:"aaa",style:{fontSize:"14px"}},itemStyle:{fontSize:"11px",width:"120px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},useHTML:!0,layout:"vertical",align:"left",verticalAlign:"top",symbolHeight:8,symbolWidth:8,symbolRadius:4}})},onResize:function(){this.chart.reflow()},onSetSeries:function(e){for(this.getView().lookupReference("loader").hide();this.chart.series.length>0;)this.chart.series[0].remove(!0);var t,n=[],i=0;for(t=0;t<e.length;t+=1)t<this.entry.get("pieNumSlices")?n.push({name:void 0!==e[t][this.entry.get("pieGroupColumn")]?e[t][this.entry.get("pieGroupColumn")]:"None",y:e[t].value}):i+=e[t].value;i>0&&n.push({name:"Other",color:"#DDD",y:i}),this.chart.addSeries({name:"aaa",type:this.entry.get("pieStyle").indexOf("COLUMN")>=0?"column":"pie",colors:this.entry.get("colors")||this.defaultColors,innerSize:this.entry.get("pieStyle").indexOf("DONUT")>=0?"50%":0,data:n},!0,!0)},onSetStyle:function(){var e=this,t=e.getViewModel().get("entry.pieStyle"),n=e.getViewModel().get("entry.colors")||this.defaultColors;this.chart&&this.chart.series[0].update({type:t.indexOf("COLUMN")>=0?"column":"pie",colors:n,innerSize:t.indexOf("DONUT")>=0?"50%":0})},onBeginFetchData:function(){this.getView().lookupReference("loader").show()}}),Ext.define("Ung.chart.PieChart",{extend:"Ext.container.Container",alias:"widget.piechart",requires:["Ung.chart.PieChartController"],controller:"piechart",viewModel:!0,config:{widget:null,entry:null},listeners:{afterrender:"onAfterRender",resize:"onResize",setseries:"onSetSeries",beginfetchdata:"onBeginFetchData"},items:[{xtype:"component",reference:"piechart",cls:"chart"},{xtype:"component",reference:"loader",cls:"loader",hideMode:"visibility",html:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}]}),Ext.define("Ung.chart.EventChartController",{extend:"Ext.app.ViewController",alias:"controller.eventchart",control:{"#":{setdata:"onSetData",beginfetchdata:"onBeforeData"}},onBeforeData:function(){this.getView().setLoading("Querying Database...".t())},onSetData:function(e){this.getView().setLoading(!1),this.getViewModel().set("customData",e)}}),Ext.define("Ung.util.TableConfig",{alternateClassName:"Ung.TableConfig",singleton:!0,columnWidth:{hostname:120,ip:100,port:70,timestamp:135,username:120},table:{sessions:["session_id","time_stamp","end_time","bypassed","entitled","protocol","icmp_type","hostname","username","policy_id","policy_rule_id","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","client_intf","server_intf","client_country","client_latitude","client_longitude","server_country","server_latitude","server_longitude","c2p_bytes","p2c_bytes","s2p_bytes","p2s_bytes","filter_prefix","firewall_blocked","firewall_flagged","firewall_rule_index","application_control_lite_blocked","application_control_lite_protocol","captive_portal_rule_index","captive_portal_blocked","application_control_application","application_control_protochain","application_control_category","application_control_flagged","application_control_blocked","application_control_confidence","application_control_detail","application_control_ruleid","bandwidth_control_priority","bandwidth_control_rule","ssl_inspector_status","ssl_inspector_detail","ssl_inspector_ruleid"],session_minutes:["session_id","time_stamp","end_time","bypassed","entitled","protocol","icmp_type","hostname","username","policy_id","policy_rule_id","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","client_intf","server_intf","client_country","client_latitude","client_longitude","server_country","server_latitude","server_longitude","c2p_bytes","p2c_bytes","s2p_bytes","p2s_bytes","filter_prefix","firewall_blocked","firewall_flagged","firewall_rule_index","application_control_lite_blocked","application_control_lite_protocol","captive_portal_rule_index","captive_portal_blocked","application_control_application","application_control_protochain","application_control_category","application_control_flagged","application_control_blocked","application_control_confidence","application_control_detail","application_control_ruleid","bandwidth_control_priority","bandwidth_control_rule","ssl_inspector_status","ssl_inspector_detail","ssl_inspector_ruleid"],http_events:["request_id","policy_id","time_stamp","session_id","client_intf","server_intf","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","username","hostname","method","domain","host","uri","referer","c2s_content_length","s2c_content_length","s2c_content_type","web_filter_lite_blocked","web_filter_blocked","web_filter_lite_flagged","web_filter_flagged","web_filter_lite_category","web_filter_category","web_filter_lite_reason","web_filter_reason","ad_blocker_action","ad_blocker_cookie_ident","virus_blocker_clean","virus_blocker_name","virus_blocker_lite_clean","virus_blocker_lite_name"]},getColumns:function(){return{c_client_port:{header:"Client Port".t(),width:this.columnWidth.port,renderer:function(e){return Ung.TableConfig.protocols[e]||e}},hostname:{header:"Hostname".t(),width:this.columnWidth.hostname},protocol:{header:"Protocol".t(),width:this.columnWidth.port,renderer:function(e){return Ung.TableConfig.protocols[e]||e}},s_server_addr:{header:"Server".t(),width:this.columnWidth.ip},s_server_port:{header:"Server Port".t(),width:this.columnWidth.port},session_id:{header:"Session Id".t()},time_stamp:{header:"Timestamp".t(),width:this.columnWidth.timestamp,renderer:function(e){var t=new Date(e.time);return Ext.Date.format(t,"M d, H:i:s.u")}},username:{header:"Username".t(),width:this.columnWidth.username}}},protocols:{0:"HOPOPT (0)",1:"ICMP (1)",2:"IGMP (2)",3:"GGP (3)",4:"IP-in-IP (4)",5:"ST (5)",6:"TCP (6)",7:"CBT (7)",8:"EGP (8)",9:"IGP (9)",10:"BBN-RCC-MON (10)",11:"NVP-II (11)",12:"PUP (12)",13:"ARGUS (13)",14:"EMCON (14)",15:"XNET (15)",16:"CHAOS (16)",17:"UDP (17)",18:"MUX (18)",19:"DCN-MEAS (19)",20:"HMP (20)",21:"PRM (21)",22:"XNS-IDP (22)",23:"TRUNK-1 (23)",24:"TRUNK-2 (24)",25:"LEAF-1 (25)",26:"LEAF-2 (26)",27:"RDP (27)",28:"IRTP (28)",29:"ISO-TP4 (29)",30:"NETBLT (30)",31:"MFE-NSP (31)",32:"MERIT-INP (32)",33:"DCCP (33)",34:"3PC (34)",35:"IDPR (35)",36:"XTP (36)",37:"DDP (37)",38:"IDPR-CMTP (38)",39:"TP++ (39)",40:"IL (40)",41:"IPv6 (41)",42:"SDRP (42)",43:"IPv6-Route (43)",44:"IPv6-Frag (44)",45:"IDRP (45)",46:"RSVP (46)",47:"GRE (47)",48:"MHRP (48)",49:"BNA (49)",50:"ESP (50)",51:"AH (51)",52:"I-NLSP (52)",53:"SWIPE (53)",54:"NARP (54)",55:"MOBILE (55)",56:"TLSP (56)",57:"SKIP (57)",58:"IPv6-ICMP (58)",59:"IPv6-NoNxt (59)",60:"IPv6-Opts (60)",62:"CFTP (62)",64:"SAT-EXPAK (64)",65:"KRYPTOLAN (65)",66:"RVD (66)",67:"IPPC (67)",69:"SAT-MON (69)",70:"VISA (70)",71:"IPCU (71)",72:"CPNX (72)",73:"CPHB (73)",74:"WSN (74)",75:"PVP (75)",76:"BR-SAT-MON (76)",77:"SUN-ND (77)",78:"WB-MON (78)",79:"WB-EXPAK (79)",80:"ISO-IP (80)",81:"VMTP (81)",82:"SECURE-VMTP (82)",83:"VINES (83)",84:"TTP (84)",85:"NSFNET-IGP (85)",86:"DGP (86)",87:"TCF (87)",88:"EIGRP (88)",89:"OSPF (89)",90:"Sprite-RPC (90)",91:"LARP (91)",92:"MTP (92)",93:"AX.25 (93)",94:"IPIP (94)",95:"MICP (95)",96:"SCC-SP (96)",97:"ETHERIP (97)",98:"ENCAP (98)",100:"GMTP (100)",101:"IFMP (101)",102:"PNNI (102)",103:"PIM (103)",104:"ARIS (104)",105:"SCPS (105)",106:"QNX (106)",107:"A/N (107)",108:"IPComp (108)",109:"SNP (109)",110:"Compaq-Peer (110)",111:"IPX-in-IP (111)",112:"VRRP (112)",113:"PGM (113)",115:"L2TP (115)",116:"DDX (116)",117:"IATP (117)",118:"STP (118)",119:"SRP (119)",120:"UTI (120)",121:"SMP (121)",122:"SM (122)",123:"PTP (123)",124:"IS-IS (124)",125:"FIRE (125)",126:"CRTP (126)",127:"CRUDP (127)",128:"SSCOPMCE (128)",129:"IPLT (129)",130:"SPS (130)",131:"PIPE (131)",132:"SCTP (132)",133:"FC (133)",134:"RSVP-E2E-IGNORE (134)",135:"Mobility (135)",136:"UDPLite (136)",137:"MPLS-in-IP (137)",138:"manet (138)",139:"HIP (139)",140:"Shim6 (140)",141:"WESP (141)",142:"ROHC (142)"}}),Ext.define("Ung.chart.EventChart",{extend:"Ext.grid.Panel",alias:"widget.eventchart",requires:["Ung.chart.EventChartController","Ung.util.TableConfig"],controller:"eventchart",viewModel:{stores:{store:{data:"{customData}"}}},plugins:"gridfilters",config:{entry:null},bind:{store:"{store}"},border:!1,initComponent:function(){var e,t=this,n=[],i=Ung.TableConfig.getColumns();Ung.TableConfig.table[t.getEntry().get("table")].forEach(function(a){e=i[a]||{header:a},Ext.apply(e,{dataIndex:a,hidden:!Ext.Array.contains(t.getEntry().get("defaultColumns"),a)}),n.push(e)}),Ext.apply(this,{columns:n}),this.callParent(arguments)}}),Ext.define("Ung.widget.Report",{extend:"Ext.container.Container",alias:"widget.reportwidget",requires:["Ung.widget.ReportModel","Ung.chart.TimeChart","Ung.chart.PieChart","Ung.chart.EventChart"],controller:"widget",viewModel:{type:"reportwidget"},config:{widget:null,entry:null},hidden:!0,bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},border:!1,baseCls:"widget adding",items:[{xtype:"component",cls:"header",itemId:"header",bind:{html:'{title}<button class="action-btn"><i class="material-icons" data-action="refresh">refresh</i></button>'}}],fetchData:function(){var e=this,t=this.getViewModel();if(t){var n=t.get("entry"),i=t.get("widget.timeframe");"EVENT_LIST"===n.get("type")?e.fireEvent("afterdata"):(this.lookupReference("chart").fireEvent("beginfetchdata"),Rpc.getReportData(n.getData(),i).then(function(t){e.fireEvent("afterdata"),e.lookupReference("chart").fireEvent("setseries",t.list)},function(t){e.fireEvent("afterdata"),e.lookupReference("chart").lookupReference("loader").hide(),console.log(t),e.down("#exception")&&e.remove("exception"),e.add({xtype:"component",itemId:"exception",cls:"exception",scrollable:!0,html:'<h3><i class="material-icons">error</i> <span>'+"Widget error".t()+"</span></h3><p>"+"There was an issue while fetching data!".t()+"</p>"})}))}}}),Ext.define("Ung.view.dashboard.Dashboard",{extend:"Ext.container.Container",xtype:"ung.dashboard",requires:["Ung.view.dashboard.DashboardController","Ung.view.dashboard.Queue","Ung.widget.Report","Ung.view.grid.ActionColumn","Ung.widget.WidgetController","Ung.widget.Information","Ung.widget.Resources","Ung.widget.CpuLoad","Ung.widget.NetworkInformation","Ung.widget.NetworkLayout","Ung.widget.MapDistribution"],controller:"dashboard",viewModel:!0,config:{settings:null},layout:"border",defaults:{border:!1},items:[{region:"north",weight:20,border:!1,height:44,itemId:"apps-topnav",bodyStyle:{background:"#555",padding:"0 5px"},layout:{type:"hbox",align:"middle"},defaults:{xtype:"button",baseCls:"heading-btn"},items:[{html:Ung.Util.iconTitle("Manage Widgets".t(),"settings-16"),handler:"managerHandler",bind:{hidden:"{managerOpen}"}},{xtype:"component",flex:1},{html:"Sessions".t(),href:"#sessions",hrefTarget:"_self"},{html:"Hosts".t(),href:"#hosts",hrefTarget:"_self"},{html:"Devices".t(),href:"#devices",hrefTarget:"_self"}]},{region:"west",weight:30,collapsible:!0,layout:{type:"vbox",align:"stretch"},header:!1,shadow:!1,animCollapse:!1,collapsed:!0,collapseMode:"mini",bind:{collapsed:"{!managerOpen}"},floatable:!1,cls:"widget-manager",split:{size:0},items:[{xtype:"container",cls:"heading",height:44,border:!1,layout:{type:"hbox",align:"stretch",pack:"center"},items:[{xtype:"component",flex:1,padding:10,html:"Manage Widgets".t()},{xtype:"button",width:44,baseCls:"manager-close-btn",html:'<i class="material-icons">close</i>',handler:"managerHandler"}]},{xtype:"grid",reference:"dashboardNav",forceFit:!0,flex:1,width:300,border:!1,header:!1,hideHeaders:!0,store:"widgets",bodyStyle:{border:0},viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to reorganize".t(),dragZone:{onBeforeDrag:function(e,t){return Ext.get(t.target).hasCls("drag-handle")}}},stripeRows:!1,getRowClass:function(e){return e.get("enabled")?"":"disabled"},listeners:{drop:"onDrop"}},columns:[{width:14,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,tdCls:"drag-handle"},{width:30,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,dataIndex:"enabled",renderer:"enableRenderer"},{dataIndex:"entryId",renderer:"widgetTitleRenderer"},{xtype:"actioncolumn",width:30,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,handler:"removeWidget",renderer:function(e,t,n){return'<i class="material-icons" style="color: #999; font-size: 20px;">close</i>'}}],listeners:{itemmouseleave:"onItemLeave",cellclick:"onItemClick"},tbar:[{itemId:"addWidgetBtn",text:Ung.Util.iconTitle("Add".t(),"add_circle-16")},"->",{text:Ung.Util.iconTitle("Import".t(),"file_download-16")},{text:Ung.Util.iconTitle("Export".t(),"file_upload-16")}],bbar:[{text:Ung.Util.iconTitle("Reset".t(),"replay-16"),handler:"resetDashboard"},"->",{text:Ung.Util.iconTitle("Apply".t(),"save-16"),handler:"applyChanges"}]}]},{xtype:"container",region:"center",reference:"dashboard",baseCls:"dashboard",padding:8,scrollable:!0}],listeners:{showwidgeteditor:"showWidgetEditor"}}),Ext.define("Ung.chart.NodeChartController",{extend:"Ext.app.ViewController",alias:"controller.nodechart",init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},onAfterRender:function(e){this.chart=new Highcharts.Chart({chart:{type:"areaspline",renderTo:e.lookupReference("nodechart").getEl().dom,marginBottom:15,marginRight:0,backgroundColor:"transparent",animation:!0,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,credits:{enabled:!1},xAxis:[{type:"datetime",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600},y:12},maxPadding:0,minPadding:0}],yAxis:{allowDecimals:!1,min:0,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",minRange:1,tickPixelInterval:30,tickLength:5,tickWidth:1,
showFirstLabel:!1,showLastLabel:!0,maxPadding:0,opposite:!1,labels:{align:"right",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:-10,y:5},title:{align:"high",offset:-10,y:3,text:"sessions",style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"10px",fontWeight:600}}},legend:{enabled:!1},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+=': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span> sessions",e+"<br/>"}},plotOptions:{areaspline:{fillOpacity:.15,lineWidth:1},spline:{lineWidth:2,softThreshold:!1},series:{marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}},series:[{data:function(){var e,t=[],n=Date.now();try{n=rpc.systemManager.getMilliseconds()}catch(e){console.log("Unable to get current millis.")}for(n=1e3*Math.round(n/1e3),e=-39;e<=0;e+=1)t.push({x:n+3e3*e,y:0});return t}()}]})},onResize:function(){this.chart.reflow()},onAddPoint:function(){var e=this.getViewModel().get("metrics").filter(function(e){return"live-sessions"===e.name})[0].value||0;this.chart.series[0].addPoint({x:Date.now(),y:e},!0,!0)}}),Ext.define("Ung.chart.NodeChart",{extend:"Ext.container.Container",alias:"widget.nodechart",requires:["Ung.chart.NodeChartController"],controller:"nodechart",viewModel:!0,listeners:{afterrender:"onAfterRender",addPoint:"onAddPoint"},items:[{xtype:"component",reference:"nodechart",width:400,height:150}]}),Ext.define("Ung.view.node.Status",{extend:"Ext.panel.Panel",xtype:"nodestatus",requires:["Ung.chart.NodeChart"],layout:{type:"vbox"},config:{summary:null,hasChart:null,hasMetrics:!0},defaults:{border:!1,xtype:"panel",baseCls:"status-item",padding:10,bodyPadding:"10 0 0 0"},title:"Status".t(),scrollable:!0,items:[],initComponent:function(){var e=this.getViewModel(),t=[{title:"Summary".t(),items:[{xtype:"component",bind:"{summary}"}]}];e.get("nodeProps.hasPowerButton")&&t.push({title:"Power".t(),items:[{xtype:"component",html:"test",bind:{html:"{powerMessage}"}},{xtype:"button",margin:"5 0",cls:"power-btn",bind:{text:"{powerButton}",userCls:"{nodeInstance.targetState}"},handler:"onPower"}]}),this.getHasChart()&&t.push({title:"Sessions".t(),items:[{xtype:"nodechart"}]}),this.getHasMetrics()&&t.push({title:"Metrics".t(),baseCls:"status-item",items:[{xtype:"grid",header:!1,hideHeaders:!0,baseCls:"metrics-grid",focusable:!1,width:300,border:!1,bodyBorder:!1,disableSelection:!0,trackMouseOver:!1,viewConfig:{stripeRows:!1},bind:{store:"{nodeMetrics}"},columns:[{dataIndex:"displayName",flex:1,align:"right",renderer:function(e){return e.t()+":"}},{dataIndex:"value"}]}]}),Ext.apply(this,{items:t}),this.callParent(arguments)}}),Ext.define("Ung.view.grid.EditorController",{extend:"Ext.app.ViewController",alias:"controller.ung.grideditor",onBeforeRender:function(e){var t=e.lookupReference("form"),n=e.getViewModel();e.columns.forEach(function(e){if("textfield"!==e.editorField&&"textarea"!==e.editorField||t.add({xtype:e.editorField,fieldLabel:e.text,labelAlign:"right",labelWidth:150,width:"100%",disabled:e.editDisabled,vtype:e.getEditor().vtype,allowBlank:!e.getEditor()||e.getEditor().allowBlank,emptyText:e.text,msgTarget:"under",bind:{value:"{record."+e.dataIndex+"}"}}),"checkbox"===e.editorField&&t.add({xtype:e.editorField,fieldLabel:e.text,labelAlign:"right",labelWidth:150,disabled:e.editDisabled,msgTarget:"under",bind:{value:"{record."+e.dataIndex+"}"}}),"action"===e.editorField){var i={showPriority:{get:function(e){return"SET_PRIORITY"===e("record.actionType")}},showPenalty:{get:function(e){return"PENALTY_BOX_CLIENT_HOST"===e("record.actionType")}},showQuota:{get:function(e){return"GIVE_CLIENT_HOST_QUOTA"===e("record.actionType")}}};n.setFormulas(i),n.bind({bindTo:"{record.actionType}"},function(e){"SET_PRIORITY"===e&&n.set("record.actionPriority",1),"GIVE_CLIENT_HOST_QUOTA"===e&&n.set("record.actionQuotaTime",-3)}),t.add([{xtype:"component",padding:"10 0 5 0",margin:"0 0 0 155",style:{fontWeight:"bold"},html:"Perform the following action:".t()},{xtype:"combo",fieldLabel:"Action Type".t(),labelAlign:"right",labelWidth:150,width:400,displayField:"displayName",valueField:"name",msgTarget:"under",editable:!1,bind:"{record.actionType}",queryMode:"local",store:Ext.create("Ext.data.Store",{fields:["name","displayName"],data:[{name:"SET_PRIORITY",displayName:"Set Priority".t()},{name:"PENALTY_BOX_CLIENT_HOST",displayName:"Send Client to Penalty Box".t()},{name:"GIVE_CLIENT_HOST_QUOTA",displayName:"Give Client a Quota".t()}]})},{xtype:"combo",fieldLabel:"Priority".t(),labelAlign:"right",labelWidth:150,width:300,displayField:"displayName",valueField:"value",msgTarget:"under",editable:!1,hidden:!0,bind:{value:"{record.actionPriority}",hidden:"{!showPriority}",disabled:"{!showPriority}"},store:Ext.create("Ext.data.Store",{fields:["value","displayName"],data:[{value:1,displayName:"Very High".t()},{value:2,displayName:"High".t()},{value:3,displayName:"Medium".t()},{value:4,displayName:"Low".t()},{value:5,displayName:"Limited".t()},{value:6,displayName:"Limited More".t()},{value:7,displayName:"Limited Severely".t()}]})},{xtype:"numberfield",fieldLabel:"Penalty Time".t(),labelAlign:"right",labelWidth:150,width:250,hidden:!0,bind:{hidden:"{!showPenalty}",disabled:"{!showPenalty}",value:"{record.actionPenaltyTime}"}},{xtype:"combo",fieldLabel:"Quota Expiration".t(),labelAlign:"right",labelWidth:150,displayField:"displayName",valueField:"value",msgTarget:"under",editable:!1,hidden:!0,bind:{hidden:"{!showQuota}",disabled:"{!showQuota}",value:"{record.actionQuotaTime}"},store:Ext.create("Ext.data.Store",{fields:["value","displayName"],data:[{value:-3,displayName:"End of Week".t()},{value:-2,displayName:"End of Day".t()},{value:-1,displayName:"End of Hour".t()}]})},{xtype:"container",hidden:!0,layout:{type:"hbox"},bind:{hidden:"{!showQuota}",disabled:"{!showQuota}"},items:[{xtype:"numberfield",fieldLabel:"Quota Size".t(),labelAlign:"right",labelWidth:150,width:250,bind:{value:"{record.actionQuotaBytes}"}},{xtype:"combo",displayField:"unit",valueField:"value",editable:!1,value:1,width:100,margin:"0 0 0 5",store:Ext.create("Ext.data.Store",{fields:["value","unit"],data:[{value:1,unit:"bytes".t()},{value:1e3,unit:"Kilobytes".t()},{value:1e6,unit:"Megabytes".t()},{value:1e9,unit:"Gigabytes".t()},{value:1e12,unit:"Terrabytes".t()}]})}]}])}"conditions"===e.editorField&&(console.log(n.get("record.conditions")),t.add([{xtype:"component",padding:"10 0 5 0",margin:"0 0 0 155",style:{fontWeight:"bold"},html:"If all of the following conditions are met:".t()},{xtype:"ung.gridconditions",margin:"0 0 0 155",viewModel:{stores:{store:{model:"Ung.model.Condition",data:"{record."+e.dataIndex+"}"}}}}]))})},onSave:function(){this.getView().setCloseAction("save"),this.getView().close()},onCancel:function(){this.getView().setCloseAction("cancel"),this.getView().close()}}),Ext.define("Ung.model.Rule",{extend:"Ext.data.Model",fields:[{name:"name",type:"string",defaultValue:null},{name:"string",type:"string",defaultValue:""},{name:"blocked",type:"boolean",defaultValue:!0},{name:"flagged",type:"boolean",defaultValue:!0},{name:"category",type:"string",defaultValue:null},{name:"description",type:"string",defaultValue:""},{name:"enabled",type:"boolean",defaultValue:!0},{name:"id",defaultValue:null},{name:"readOnly",type:"boolean",defaultValue:null},{name:"javaClass",type:"string",defaultValue:"com.untangle.node.bandwidth_control.BandwidthControlRule"},{name:"ruleId",type:"int",defaultValue:null},{name:"action",type:"auto"},{name:"actionType",type:"string",mapping:"action.actionType",defaultValue:"SET_PRIORITY"},{name:"actionPriority",type:"int",mapping:"action.priority",defaultValue:1},{name:"actionPenaltyTime",type:"int",mapping:"action.penaltyTime",defaultValue:0},{name:"actionQuotaBytes",type:"int",mapping:"action.quotaBytes",defaultValue:1},{name:"actionQuotaTime",type:"int",mapping:"action.quotaTime",defaultValue:-1}],hasMany:"Ung.model.Condition",proxy:{autoLoad:!0,type:"memory",reader:{type:"json",rootProperty:"list"}}}),Ext.define("Ung.model.Condition",{extend:"Ext.data.Model",fields:[{name:"conditionType",type:"string",defaultValue:"DST_ADDR"},{name:"invert",type:"boolean",defaultValue:!1},{name:"javaClass",type:"string",defaultValue:"com.untangle.node.bandwidth_control.BandwidthControlRuleCondition"},{name:"value",type:"auto",defaultValue:""}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json",rootProperty:"list"}}}),Ext.define("Ung.view.grid.Editor",{extend:"Ext.window.Window",requires:["Ung.view.grid.EditorController","Ung.model.Rule","Ung.model.Condition"],controller:"ung.grideditor",config:{closeAction:void 0},modal:!0,draggable:!1,resizable:!1,bodyStyle:{background:"#FFF"},layout:"fit",items:[{xtype:"form",padding:10,layout:{type:"anchor"},border:0,reference:"form",buttons:[{text:Ung.Util.iconTitle("Cancel","cancel-16"),handler:"onCancel"},{text:Ung.Util.iconTitle("Done","check-16"),formBind:!0,disabled:!0,handler:"onSave"}],listeners:{}}],listeners:{beforeRender:"onBeforeRender"}}),Ext.define("Ung.view.grid.Grid",{extend:"Ext.grid.Panel",xtype:"ung.grid",requires:["Ung.view.grid.GridController","Ung.view.grid.Editor"],controller:"ung.grid",config:{toolbarFeatures:null,columnFeatures:null,inlineEdit:null,dataProperty:null},bind:{store:"{store}"},resizable:!1,bodyBorder:!1,viewConfig:{plugins:[],stripeRows:!1,getRowClass:function(e){return e.markDelete?"delete":e.dirty?"dirty":void 0}},listeners:{beforedestroy:"onBeforeDestory",save:"onSave"},initComponent:function(){var e=this.getColumnFeatures(),t=[];Ext.Array.contains(e,"edit")&&t.push({xtype:"ung.actioncolumn",text:"Edit".t(),align:"center",width:50,sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,materialIcon:"edit",handler:"editRecord",editor:!1,type:"edit"}),Ext.Array.contains(e,"delete")&&t.push({xtype:"ung.actioncolumn",text:"Delete".t(),align:"center",width:50,sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,materialIcon:"delete",handler:"deleteRecord",type:"delete"}),Ext.Array.contains(e,"select")&&(this.selModel={type:"checkboxmodel"}),Ext.Array.contains(e,"reorder")&&(this.sortableColumns=!1,Ext.apply(this,{viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to reorganize".t(),dragZone:{onBeforeDrag:function(e,t){return Ext.get(t.target).hasCls("draggable")}}}}}),t.unshift({xtype:"ung.actioncolumn",align:"center",width:30,sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,dragEnabled:!0,materialIcon:"more_vert"})),this.columns=this.columns.concat(t),this.callParent(arguments)}}),Ext.define("Ung.view.grid.ConditionEditorController",{extend:"Ext.app.ViewController",alias:"controller.ung.conditioneditor",init:function(e){console.log(this.getViewModel()),this.getViewModel().bind({bindTo:"{condition}",single:!0},function(e){console.log(e)})},onCancel:function(){this.getView().close()},onConditionTypeChange:function(e,t,n){var i=(this.getViewModel(),this.getView().lookupReference("form")),a=e.getStore().findRecord("name",t),o=a.get("editorType"),r=a.get("vtype");switch(i.down("#condType")&&i.remove("condType",!0),o){case"textfield":i.add({xtype:o,id:"condType",margin:"0 5 0 5",allowBlank:!1,vtype:r,bind:{value:"{condition.value}"}});break;case"countryselector":i.add({xtype:"tagfield",id:"condType",margin:"0 5 0 5",store:"countries",queryMode:"local",typeAhead:!0,filterPickList:!0,displayField:"name",valueField:"code",clearFilterOnEnter:!0,bind:{value:"{condition.value}"}})}}}),Ext.define("Ung.view.grid.ConditionEditor",{extend:"Ext.window.Window",requires:["Ung.view.grid.ConditionEditorController"],controller:"ung.conditioneditor",modal:!0,draggable:!1,resizable:!1,layout:"fit",border:!1,bodyBorder:!1,bodyStyle:{background:"#FFF"},items:[{xtype:"form",reference:"form",padding:0,border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"combo",store:"conditions",margin:5,valueField:"name",displayField:"displayName",editable:!1,bind:{value:"{condition.conditionType}"},listeners:{change:"onConditionTypeChange"}},{xtype:"container",items:[{xtype:"segmentedbutton",margin:"0 0 5 5",bind:{value:"{condition.invert}"},items:[{text:"IS",value:!1},{text:"IS NOT",value:!0}]}]}],buttons:[{text:Ung.Util.iconTitle("Cancel","cancel-16"),handler:"onCancel"},{text:Ung.Util.iconTitle("Done","check-16"),formBind:!0}]}]}),Ext.define("Ung.view.grid.Conditions",{extend:"Ext.grid.Panel",xtype:"ung.gridconditions",layout:"column",requires:["Ung.view.grid.ConditionsController","Ung.store.Conditions","Ung.store.Countries","Ung.view.grid.ConditionEditor"],controller:"ung.gridconditions",viewModel:!0,config:{conditions:null},bind:{store:"{store}"},resizable:!1,bodyBorder:!1,columns:[{text:"Type".t(),dataIndex:"conditionType",width:250,menuDisabled:!0,hideable:!1,sortable:!1,renderer:"typeRenderer",editor:{xtype:"combo",store:"conditions",valueField:"name",displayField:"displayName",editable:!1,listeners:{change:"onChange"}}},{width:80,menuDisabled:!0,hideable:!1,sortable:!1,resizable:!1,dataIndex:"invert",renderer:function(e){return e?"is NOT".t():"is".t()}},{text:"Value".t(),flex:1,menuDisabled:!0,hideable:!1,sortable:!1,dataIndex:"value",renderer:"valueRenderer"},{xtype:"ung.actioncolumn",text:"Delete".t(),align:"center",width:50,sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,materialIcon:"delete"}],tbar:[{text:Ung.Util.iconTitle("Add Condition","add-16"),handler:"onAddCondition"}],listeners:{select:"onConditionSelect",beforerender:"onBeforeRender"}}),Ext.define("Ung.view.node.Settings",{extend:"Ext.panel.Panel",xtype:"ung.nodesettings",layout:"border",requires:["Ung.view.node.SettingsController","Ung.view.node.SettingsModel","Ung.view.node.Status","Ung.view.node.Reports","Ung.util.Util","Ung.model.NodeMetric","Ung.view.grid.Grid","Ung.view.grid.Conditions","Ung.view.grid.ActionColumn","Ung.model.GenericRule"],controller:"nodesettings",viewModel:{type:"nodesettings"},border:!1,defaults:{border:!1},items:[{region:"north",border:!1,height:44,layout:{type:"hbox",align:"middle"},bodyStyle:{background:"#555",padding:"0 5px",color:"#FFF",lineHeight:"44px"},items:[{xtype:"button",text:"Back to Apps".t(),hrefTarget:"_self",bind:{href:"#apps/{policyId}"}},{xtype:"component",margin:"0 0 0 10",bind:{html:"{nodeProps.displayName}"}}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"button",text:Ung.Util.iconTitle("Remove","remove_circle-16"),handler:"removeNode"},{xtype:"button",text:Ung.Util.iconTitle("Save","save-16"),handler:"saveSettings"}]}]}),Ext.define("Ung.view.main.Main",{extend:"Ext.container.Viewport",plugins:["viewport"],requires:["Ext.plugin.Viewport","Ung.view.main.MainController","Ung.view.main.MainModel","Ung.view.dashboard.Dashboard","Ung.view.apps.Apps","Ung.view.apps.install.Install","Ung.view.config.Config","Ung.view.reports.Reports","Ung.view.node.Settings","Ung.view.shd.Sessions","Ung.view.shd.Hosts","Ung.view.shd.Devices"],controller:"main",viewModel:{type:"main"},layout:"border",border:!1,items:[{region:"north",layout:{type:"hbox",align:"middle"},border:!1,height:66,ui:"navigation",items:[{xtype:"container",layout:{type:"hbox",align:"middle"},defaults:{xtype:"button",enableToggle:!0,baseCls:"nav-item",height:30,hrefTarget:"_self"},items:[{enableToggle:!1,html:'<img src="'+resourcesBaseHref+'/images/BrandingLogo.png" style="height: 40px;"/>',width:100,height:40,href:"#"},{html:Ung.Util.iconTitle("Dashboard".t(),"home-16"),href:"#",bind:{pressed:"{isDashboard}"}},{html:Ung.Util.iconTitle("Apps".t(),"apps-16"),bind:{href:"#apps/{policyId}",pressed:"{isApps}"}},{html:Ung.Util.iconTitle("Config".t(),"tune-16"),href:"#config",bind:{pressed:"{isConfig}"}},{html:Ung.Util.iconTitle("Reports".t(),"show_chart-16"),href:"#reports",bind:{hidden:"{!reportsEnabled}",pressed:"{isReports}"}}]}]},{xtype:"container",region:"center",layout:"card",itemId:"main",border:!1,bind:{activeItem:"{activeItem}"},items:[]}]}),Ext.define("Ung.store.Metrics",{extend:"Ext.data.Store",storeId:"metrics",proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Hosts",{extend:"Ext.data.Store",storeId:"hosts",fields:[{name:"address",type:"string"}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Categories",{extend:"Ext.data.Store",storeId:"categories",model:"Ung.model.Category"}),Ext.define("Ung.store.UnavailableApps",{extend:"Ext.data.Store",storeId:"unavailableApps",alias:"store.unavailableApps",proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.model.Policy",{extend:"Ext.data.Model",fields:[{name:"policyId",type:"int"},{name:"displayName",type:"string",convert:function(e,t){return"Policy "+t.get("policyId")}}],hasMany:{model:"Ung.model.NodeProperty",name:"nodeProperties"},proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Policies",{extend:"Ext.data.Store",alias:"store.policies",storeId:"policies",model:"Ung.model.Policy"}),Ext.define("Ung.model.Stat",{extend:"Ext.data.Model",proxy:{type:"memory",reader:{type:"json"}},fields:["numCpus","cpuModel","MemFree","MemTotal","SwapFree","SwapTotal","freeDiskSpace","totalDiskSpace","uptime",{name:"hostname",calculate:function(){return rpc.hostname}},{name:"version",calculate:function(){return rpc.fullVersion}},{name:"appliance",calculate:function(){return void 0===rpc.applianceModel||null===rpc.applianceModel||""===rpc.applianceModel?"custom".t():rpc.applianceModel}},{name:"totalMemory",calculate:function(e){return Ung.Util.formatBytes(e.MemTotal,2)}},{name:"freeMemory",calculate:function(e){return Ung.Util.formatBytes(e.MemFree,2)}},{name:"freeMemoryPercent",calculate:function(e){return(e.MemFree/e.MemTotal*100).toFixed(1)}},{name:"usedMemory",calculate:function(e){return Ung.Util.formatBytes(e.MemTotal-e.MemFree,2)}},{name:"usedMemoryPercent",calculate:function(e){return(100*(1-e.MemFree/e.MemTotal)).toFixed(1)}},{name:"totalSwap",calculate:function(e){return Ung.Util.formatBytes(e.SwapTotal,2)}},{name:"freeSwap",calculate:function(e){return Ung.Util.formatBytes(e.SwapFree,2)}},{name:"freeSwapPercent",calculate:function(e){return(e.SwapFree/e.SwapTotal*100).toFixed(1)}},{name:"usedSwap",calculate:function(e){return Ung.Util.formatBytes(e.SwapTotal-e.SwapFree,2)}},{name:"usedSwapPercent",calculate:function(e){return(100*(1-e.SwapFree/e.SwapTotal)).toFixed(1)}},{name:"totalDisk",calculate:function(e){return Ung.Util.formatBytes(e.totalDiskSpace,2)}},{name:"freeDisk",calculate:function(e){return Ung.Util.formatBytes(e.freeDiskSpace,2)}},{name:"freeDiskPercent",calculate:function(e){return(e.freeDiskSpace/e.totalDiskSpace*100).toFixed(1)}},{name:"usedDisk",calculate:function(e){return Ung.Util.formatBytes(e.totalDiskSpace-e.freeDiskSpace,2)}},{name:"usedDiskPercent",calculate:function(e){return(100*(1-e.freeDiskSpace/e.totalDiskSpace)).toFixed(1)}},{name:"uptimeFormatted",calculate:function(e){var t=Math.floor(e.uptime%31536e3/86400),n=Math.floor(e.uptime%31536e3%86400/3600),i=Math.floor(e.uptime%31536e3%86400%3600/60),a="";return t>0&&(a+=t+"d "),n>0&&(a+=n+"h "),i>0&&(a+=i+"m"),a}}]}),Ext.define("Ung.store.Stats",{extend:"Ext.data.Store",alias:"store.stats",storeId:"stats",model:"Ung.model.Stat"}),Ext.define("Ung.model.Report",{extend:"Ext.data.Model",fields:["category","colors","conditions","defaultColumns","description","displayOrder","enabled","javaClass","orderByColumn","orderDesc","pieGroupColumn","pieNumSlices","pieStyle","pieSumColumn","readOnly","seriesRenderer","table","textColumns","textString","timeDataColumns","timeDataDynamicAggregationFunction","timeDataDynamicAllowNull","timeDataDynamicColumn","timeDataDynamicLimit","timeDataDynamicValue","timeDataInterval","timeStyle","title","type","uniqueId","units"],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Reports",{extend:"Ext.data.Store",storeId:"reports",model:"Ung.model.Report",sorters:[{property:"displayOrder",direction:"ASC"}]}),Ext.define("Ung.model.Widget",{extend:"Ext.data.Model",fields:[{name:"displayColumns",type:"auto",default:null},{name:"enabled",type:"auto",default:!0},{name:"entryId",type:"auto",default:null},{name:"javaClass",type:"string",defaultValue:"com.untangle.uvm.DashboardWidgetSettings"},{name:"refreshIntervalSec",type:"auto",default:null},{name:"timeframe",type:"auto",default:null},{name:"type",type:"string"}],proxy:{type:"memory",reader:{type:"json",rootProperty:"list"}}}),Ext.define("Ung.store.Widgets",{extend:"Ext.data.Store",alias:"store.widgets",storeId:"widgets",model:"Ung.model.Widget"}),Ext.define("Ung.model.Session",{extend:"Ext.data.Model",fields:[{name:"protocol",type:"string"},{name:"clientKBps",type:"number",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"serverKBps",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"totalKBps",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"clientIntf",convert:function(e){return!e||e<0?"":e}},{name:"serverIntf",convert:function(e){return!e||e<0?"":e}}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Sessions",{extend:"Ext.data.Store",storeId:"sessions",model:"Ung.model.Session"}),Ext.define("Ung.Application",{extend:"Ext.app.Application",autoCreateViewport:!1,name:"Ung",rpc:null,requires:["Ung.rpc.Rpc","Ung.util.Util","Ung.util.Metrics","Ung.view.main.Main","Ung.overrides.form.field.VTypes"],stores:["Policies","Metrics","Stats","Reports","Widgets","Sessions","Hosts","Conditions","Countries","Categories","UnavailableApps"],defaultToken:"",init:function(){},launch:function(){var e=this;Rpc.rpc=e.rpc,Ext.getStore("policies").loadData(e.rpc.appsViews),Ung.util.Metrics.start(),Ext.Deferred.parallel([Rpc.getDashboardSettings,Rpc.getReports,Rpc.getUnavailableApps]).then(function(t){Ext.get("app-loader").destroy(),Ung.dashboardSettings=t[0],Ext.getStore("widgets").loadData(t[0].widgets.list),t[1]&&Ext.getStore("reports").loadData(t[1].list),t[2]&&Ext.getStore("unavailableApps").loadRawData(t[2].map),e.loadMainView()},function(e){console.log(e)})},loadMainView:function(){Ung.util.Metrics.start();try{Ung.app.setMainView("Ung.view.main.Main")}catch(e){return console.error(e),void Ung.Util.exceptionToast(e)}}});