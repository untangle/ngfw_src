Ext.define("Ung.rpc.Rpc",{alternateClassName:"Rpc",singleton:!0,getDashboardSettings:function(){console.time("dashboardSettings");var e=new Ext.Deferred;return this.rpc.dashboardManager.getSettings(function(t,n){console.timeEnd("dashboardSettings"),n&&e.reject(n),e.resolve(t)}),e.promise},getReports:function(){console.time("loadReports");var e=new Ext.Deferred;return this.rpc.nodeManager.node("untangle-node-reports")?(this.rpc.reportsManager=this.rpc.nodeManager.node("untangle-node-reports").getReportsManager(),this.rpc.reportsManager.getReportEntries(function(t,n){console.timeEnd("loadReports"),n&&e.reject(n),e.resolve(t)})):e.resolve(null),e.promise},getUnavailableApps:function(){console.time("unavailApps");var e=new Ext.Deferred;return rpc.reportsManager?rpc.reportsManager.getUnavailableApplicationsMap(function(t,n){console.timeEnd("unavailApps"),n&&e.reject(n),e.resolve(t)}):e.resolve(null),e.promise},getReportData:function(e,t){var n=new Ext.Deferred;return this.rpc.reportsManager.getDataForReportEntry(function(e,t){t&&n.reject(t),n.resolve(e)},e,t,-1),n.promise},getRpcNode:function(e){var t=new Ext.Deferred;return this.rpc.nodeManager.node(function(e,n){n&&t.reject(n),t.resolve(e)},e),t.promise},getNodeSettings:function(e){var t=new Ext.Deferred;return e.getSettings(function(e,n){n&&t.reject(n),t.resolve(e)}),t.promise},setNodeSettings:function(e,t){console.log(t);var n=new Ext.Deferred;return e.setSettings(function(e,t){console.log(e),t&&n.reject(t),n.resolve(e)},t),n.promise},readRecords:function(){return console.log("read"),{}}}),Ext.define("Ung.util.Util",{alternateClassName:"Ung.Util",singleton:!0,nodeClassMapping:{"untangle-node-web-filter":"Ung.node.WebFilter","untangle-node-web-filter-lite":"Ung.node.WebFilterLite","untangle-node-virus-blocker":"Ung.node.VirusBlocker","untangle-node-virus-blocker-lite":"Ung.node.VirusBlockerLite","untangle-node-spam-blocker":"Ung.node.SpamBlocker","untangle-node-spam-blocker-lite":"Ung.node.SpamBlockerLite","untangle-node-phish-blocker":"Ung.node.PhishBlocker","untangle-node-web-cache":"Ung.node.WebCache","untangle-node-bandwidth-control":"Ung.node.BandwidthControl","untangle-casing-ssl-inspector":"Ung.node.SslInspector","untangle-node-application-control":"Ung.node.ApplicationControl","untangle-node-application-control-lite":"Ung.node.ApplicationControlLite","untangle-node-captive-portal":"Ung.node.CaptivePortal","untangle-node-firewall":"Ung.node.Firewall","untangle-node-ad-blocker":"Ung.node.AdBlocker","untangle-node-reports":"Ung.node.Reports"},iconTitle:function(e,t){var n=t.split("-")[0],a=t.split("-")[1]||24;return'<i class="material-icons" style="font-size: '+a+'px">'+n+'</i> <span style="vertical-align: middle;">'+e+"</span>"},iconReportTitle:function(e){var t;switch(e.get("type")){case"TEXT":t="subject";break;case"EVENT_LIST":t="format_list_bulleted";break;case"PIE_GRAPH":t="pie_chart","COLUMN"===e.get("pieStyle")||"COLUMN_3D"===e.get("pieStyle")?t="insert_chart":"DONUT"!==e.get("pieStyle")&&"DONUT_3D"!==e.get("pieStyle")||(t="donut_large");break;case"TIME_GRAPH":case"TIME_GRAPH_DYNAMIC":t=e.get("timeStyle").indexOf("BAR")>=0?"insert_chart":"show_chart";break;default:t="subject"}return'<i class="material-icons" style="font-size: 18px">'+t+"</i>"},bytesToHumanReadable:function(e,t){var n=t?1e3:1024;if(Math.abs(e)<n)return e+" B";var a=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],i=-1;do e/=n,++i;while(Math.abs(e)>=n&&i<a.length-1);return e.toFixed(1)+" "+a[i]},formatBytes:function(e,t){if(0===e)return"0";var n=1e3,a=t||3,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],o=Math.floor(Math.log(e)/Math.log(n));return parseFloat((e/Math.pow(n,o)).toFixed(a))+" "+i[o]},successToast:function(e){Ext.toast({html:this.iconTitle(e,"check-20"),bodyPadding:"8 10",baseCls:"toast",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:30,paddingY:50})},exceptionToast:function(e){Ext.toast({html:this.iconTitle('<span style="color: #FFF; font-weight: bold;">Exception!</span> '+e,"error-20"),bodyPadding:"10",baseCls:"toast",cls:"exception",border:!1,bodyBorder:!1,align:"br",autoCloseDelay:5e3,slideInAnimation:"easeOut",slideInDuration:300,hideDuration:0,paddingX:30,paddingY:50})},urlValidator:function(e){var t=e.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&\/\/=]*)/g);return!!t||"Url missing or in wrong format!".t()},getClassOrder:function(){var e=[],t=[];Ext.Loader.history.forEach(function(n){0===n.indexOf("Ung")?e.push(n.replace("Ung","app").replace(/\./g,"/")+".js"):t.push(n)}),e.pop(),Ext.create("Ext.Window",{title:"Untangle Classes Load Order",width:600,height:600,modal:!0,draggable:!1,resizable:!1,layout:{type:"hbox",align:"stretch",pack:"end"},items:[{xtype:"textarea",border:!1,flex:1,editable:!1,fieldStyle:{background:"#FFF",fontSize:"11px"},value:e.join("\r\n")},{xtype:"textarea",border:!1,flex:1,editable:!1,fieldStyle:{background:"#FFF",fontSize:"11px"},value:t.join("\r\n")}]}).show()},getInterfaceListSystemDev:function(e,t,n){var a=[];return n?a.push(["tun0","OpenVPN"]):(a.push([250,"OpenVPN"]),a.push([251,"L2TP"]),a.push([252,"Xauth"]),a.push([253,"GRE"])),e&&(a.unshift(["wan","Any WAN".t()]),a.unshift(["non_wan","Any Non-WAN".t()])),t&&a.unshift(["any","Any".t()]),a},getInterfaceList:function(e,t){return this.getInterfaceListSystemDev(e,t,!1)}}),Ext.define("Ung.util.Metrics",{singleton:!0,frequency:1e4,interval:null,running:!1,start:function(){var e=this;e.stop(),e.run(),e.interval=window.setInterval(function(){e.run()},e.frequency)},stop:function(){null!==this.interval&&window.clearInterval(this.interval)},run:function(){var e=[];rpc.metricManager.getMetricsAndStats(Ext.bind(function(t,n){n&&console.log(n),e=[],Ext.getStore("stats").loadRawData(t.systemStats);for(var a in t.metrics)t.metrics.hasOwnProperty(a)&&e.push({nodeId:a,metrics:t.metrics[a]});Ext.getStore("metrics").loadData(e)}))}}),Ext.define("Ung.overrides.form.field.VTypes",{override:"Ext.form.field.VTypes",validators:function(){},ipall:function(e){if(e.indexOf("/")===-1&&e.indexOf(",")===-1&&e.indexOf("-")===-1)switch(e){case"any":return!0;default:return this.ip4(e)}return e.indexOf(",")!==-1?this.ipList(e):e.indexOf("-")!==-1?this.ipRange(e):e.indexOf("/")!==-1?this.cidrRange(e)||this.ipNetmask(e):(console.log("Unhandled case while handling vtype for ipAddr:",e," returning true!"),!0)},ipallText:"Invalid IP Address.".t(),ip:function(e){return this.ip4Re.test(e)||this.ip6Re.test(e)},ipText:"Invalid IP Address.".t(),ip4:function(e){return this.ip4Re.test(e)},ip4Re:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ip4Text:"Invalid IPv4 Address.".t(),ip6:function(e){return this.ip6Re.test(e)},ip6Re:"/^s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]d|1dd|[1-9]?d)(.(25[0-5]|2[0-4]d|1dd|[1-9]?d)){3}))|:)))(%.+)?s*$/",ip6Text:"Invalid IPv6 Address.".t(),ip4List:function(e){var t,n=e.split(",");for(t=0;t<n.length;t++)if(!this.ip4Re.test(n[t]))return!1;return!0},ip4ListText:"Invalid IPv4 Address(es).".t(),mac:function(e){return this.macRe.test(e)},macRe:/^[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}:[a-fA-F0-9]{2}$/,macText:"Invalid Mac Address.".t(),cidr:function(e){return this.cidrRe.test(e)},cidrRe:/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\/\d{1,2}$/,cidrText:"Must be a network in CIDR format.".t()+" (192.168.123.0/24)",cidrList:function(e){var t,n=e.split(",");for(t=0;t<n.length;t++)if(!this.cidrRe.test(n[t]))return!1;return!0},cidrListText:"Must be a comma seperated list of networks in CIDR format.".t()+" (192.168.123.0/24,1.2.3.4/24)",cidrBlock:function(e){var t,n=e.split("\n");for(t=0;t<n.length;t++)if(!this.cidrRe.test(n[t]))return!1;return!0},cidrBlockText:"Must be a one-per-line list of networks in CIDR format.".t()+" (192.168.123.0/24)",port:function(e){var t=1,n=65535;return e>=t&&e<=n},portText:Ext.String.format("The port must be an integer number between {0} and {1} or one of the following values: any, all, n/a, none.".t(),1,65535),ipRange:function(e){return this.ipRangeRe.test(e)},ipRangeRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)-(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipRangeText:"Invalid IP range".t(),cidrRange:function(e){return this.cidrRangeRe.test(e)},cidrRangeRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/[0-3]?[0-9]$/,ipNetmask:function(e){return this.cidrRangeRe.test(e)},ipNetmaskRe:/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipList:function(e){for(var t=e.split(","),n=!0,a=0;a<t.length;a++)if(n=t[a].indexOf("-")!==-1?n&&this.ipRange(t[a]):t[a].indexOf("/")!==-1?n&&(this.cidRange(t[a])||this.ipNetmask(t[a])):n&&this.ip4(t[a]),!n)return!1;return!0}}),Ext.define("Ung.view.main.MainController",{extend:"Ext.app.ViewController",alias:"controller.main",control:{"#":{beforerender:"onBeforeRender"}},init:function(e){var t=e.getViewModel();t.set("reports",Ext.getStore("reports")),t.set("policyId",1)},onBeforeRender:function(e){var t=e.getViewModel();t.set("reportsInstalled",null!==rpc.nodeManager.node("untangle-node-reports")),rpc.nodeManager.node("untangle-node-reports")&&t.set("reportsRunning","RUNNING"===rpc.nodeManager.node("untangle-node-reports").getRunState()),t.notify(),e.getViewModel().set("policies",Ext.getStore("policies")),e.getViewModel().set("policy",Ext.getStore("policies").findRecord("policyId",1))},onDashboard:function(){console.log("on dashboard"),this.getViewModel().set("activeItem","dashboard")},onApps:function(e,t){console.log("on apps");var n=this.getViewModel();n.get("policyId");n.set("policyId",e),t?"install"===t?n.set("activeItem","appsinstall"):(n.set("nodeName",t),n.set("activeItem","settings")):n.set("activeItem","apps")},onConfig:function(e){this.getViewModel().set("activeItem","config");var t=this.getView();this.getViewModel().set("activeItem","config"),e?Ext.require("Ung.view.config.network.Network",function(){t.down("#config").add({xtype:"ung.config.network"}),t.down("#config").setActiveItem(1)}):t.down("#config").setActiveItem(0)},onReports:function(){this.getViewModel().set("activeItem","reports")},onSessions:function(){this.getViewModel().set("activeItem","sessions")},onHosts:function(){this.setShd("hosts")},onDevices:function(){this.setShd("devices")},setShd:function(e){this.getViewModel().set("activeItem","shd"),this.getViewModel().set("shdActiveItem",e),this.getView().down("#shdcenter").setActiveItem(e)}}),Ext.define("Ung.view.main.MainModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.main",data:{reportsInstalled:!1,reportsRunning:!1},formulas:{reportsEnabled:function(e){return e("reportsInstalled")&&e("reportsRunning")},isDashboard:function(e){return"dashboard"===e("activeItem")},isApps:function(e){return"apps"===e("activeItem")},isConfig:function(e){return"config"===e("activeItem")},isReports:function(e){return"reports"===e("activeItem")},isSessions:function(e){return"sessions"===e("shdActiveItem")},isHosts:function(e){return"hosts"===e("shdActiveItem")},isDevices:function(e){return"devices"===e("shdActiveItem")}}}),Ext.define("Ung.view.dashboard.DashboardController",{extend:"Ext.app.ViewController",alias:"controller.dashboard",viewModel:!0,control:{"#":{}},listen:{global:{init:"loadWidgets",nodeinstall:"onNodeInstall",removewidget:"onRemoveWidget",addwidget:"onAddWidget",reportsInstall:"loadWidgets"},store:{"#stats":{datachanged:"onStatsUpdate"},"#widgets":{},"#reports":{}}},init:function(e){var t=e.getViewModel();t.set("managerOpen",!1)},onInit:function(){console.log("oninit")},initDashboard:function(){var e=this;e.getViewModel()},loadWidgets:function(){var e,t,n,a=this.getViewModel(),i=this.getView().lookupReference("dashboard"),o=Ext.getStore("widgets").getRange();for(this.getView().lookupReference("dashboardNav").getView().refresh(),i.removeAll(!0),e=0;e<o.length;e+=1)t=o[e],"ReportEntry"!==t.get("type")?i.add({xtype:t.get("type").toLowerCase()+"widget",itemId:t.get("type"),viewModel:{data:{widget:t}}}):a.get("reportsEnabled")?(n=Ext.getStore("reports").findRecord("uniqueId",t.get("entryId")),n&&!Ext.getStore("unavailableApps").first().get(n.get("category"))&&t.get("enabled")?i.add({xtype:"reportwidget",itemId:t.get("entryId"),refreshIntervalSec:t.get("refreshIntervalSec"),viewModel:{data:{widget:t,entry:n}}}):i.add({xtype:"component",itemId:t.get("entryId"),hidden:!0})):i.add({xtype:"component",itemId:t.get("entryId"),hidden:!0});console.timeEnd("all")},onNodeInstall:function(e,t){this.getView().lookupReference("dashboardNav").getView().refresh();var n,a,i,o=this.getView().lookupReference("dashboard"),s=Ext.getStore("widgets").getRange();for(i=0;i<s.length;i+=1)n=s[i],a=Ext.getStore("reports").findRecord("uniqueId",n.get("entryId")),a&&a.get("category")===t.displayName&&(o.remove(n.get("entryId")),"install"===e?o.insert(i,{xtype:"reportwidget",itemId:n.get("entryId"),refreshIntervalSec:n.get("refreshIntervalSec"),viewModel:{data:{widget:n,entry:a}}}):o.insert(i,{xtype:"component",itemId:n.get("entryId"),hidden:!0}))},enableRenderer:function(e,t,n){var a=this.getViewModel();if("ReportEntry"!==n.get("type"))return'<i class="fa '+(e?"fa-check-circle-o":"fa-circle-o")+' fa-lg"></i>';var i=Ext.getStore("reports").findRecord("uniqueId",n.get("entryId"));return i&&!Ext.getStore("unavailableApps").first().get(i.get("category"))&&a.get("reportsRunning")?'<i class="fa '+(e?"fa-check-circle-o":"fa-circle-o")+' fa-lg"></i>':'<i class="fa fa-info-circle fa-lg" style="color: #a91f1f;"></i>'},settingsRenderer:function(){},widgetTitleRenderer:function(e,t,n){var a,i,o,s,r=this.getViewModel();return s=n.get("enabled"),e?r.get("reportsInstalled")?(a=Ext.getStore("reports").findRecord("uniqueId",e),a?(o=Ext.getStore("unavailableApps").first().get(a.get("category")),i='<span style="font-weight: 700; '+(o||!s?"color: #999;":"")+'">'+(a.get("readOnly")?a.get("title").t():a.get("title"))+"</span>",a.get("timeDataInterval")&&"AUTO"!==a.get("timeDataInterval")&&(i+='<span style="text-transform: lowercase; color: #999; font-weight: 300;"> per '+a.get("timeDataInterval")+"</span>"),i):"Some "+"Widget".t()):'<span style="color: #999; line-height: 26px;">'+"App Widget".t()+"</span>":'<span style="font-weight: 700; '+(s?"":"color: #999;")+'">'+n.get("type")+"</span>"},applyChanges:function(){console.log("apply"),Ung.dashboardSettings.widgets.list=Ext.Array.pluck(Ext.getStore("widgets").getRange(),"data"),rpc.dashboardManager.setSettings(function(e,t){return t?void Ung.Util.exceptionToast(t):(Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">Dashboard Saved!</span>'),void Ext.getStore("widgets").sync())},Ung.dashboardSettings)},managerHandler:function(){var e=this.getViewModel().get("managerOpen");this.getViewModel().set("managerOpen",!e)},onItemClick:function(e,t,n,a,i,o){var s,r,l=this,d=l.getView().lookupReference("dashboard"),c=this.getViewModel();if(1===n)if("ReportEntry"!==a.get("type"))a.set("enabled",!a.get("enabled"));else{if(!c.get("reportsInstalled"))return void Ext.Msg.alert("Install required".t(),"To enable App Widgets please install Reports first!".t());if(!c.get("reportsRunning"))return void Ext.Msg.alert("Reports".t(),"To view App Widgets enable the Reports App first!".t());s=Ext.getStore("reports").findRecord("uniqueId",a.get("entryId")),r=d.down("#"+a.get("entryId")),s&&r?Ext.getStore("unavailableApps").first().get(s.get("category"))?Ext.Msg.alert("Install required".t(),Ext.String.format("To enable this Widget please install <strong>{0}</strong> app first!".t(),s.get("category"))):(r.destroy(),a.get("enabled")?d.insert(o,{xtype:"component",itemId:a.get("entryId"),hidden:!0}):(d.insert(o,{xtype:"reportwidget",itemId:a.get("entryId"),refreshIntervalSec:a.get("refreshIntervalSec"),viewModel:{data:{widget:a,entry:s}}}),r=d.down("#"+a.get("entryId")),setTimeout(function(){d.scrollTo(0,d.getEl().getScrollTop()+r.getEl().getY()-121,{duration:300})},100)),a.set("enabled",!a.get("enabled"))):Ung.Util.exceptionToast("This entry is not available and it should be removed!")}2===n&&(r=d.down("#"+a.get("entryId"))||d.down("#"+a.get("type")),r&&!r.isHidden()&&(d.addCls("highlight"),r.addCls("highlight-item"),d.scrollTo(0,d.getEl().getScrollTop()+r.getEl().getY()-121,{duration:500})))},removeWidget:function(e,t,n,a,i,o){o.drop()},onItemLeave:function(e,t){this.tout&&window.clearTimeout(this.tout);var n,a=this.getView().lookupReference("dashboard");n="ReportEntry"!==t.get("type")?a.down("#"+t.get("type")):a.down("#"+t.get("entryId")),n&&(a.removeCls("highlight"),n.removeCls("highlight-item"))},onDrop:function(e,t,n,a){var i=this.getView().lookupReference("dashboard"),o=this.getView().down("#"+t.records[0].get("entryId"))||this.getView().down("#"+t.records[0].get("type")),s=this.getView().down("#"+n.get("entryId"))||this.getView().down("#"+n.get("type"));"before"===a?i.moveBefore(o,s):i.moveAfter(o,s)},resetDashboard:function(){var e=this,t=this.getViewModel();Ext.MessageBox.confirm("Warning".t(),"This will overwrite the current dashboard settings with the defaults.".t()+"<br/><br/>"+"Do you want to continue?".t(),function(n){"yes"===n&&rpc.dashboardManager.resetSettingsToDefault(function(n,a){return a?void Ung.Util.exceptionToast(a):(Ung.Util.successToast("Dashboard reset done!"),void Rpc.getDashboardSettings().then(function(n){Ung.dashboardSettings=n,t.get("reportsInstalled")?rpc.reportsManager.getUnavailableApplicationsMap(function(t,a){return a?(Ung.Util.exceptionToast(a),!1):(Ext.getStore("unavailableApps").loadRawData(t.map),Ext.getStore("widgets").loadData(n.widgets.list),void e.loadWidgets())}):(Ext.getStore("widgets").loadData(n.widgets.list),e.loadWidgets()),e.populateMenus()}))})})},onRemoveWidget:function(e){var t=this.getView().lookupReference("dashboard");t.down("#"+e)&&t.remove(e)},onAddWidget:function(e,t){var n=this.getView().lookupReference("dashboard");t?n.add({xtype:"reportwidget",itemId:e.get("entryId"),refreshIntervalSec:e.get("refreshIntervalSec"),viewModel:{data:{widget:e,entry:t}}}):(console.log(e),n.add({xtype:e.get("type").toLowerCase()+"widget",itemId:e.get("type"),viewModel:{data:{widget:e}}}))},onStatsUpdate:function(){var e=this.getViewModel();e.set("stats",Ext.getStore("stats").first()),rpc.deviceTable.getDevices(function(t,n){return n?(Ung.Util.exceptionToast(n),!1):void e.set("deviceCount",t.list.length)})},populateMenus:function(){var e,t=this.getView().down("#addWidgetBtn"),n=[],a=[];t.getMenu()&&t.getMenu().remove(),n.push({text:"Common",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png",iconCls:"menu-icon",menu:{plain:!0,items:[{text:"Information",type:"Information"},{text:"Resources",type:"Resources"},{text:"CPU Load",type:"CPULoad"},{text:"Network Information",type:"NetworkInformation"},{text:"Network Layout",type:"NetworkLayout"},{text:"Map Distribution",type:"MapDistribution"}],listeners:{click:function(e,t){if(Ext.getStore("widgets").findRecord("type",t.type))return void Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.text+"</span> is already in Dashboard!");var n=Ext.create("Ung.model.Widget",{displayColumns:null,enabled:!0,entryId:null,javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:0,timeframe:null,type:t.type});Ext.getStore("widgets").add(n),Ext.GlobalEvents.fireEvent("addwidget",n,null)}}}}),rpc.reportsManager?rpc.reportsManager.getCurrentApplications(function(i,o){e=[{displayName:"Hosts",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_hosts.png"},{displayName:"Devices",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_devices.png"},{displayName:"Network",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_network.png"},{displayName:"Administration",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_admin.png"},{displayName:"System",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/config/icon_config_system.png"},{displayName:"Shield",icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/untangle-node-shield_17x17.png"}],i.list.forEach(function(t){e.push({displayName:t.displayName,icon:resourcesBaseHref+"/skins/modern-rack/images/admin/apps/"+t.name+"_17x17.png"})}),e.forEach(function(e){a=[],Ext.getStore("reports").filter({property:"category",value:e.displayName,exactMatch:!0}),Ext.getStore("reports").getRange().forEach(function(e){a.push({text:Ung.Util.iconReportTitle(e)+" "+e.get("title"),report:e})}),Ext.getStore("reports").clearFilter(),n.push({text:e.displayName,icon:e.icon,iconCls:"menu-icon",menu:{plain:!0,items:a,listeners:{click:function(e,t){if(Ext.getStore("widgets").findRecord("entryId",t.report.get("uniqueId")))return void Ung.Util.successToast('<span style="color: yellow; font-weight: 600;">'+t.report.get("title")+"</span> is already in Dashboard!");var n=Ext.create("Ung.model.Widget",{displayColumns:t.report.get("displayColumns"),enabled:!0,entryId:t.report.get("uniqueId"),javaClass:"com.untangle.uvm.DashboardWidgetSettings",refreshIntervalSec:60,timeframe:3600,type:"ReportEntry"});Ext.getStore("widgets").add(n),Ext.GlobalEvents.fireEvent("addwidget",n,t.report)}}}})}),t.setMenu({items:n,mouseLeaveDelay:0})}):t.setMenu({items:n,mouseLeaveDelay:0})}}),Ext.define("Ung.view.dashboard.Queue",{alternateClassName:"DashboardQueue",singleton:!0,processing:!1,paused:!1,queue:[],queueMap:{},tout:null,add:function(e){this.queueMap[e.id]||(this.queue.push(e),this.process())},addFirst:function(e){this.queueMap[e.id]||(this.queue.unshift(e),this.process())},next:function(){this.processing=!1,this.process()},remove:function(e){console.log("removing"),this.processing&&(this.processing=!1)},process:function(){var e=this;if(clearTimeout(this.tout),this.tout=setTimeout(function(){e.processing=!1,e.queue=[]},3e3),!this.paused&&!this.processing&&this.queue.length>0){this.processing=!0;var t=this.queue.shift();delete this.queueMap[t.id],t.isHidden()?(t.toQueue=!0,Ung.view.dashboard.Queue.next()):t.fetchData()}},reset:function(){this.queue=[],this.queueMap={},this.processing=!1},pause:function(){this.paused=!0},resume:function(){this.paused=!1,this.process()},inView:function(e){if(!e.getEl())return!1;var t=e.getEl().dom.getBoundingClientRect();return t.top+t.height/2>0&&t.height/2+t.top<window.innerHeight}}),Ext.define("Ung.view.grid.ActionColumn",{extend:"Ext.grid.column.Action",xtype:"ung.actioncolumn",defaultRenderer:function(e,t,n,a,i,o,s){var r,l,d,c,p,g,u,m,f,h,y,b,v,x=this,w=x.origScope||x,C=x.items,S=C.length;for(d=Ext.isFunction(x.origRenderer)?x.origRenderer.apply(w,arguments)||"":"",t.tdCls+=" "+Ext.baseCSSPrefix+"action-col-cell",r=0;r<S;r++)l=C[r],u=l.icon,m=l.glyph,b=l.materialIcon,v=l.materialIconColor,c=l.disabled||!!l.isDisabled&&Ext.callback(l.isDisabled,l.scope||x.origScope,[s,a,i,l,n],0,x),p=l.tooltip||(l.getTip?Ext.callback(l.getTip,l.scope||x.origScope,arguments,0,x):null),g=l.getAltText?Ext.callback(l.getAltText,l.scope||x.origScope,arguments,0,x):l.altText||x.altText,y=l.dragEnabled,l.hasActionConfiguration||(l.stopSelection=x.stopSelection,l.disable=Ext.Function.bind(x.disableAction,x,[r],0),l.enable=Ext.Function.bind(x.enableAction,x,[r],0),l.hasActionConfiguration=!0),m&&(m=Ext.Glyph.fly(m)),f=l!==x&&void 0!==l.tabIndex?l.tabIndex:x.itemTabIndex,h=l!==x&&void 0!==l.ariaRole?l.ariaRole:x.itemAriaRole,d+=b?'<i style="font-size: 18px; '+(v?"color: "+v+";":"")+'"'+("number"==typeof f?' tabIndex="'+f+'"':"")+(h?' role="'+h+'"':' role="presentation"')+' class="material-icons '+x.actionIconCls+" "+Ext.baseCSSPrefix+"action-col-"+String(r)+" "+(c?x.disabledCls+" ":" ")+(l.hidden?Ext.baseCSSPrefix+"hidden-display ":"")+(y?" draggable":" ")+(l.getClass?Ext.callback(l.getClass,l.scope||x.origScope,arguments,void 0,x):l.iconCls||x.iconCls||"")+'"'+(p?' data-qtip="'+p+'"':"")+">"+b+"</i>":"<"+(u?"img":"div")+("number"==typeof f?' tabIndex="'+f+'"':"")+(h?' role="'+h+'"':' role="presentation"')+(u?' alt="'+g+'" src="'+l.icon+'"':"")+' class="'+x.actionIconCls+" "+Ext.baseCSSPrefix+"action-col-"+String(r)+" "+(c?x.disabledCls+" ":" ")+(l.hidden?Ext.baseCSSPrefix+"hidden-display ":"")+(l.getClass?Ext.callback(l.getClass,l.scope||x.origScope,arguments,void 0,x):l.iconCls||x.iconCls||"")+'"'+(p?' data-qtip="'+p+'"':"")+(u?"/>":m?' style="font-family:'+m.fontFamily+'">'+m.character+"</div>":"></div>");return d}}),Ext.define("Ung.widget.WidgetController",{extend:"Ext.app.ViewController",alias:"controller.widget",control:{"#":{afterrender:"onAfterRender",afterdata:"onAfterData",beforedestroy:"onBeforeRemove"},"#header":{render:"headerRender"}},listen:{},headerRender:function(e){var t=this;e.getEl().on({click:function(e){"refresh"===e.target.dataset.action&&t.addToQueue()}})},init:function(e){var t,n=e.getViewModel();n.get("entry")&&(t=n.get("entry.type"),"TIME_GRAPH"!==t&&"TIME_GRAPH_DYNAMIC"!==t||e.add({xtype:"timechart",reference:"chart",height:250}),"PIE_GRAPH"===t&&e.add({xtype:"piechart",reference:"chart",height:250}),"EVENT_LIST"===t&&e.add({xtype:"component",html:"Not Implemented",height:250}))},onAfterRender:function(e){setTimeout(function(){e.removeCls("adding")},100),e.getViewModel().bind("{widget.enabled}",function(t){t&&Ext.isFunction(e.fetchData)&&Ung.view.dashboard.Queue.add(e)}),e.getViewModel().notify()},onAfterData:function(){var e=this.getView();Ung.view.dashboard.Queue.next(),e.refreshIntervalSec&&e.refreshIntervalSec>0&&(e.refreshTimeoutId=setTimeout(function(){Ung.view.dashboard.Queue.add(e)},1e3*e.refreshIntervalSec))},onBeforeRemove:function(e){Ung.view.dashboard.Queue.remove(e)},onShow:function(e){console.log("onShow"),e.removeCls("adding")},addToQueue:function(){console.log("fetch data");var e=this.getView();e.refreshTimeoutId&&clearTimeout(e.refreshTimeoutId),Ung.view.dashboard.Queue.addFirst(e)},resizeWidget:function(){var e=this.getView();e.hasCls("small")?e.removeCls("small").addCls("medium"):e.hasCls("medium")?e.removeCls("medium").addCls("large"):e.hasCls("large")?e.removeCls("large").addCls("x-large"):e.hasCls("x-large")&&e.removeCls("x-large").addCls("small"),e.updateLayout()}}),Ext.define("Ung.widget.Information",{extend:"Ext.container.Container",alias:"widget.informationwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget small info-widget adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"Information".t()+"</h1>"},{xtype:"component",cls:"info-host",padding:5,bind:{html:'<p class="hostname">{stats.hostname}</p><p class="version">{stats.version}</p>'}},{xtype:"component",margin:"10 0",bind:{html:'<span class="info-lbl">'+"uptime".t()+':</span><span class="info-val">{stats.uptimeFormatted}</span><br/><span class="info-lbl">'+"Server".t()+':</span><span class="info-val">{stats.appliance}</span><br/><span class="info-lbl">'+"CPU Count".t()+':</span><span class="info-val">{stats.numCpus}</span><br/><span class="info-lbl">'+"CPU Type".t()+':</span><span class="info-val">{stats.cpuModel}</span><br/><span class="info-lbl">'+"Architecture".t()+':</span><span class="info-val">{stats.architecture}</span><br/><span class="info-lbl">'+"Memory".t()+':</span><span class="info-val">{stats.totalMemory}</span><br/><span class="info-lbl">'+"Disk".t()+':</span><span class="info-val">{stats.totalDisk}</span>'}}]}),Ext.define("Ung.widget.Resources",{extend:"Ext.container.Container",alias:"widget.resourceswidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget",cls:"small adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"Resources".t()+"</h1>"},{xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Memory".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeMemoryPercent}%;"></div><p>{stats.totalMemory}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedMemoryPercent}%</strong> used<br/><span>{stats.usedMemory}</span></div><div class="load-free">free <strong>{stats.freeMemoryPercent}%</strong><br/><span>{stats.freeMemory}</span></div></div></div>'}},{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Swap".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeSwapPercent}%;"></div><p>{stats.totalSwap}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedSwapPercent}%</strong> used<br/><span>{stats.usedSwap}</span></div><div class="load-free">free <strong>{stats.freeSwapPercent}%</strong><br/><span>{stats.freeSwap}</span></div></div></div>'}},{xtype:"component",flex:1,padding:"5 10",bind:{html:'<div><p style="margin: 2px; text-align: left; font-weight: bold; font-size: 14px;">'+"Disk".t()+'</p><div class="load-bar"><div class="load-bar-inner" style="left: -{stats.freeDiskPercent}%;"></div><p>{stats.totalDisk}</p></div><div class="load-bar-values"><div class="load-used"><strong>{stats.usedDiskPercent}%</strong> used<br/><span>{stats.usedDisk}</span></div><div class="load-free">free <strong>{stats.freeDiskPercent}%</strong><br/><span>{stats.freeDisk}</span></div></div></div>'}}]}]}),Ext.define("Ung.widget.NetworkInformation",{extend:"Ext.container.Container",alias:"widget.networkinformationwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget small adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},viewModel:!0,refreshIntervalSec:3,items:[{xtype:"component",cls:"header",itemId:"header",html:"<h1>"+"Network Information".t()+'</h1><button class="action-btn"><i class="material-icons" data-action="refresh">refresh</i></button>'},{xtype:"container",items:[{xtype:"component",bind:{html:'<div class="info-box" style="border-bottom: 1px #EEE solid;"><div class="info-item">'+"Currently Active".t()+'<br/><span>{stats.activeHosts}</span></div><div class="info-item">'+"Maximum Active".t()+'<br/><span>{stats.maxActiveHosts}</span></div><div class="info-item">'+"Known Devices".t()+'<br/><span>{stats.knownDevices}</span></div><div class="info-actions"><a class="wg-button" href="#hosts" style="flex: 1;">'+"Hosts".t()+'</a><a class="wg-button" href="#devices" style="flex: 1;">'+"Devices".t()+"</a></div></div>"
}},{xtype:"component",bind:{html:'<div class="info-box"><div class="info-item">'+"Total Sessions".t()+'<br/><span>{sessions.totalSessions}</span></div><div class="info-item">'+"Scanned Sessions".t()+'<br/><span>{sessions.scannedSessions}</span></div><div class="info-item">'+"Bypassed Sessions".t()+'<br/><span>{sessions.bypassedSessions}</span></div><div class="info-actions"><a class="wg-button" href="#sessions" style="flex: 1;">'+"Sessions".t()+"</a> </div></div>"}}]}],fetchData:function(){var e=this,t=this.getViewModel();t&&rpc.sessionMonitor.getSessionStats(function(n,a){t.set("sessions",n),e.fireEvent("afterdata")})}}),Ext.define("Ung.widget.MapDistribution",{extend:"Ext.container.Container",alias:"widget.mapdistributionwidget",controller:"widget",hidden:!0,border:!1,baseCls:"widget",cls:"adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},refreshIntervalSec:5,items:[{xtype:"container",layout:{type:"hbox",align:"top"},cls:"header",style:{height:"50px"},items:[{xtype:"component",flex:1,html:"<h1>"+"Map Distribution".t()+"</h1>"},{xtype:"container",margin:"10 5 0 0",layout:{type:"hbox",align:"middle"},items:[{xtype:"button",baseCls:"action",text:'<i class="material-icons">refresh</i>',listeners:{click:"fetchData"}}]}]},{xtype:"container",html:"Under construction"}],fetchData:function(){var e=this;e.fireEvent("afterdata")}}),Ext.define("Ung.view.apps.AppsController",{extend:"Ext.app.ViewController",alias:"controller.apps",control:{"#":{activate:"getPolicies"},"#installedApps":{activate:"filterInstalled"},"#installableApps":{activate:"filterInstallable",select:"onInstallNode"}},nodeDesc:{"untangle-node-web-filter":"Web Filter scans and categorizes web traffic to monitor and enforce network usage policies.".t(),"untangle-node-web-monitor":"Web monitor scans and categorizes web traffic to monitor and enforce network usage policies.".t(),"untangle-node-virus-blocker":"Virus Blocker detects and blocks malware before it reaches users desktops or mailboxes.".t(),"untangle-node-virus-blocker-lite":"Virus Blocker Lite detects and blocks malware before it reaches users desktops or mailboxes.".t(),"untangle-node-spam-blocker":"Spam Blocker detects, blocks, and quarantines spam before it reaches users mailboxes.".t(),"untangle-node-spam-blocker-lite":"Spam Blocker Lite detects, blocks, and quarantines spam before it reaches users mailboxes.".t(),"untangle-node-phish-blocker":"Phish Blocker detects and blocks phishing emails using signatures.".t(),"untangle-node-web-cache":"Web Cache stores and serves web content from local cache for increased speed and reduced bandwidth usage.".t(),"untangle-node-bandwidth-control":"Bandwidth Control monitors, manages, and shapes bandwidth usage on the network".t(),"untangle-casing-ssl-inspector":"SSL Inspector allows for full decryption of HTTPS and SMTPS so that other applications can process the encrytped streams.".t(),"untangle-node-application-control":"Application Control scans sessions and identifies the associated applications allowing each to be flagged and/or blocked.".t(),"untangle-node-application-control-lite":"Application Control Lite identifies, logs, and blocks sessions based on the session content using custom signatures.".t(),"untangle-node-captive-portal":"Captive Portal allows administrators to require network users to complete a defined process, such as logging in or accepting a network usage policy, before accessing the internet.".t(),"untangle-node-firewall":"Firewall is a simple application that flags and blocks sessions based on rules.".t(),"untangle-node-ad-blocker":"Ad Blocker blocks advertising content and tracking cookies for scanned web traffic.".t(),"untangle-node-reports":"Reports records network events to provide administrators the visibility and data necessary to investigate network activity.".t(),"untangle-node-policy-manager":"Policy Manager enables administrators to create different policies and handle different sessions with different policies based on rules.".t(),"untangle-node-directory-connector":"Directory Connector allows integration with external directories and services, such as Active Directory, RADIUS, or Google.".t(),"untangle-node-wan-failover":"WAN Failover detects WAN outages and re-routes traffic to any other available WANs to maximize network uptime.".t(),"untangle-node-wan-balancer":"WAN Balancer spreads network traffic across multiple internet connections for better performance.".t(),"untangle-node-ipsec-vpn":"IPsec VPN provides secure network access and tunneling to remote users and sites using IPsec, GRE, L2TP, Xauth, and IKEv2 protocols.".t(),"untangle-node-openvpn":"OpenVPN provides secure network access and tunneling to remote users and sites using the OpenVPN protocol.".t(),"untangle-node-intrusion-prevention":"Intrusion Prevention blocks scans, detects, and blocks attacks and suspicious traffic using signatures.".t(),"untangle-node-configuration-backup":"Configuration Backup automatically creates backups of settings uploads them to My Account and Google Drive.".t(),"untangle-node-branding-manager":"The Branding Settings are used to set the logo and contact information that will be seen by users (e.g. reports).".t(),"untangle-node-live-support":"Live Support provides on-demand help for any technical issues.".t()},refs:{installedApps:"#installedApps",installableApps:"#installableApps"},getPolicies:function(){console.log("on activate");var e=this,t=this.getViewModel();rpc.nodeManager.getAppsViews(function(n,a){console.log(n);var i=[];t.getStore("apps").removeAll(),Ext.Array.each(n[0].nodeProperties.list,function(e){i.push({name:e.name,displayName:e.displayName,type:e.type,viewPosition:e.viewPosition,status:null,targetState:n[0].instances.list.filter(function(t){return e.name===t.nodeName})[0].targetState})}),Ext.Array.each(n[0].installable.list,function(t){i.push({name:t.name,displayName:t.displayName,type:t.type,viewPosition:t.viewPosition,desc:e.nodeDesc[t.name],status:"available"})}),t.getStore("apps").loadData(i)})},filterInstalled:function(){this.getViewModel().set("onInstalledApps",!0),console.log("filter installed");var e=this.getViewModel().getStore("apps");e.clearFilter(),e.filterBy(function(e){return!e.get("status")||"installing"===e.get("status")||"installed"===e.get("status")})},filterInstallable:function(){this.getViewModel().set("onInstalledApps",!1);var e=this.getViewModel().getStore("apps");e.each(function(e){"installed"===e.get("status")&&e.set("status",null)}),e.clearFilter(),e.filterBy(function(e){return Ext.Array.contains(["available","installing","installed"],e.get("status"))})},setPolicy:function(e,t,n){null!==n&&(this.redirectTo("#apps/"+t,!1),this.updateNodes())},onInstallNode:function(e,t){t.set("status","installing"),rpc.nodeManager.instantiate(function(e,n){return n?(t.set("status","available"),void console.log(n)):void t.set("status","installed")},t.get("name"),1)}}),Ext.define("Ung.view.apps.Apps",{extend:"Ext.panel.Panel",xtype:"ung.apps",itemId:"apps",layout:"card",requires:["Ung.view.apps.AppsController"],controller:"apps",viewModel:{data:{onInstalledApps:!1},stores:{apps:{fields:["name","displayName","type","status"],sorters:[{property:"viewPosition",direction:"ASC"}]}}},config:{policy:void 0},defaults:{border:!1},dockedItems:[{xtype:"toolbar",dock:"top",border:!1,items:[{xtype:"combobox",editable:!1,multiSelect:!1,queryMode:"local",hidden:!0,bind:{value:"{policyId}",store:"{policies}",hidden:"{!onInstalledApps}"},valueField:"policyId",displayField:"displayName",listeners:{change:"setPolicy"}},{xtype:"button",html:"Install Apps".t(),iconCls:"fa fa-download",hrefTarget:"_self",hidden:!0,bind:{href:"#apps/{policyId}/install",hidden:"{!onInstalledApps}"}},{xtype:"button",html:"Back to Apps".t(),iconCls:"fa fa-arrow-circle-left",hrefTarget:"_self",hidden:!0,bind:{href:"#apps/{policyId}",hidden:"{onInstalledApps}"}}]}],items:[{xtype:"dataview",scrollable:!0,itemId:"installedApps",bind:"{apps}",tpl:'<p class="apps-title">'+"Apps".t()+'</p><tpl for="."><tpl if="type === \'FILTER\'"><a href="#config" class="app-item"><span class="state {targetState}"><i class="fa fa-power-off"></i></span><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><span class="app-name">{displayName}</span></a></tpl></tpl><p class="apps-title">'+"Service Apps".t()+'</p><tpl for="."><tpl if="type === \'SERVICE\'"><a href="#config" class="app-item"><span class="state {targetState}"><i class="fa fa-power-off"></i></span><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><span class="app-name">{displayName}</span></a></tpl></tpl>',itemSelector:"a"},{xtype:"dataview",scrollable:!0,itemId:"installableApps",bind:{store:"{apps}"},tpl:'<p class="apps-title">'+"Apps".t()+'</p><tpl for="."><tpl if="type === \'FILTER\'"><div class="node-install-item {status}"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><i class="fa fa-download fa-3x"></i><i class="fa fa-check fa-3x"></i><span class="loader">Loading...</span><h3>{displayName}</h3><p>{desc}</p></div></tpl></tpl><p class="apps-title">'+"Service Apps".t()+'</p><tpl for="."><tpl if="type === \'SERVICE\'"><div class="node-install-item {status}"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/apps/{name}_80x80.png" width=80 height=80/><i class="fa fa-download fa-3x"></i><i class="fa fa-check fa-3x"></i><span class="loader">Loading...</span><h3>{displayName}</h3><p>{desc}</p></div></tpl></tpl>',itemSelector:"div"}]}),Ext.define("Ung.view.config.ConfigController",{extend:"Ext.app.ViewController",alias:"controller.config",control:{"#":{deactivate:"onDeactivate"},"#subNav":{selectionchange:"onSelect"}},listen:{global:{loadconfig:"onLoadConfig"}},onSelect:function(e,t){t.selected=!0},onLoadConfig:function(e,t){var n=this.getView();if(!e)return void n.setActiveItem(1);n.down("#configCard")&&n.down("#configCard").destroy();var a=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();n.down("#subNav").getStore().each(function(t){t.get("url")===e?t.set("selected","x-item-selected"):t.set("selected","")}),n.setLoading("Loading "+a.t()+"..."),Ext.require("Ung.view.config."+a.toLowerCase()+"."+a,function(){n.down("#configWrapper").add({xtype:"ung.config."+a.toLowerCase(),region:"center",itemId:"configCard"}),n.setLoading(!1),n.setActiveItem(2),console.log(t),t&&n.down("#configCard").setActiveItem(t)})},onDeactivate:function(e){e.down("#configCard")&&(e.setActiveItem(0),e.down("#configCard").destroy())}}),Ext.define("Ung.view.config.Config",{extend:"Ext.container.Container",xtype:"ung.config",itemId:"config",requires:["Ung.view.config.ConfigController"],controller:"config",items:[{xtype:"dataview",store:{data:[{name:"Network".t(),url:"network",icon:"icon_config_network.png"},{name:"Administration".t(),url:"administration",icon:"icon_config_admin.png"},{name:"Email".t(),url:"email",icon:"icon_config_email.png"},{name:"Local Directory".t(),url:"localdirectory",icon:"icon_config_directory.png"},{name:"Upgrade".t(),url:"upgrade",icon:"icon_config_upgrade.png"},{name:"System".t(),url:"system",icon:"icon_config_system.png"},{name:"About".t(),url:"about",icon:"icon_config_about.png"}]},tpl:'<p class="apps-title">'+"Configuration".t()+'</p><tpl for="."><a href="#config/{url}" class="app-item"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/config/{icon}" width=80 height=80/><span class="app-name">{name}</span></a></tpl>',itemSelector:"a"},{xtype:"dataview",store:{data:[{name:"Sessions".t(),url:"sessions",icon:"icon_config_sessions.png"},{name:"Hosts".t(),url:"hosts",icon:"icon_config_hosts.png"},{name:"Devices".t(),url:"devices",icon:"icon_config_devices.png"}]},tpl:'<p class="apps-title">'+"Tools".t()+'</p><tpl for="."><a href="#{url}" class="app-item"><img src="'+resourcesBaseHref+'/skins/modern-rack/images/admin/config/{icon}" width=80 height=80/><span class="app-name">{name}</span></a></tpl>',itemSelector:"a"}]}),Ext.define("Ung.widget.ReportModel",{extend:"Ext.app.ViewModel",alias:"viewmodel.reportwidget",formulas:{title:{get:function(e){return"<h1>"+e("entry.title")+(e("entry.timeDataInterval")?' <span style="text-transform: lowercase; color: #777; font-weight: 100;">per '+e("entry.timeDataInterval")+"</span>":"")+"</h1><p>since "+e("timeframe")+" ago</p></h1>"}},timeframe:{get:function(e){return e("widget.timeframe")}}}}),Ext.define("Ung.widget.CpuLoadController",{extend:"Ext.app.ViewController",alias:"controller.cpuload",control:{"#":{afterrender:"onAfterRender",resize:"onResize"}},listen:{store:{"#stats":{datachanged:"addPoint"}}},onAfterRender:function(e){setTimeout(function(){e.removeCls("adding")},100),this.lineChart=new Highcharts.Chart({chart:{type:"areaspline",renderTo:e.lookupReference("cpulinechart").getEl().dom,marginBottom:15,marginTop:20,backgroundColor:"transparent",animation:!1,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,credits:{enabled:!1},exporting:{enabled:!1},xAxis:[{type:"datetime",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Source Sans Pro",color:"#999",fontSize:"11px",fontWeight:600},y:12},maxPadding:0,minPadding:0}],yAxis:{min:0,minRange:2,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickAmount:4,tickLength:5,tickWidth:1,tickPosition:"inside",opposite:!1,labels:{align:"left",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#999",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:1,y:-2},title:null},legend:{enabled:!1},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+=': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span>",e+"<br/>"}},plotOptions:{areaspline:{fillOpacity:.15,lineWidth:2},series:{marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}},series:[{name:"load",data:function(){var e,t=[],n=Date.now();try{n=rpc.systemManager.getMilliseconds()}catch(e){console.log("Unable to get current millis.")}for(n=1e3*Math.round(n/1e3),e=-19;e<=0;e+=1)t.push({x:n+3e3*e,y:0});return t}()}]}),this.gaugeChart=new Highcharts.Chart({chart:{type:"gauge",renderTo:e.lookupReference("cpugaugechart").getEl().dom,height:140,margin:[-20,0,0,0],backgroundColor:"transparent",style:{margin:"0 auto"}},credits:{enabled:!1},title:null,exporting:{enabled:!1},pane:[{startAngle:-45,endAngle:45,background:null,center:["50%","135%"],size:280}],tooltip:{enabled:!1},yAxis:[{min:0,max:50,minorTickPosition:"outside",tickPosition:"outside",tickColor:"#555",minorTickColor:"#999",labels:{rotation:"auto",distance:20,step:1},plotBands:[{from:0,to:3,color:"rgba(112, 173, 112, 1)",innerRadius:"100%",outerRadius:"105%"},{from:3,to:6,color:"rgba(255, 255, 0, 1)",innerRadius:"100%",outerRadius:"105%"},{from:6,to:7,color:"rgba(255, 0, 0, 1)",innerRadius:"100%",outerRadius:"105%"}],title:null}],plotOptions:{gauge:{dataLabels:{enabled:!1},dial:{radius:"99%",backgroundColor:"#999"}}},series:[{data:[0]}]}),this.addPoint()},onResize:function(){this.lineChart.reflow(),this.gaugeChart.reflow()},addPoint:function(){if(this.gaugeChart&&this.lineChart){var e=Ext.getStore("stats"),t=this.getViewModel(),n=e.first().getData(),a=n.numCpus+1,i=n.numCpus+4;this.lineChart.yAxis[0].update({minRange:n.numCpus}),this.gaugeChart.yAxis[0].update({max:i+1,plotBands:[{from:0,to:a,color:"rgba(112, 173, 112, 1)",innerRadius:"100%",outerRadius:"105%"},{from:a,to:i,color:"rgba(255, 255, 0, 1)",innerRadius:"100%",outerRadius:"105%"},{from:i,to:i+1,color:"rgba(255, 0, 0, 1)",innerRadius:"100%",outerRadius:"105%"}]}),this.lineChart.series[0].addPoint({x:Date.now(),y:e.first().getData().oneMinuteLoadAvg},!0,!0),this.gaugeChart.series[0].points[0].update(n.oneMinuteLoadAvg<=i+1?n.oneMinuteLoadAvg:i+1,!0),n.oneMinuteLoadAvg<a&&t.set("loadLabel","low".t()),n.oneMinuteLoadAvg>a&&t.set("loadLabel","medium".t()),n.oneMinuteLoadAvg>i&&t.set("loadLabel","high".t())}}}),Ext.define("Ung.widget.CpuLoad",{extend:"Ext.container.Container",alias:"widget.cpuloadwidget",requires:["Ung.widget.CpuLoadController"],controller:"cpuload",viewModel:!0,hidden:!0,border:!1,baseCls:"widget",cls:"small adding",bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",cls:"header",html:"<h1>"+"CPU Load".t()+"</h1>"},{xtype:"container",items:[{xtype:"component",height:120,reference:"cpulinechart"},{xtype:"component",reference:"cpugaugechart",height:140},{xtype:"component",cls:"cpu-gauge",bind:{html:"{stats.oneMinuteLoadAvg}<br/><span>{loadLabel}</span>"}}]}]}),Ext.define("Ung.widget.InterfaceItem",{extend:"Ext.Component",alias:"widget.interfaceitem",bind:{html:'<p class="name" style="display: {displayWan};">{iface.name}</p><div class="speeds"><div class="speed_up"><i class="fa fa-caret-down fa-lg"></i> <span>{tx} kB/s</span></div><div class="speed_down"><i class="fa fa-caret-up fa-lg"></i> <span>{rx} kB/s</span></div></div><p class="name" style="display: {displayNotWan};">{iface.name}</p><i class="fa fa-caret-down fa-lg pointer"></i>'},viewModel:{formulas:{displayWan:function(e){return e("iface.isWan")?"block":"none"},displayNotWan:function(e){return e("iface.isWan")?"none":"block"},tx:function(e){var t=e("stats").getData(),n="interface_"+e("iface.interfaceId")+"_txBps";return t.hasOwnProperty(n)?(t[n]/1024).toFixed(2):"-"},rx:function(e){var t=e("stats").getData(),n="interface_"+e("iface.interfaceId")+"_rxBps";return t.hasOwnProperty(n)?(t[n]/1024).toFixed(2):"-"}}}}),Ext.define("Ung.widget.NetworkLayout",{extend:"Ext.container.Container",alias:"widget.networklayoutwidget",requires:["Ung.widget.InterfaceItem"],controller:"widget",hidden:!0,border:!1,baseCls:"widget adding",layout:{type:"vbox",align:"stretch"},bind:{hidden:"{!widget.enabled}"},refreshIntervalSec:0,items:[{xtype:"component",cls:"header",itemId:"header",html:"<h1>"+"Network Layout".t()+'</h1><button class="action-btn"><i class="fa fa-refresh" data-action="refresh"></i></button>'},{cls:"net-layout",margin:10,layout:{type:"vbox",align:"stretch"},border:!1,defaults:{xtype:"component"},items:[{html:'<img src="'+resourcesBaseHref+'/skins/default/images/admin/icons/interface-cloud.png" style="margin: 0 auto; display: block; height: 30px;"/>'},{xtype:"container",cls:"ifaces",height:69,itemId:"externalInterface"},{xtype:"component",cls:"line"},{xtype:"container",cls:"ifaces",height:80,itemId:"internalInterface"},{xtype:"component",cls:"devices",margin:"5 0 0 0",height:40,bind:{html:'<img src="'+resourcesBaseHref+'/skins/default/images/admin/icons/interface-devices.png"><br/>{deviceCount}'}}]}],fetchData:function(){var e=this;rpc.networkManager.getNetworkSettings(function(t,n){return e.fireEvent("afterdata"),n?(Ung.Util.exceptionToast(n),!1):(e.down("#externalInterface").removeAll(),e.down("#internalInterface").removeAll(),void Ext.each(t.interfaces.list,function(t){t.disabled||(t.isWan?e.down("#externalInterface").add({xtype:"interfaceitem",cls:"iface wan",viewModel:{data:{iface:t}}}):e.down("#internalInterface").add({xtype:"interfaceitem",cls:"iface",viewModel:{data:{iface:t}}}))}))})}}),Ext.define("Ung.chart.TimeChartController",{extend:"Ext.app.ViewController",alias:"controller.timechart",control:{"#":{resize:"onResize"}},styles:{LINE:{styleType:"spline"},AREA:{styleType:"areaspline"},AREA_STACKED:{styleType:"areaspline",stacking:!0},BAR:{styleType:"column",grouping:!0},BAR_OVERLAPPED:{styleType:"column",overlapped:!0},BAR_STACKED:{styleType:"column",stacking:!0}},init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},setChartType:function(e){var t="areaspline";switch(e){case"LINE":t="spline";break;case"AREA":case"AREA_STACKED":t="areaspline";break;case"BAR":case"BAR_3D":case"BAR_OVERLAPPED":case"BAR_3D_OVERLAPPED":case"BAR_STACKED":t="column";break;default:t="areaspline"}return t},onAfterRender:function(e){var t=this;this.entry=e.getViewModel().get("entry")||this.getView().getEntry(),this.chart=new Highcharts.StockChart({chart:{type:t.setChartType(t.entry.get("timeStyle")),zoomType:"x",renderTo:e.lookupReference("timechart").getEl().dom,marginTop:10,padding:[0,0,0,0],backgroundColor:"transparent",animation:!1,style:{fontFamily:"Source Sans Pro",fontSize:"12px"}},title:null,lang:{noData:""},noData:{style:{fontSize:"12px",fontWeight:"normal",color:"#CCC"}},colors:null!==t.entry.get("colors")&&t.entry.get("colors")>0?t.entry.get("colors"):t.defaultColors,navigator:{enabled:!1},rangeSelector:{enabled:!1,inputEnabled:!1},scrollbar:{enabled:!1},credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},xAxis:[{type:"datetime",alternateGridColor:"rgba(220, 220, 220, 0.1)",crosshair:{width:1,dashStyle:"ShortDot",color:"rgba(100, 100, 100, 0.3)"},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",labels:{style:{fontFamily:"Open Sans Condensed",color:"#555",fontSize:"10px",fontWeight:700},y:12},maxPadding:0,minPadding:0}],yAxis:{allowDecimals:!0,min:0,minRange:"percent"===t.entry.get("units")?100:.4,maxRange:"percent"===t.entry.get("units")?100:void 0,lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickLength:5,tickWidth:1,showFirstLabel:!1,showLastLabel:!0,endOnTick:"percent"!==t.entry.get("units"),tickInterval:"percent"===t.entry.get("units")?20:void 0,maxPadding:0,opposite:!1,labels:{align:"right",useHTML:!0,padding:0,style:{fontFamily:"Open Sans Condensed",color:"#555",fontSize:"10px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:-10,y:5,formatter:function(){var e=this.value;return"bytes/s"===t.entry.get("units")&&(e=Ung.Util.bytesToHumanReadable(this.value,!0)),e}},title:{align:"high",offset:-10,y:3,text:t.entry.get("units"),style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"10px",fontWeight:600}}},legend:{enabled:!0,padding:5,margin:0,y:10,lineHeight:12,itemDistance:10,itemStyle:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"12px",fontWeight:600},symbolHeight:7,symbolWidth:7,symbolRadius:3},tooltip:{shared:!0,animation:!0,followPointer:!0,backgroundColor:"rgba(255, 255, 255, 0.7)",borderWidth:1,borderColor:"rgba(0, 0, 0, 0.1)",style:{textAlign:"right",fontFamily:"Source Sans Pro",padding:"5px",fontSize:"10px",marginBottom:"40px"},hideDelay:0,shadow:!1,headerFormat:'<span style="font-size: 11px; line-height: 1.5; font-weight: bold;">{point.key}</span><br/>',pointFormatter:function(){var e="<span>"+this.series.name+"</span>";return e+="bytes"===t.entry.get("units")||"bytes/s"===t.entry.get("units")?': <span style="color: '+this.color+'; font-weight: bold;">'+this.y+"</span>":': <spanstyle="color: '+this.color+'; font-weight: bold;">'+this.y+"</span> "+t.entry.get("units"),e+"<br/>"}},plotOptions:{column:{edgeWidth:0,borderWidth:0,pointPadding:0,groupPadding:.2,dataGrouping:{groupPixelWidth:40},pointPlacement:"on",dataLabels:{enabled:!1,align:"left",rotation:-45,x:0,y:-2,style:{fontSize:"9px",color:"#999",textShadow:!1}}},areaspline:{lineWidth:0},spline:{lineWidth:2,softThreshold:!1},series:{animation:!1,marker:{enabled:!0,radius:0,states:{hover:{enabled:!0,lineWidthPlus:2,radius:4,radiusPlus:2}}},states:{hover:{enabled:!0,lineWidthPlus:0,halo:{size:2}}}}}})},onResize:function(){this.chart.reflow()},onSetSeries:function(e){var t,n,a,i=this,o=[],s=Ext.clone(this.entry.get("timeDataColumns")),r=this.entry.get("timeStyle"),l=this.entry.get("colors")||this.defaultColors;if(this.getView().lookupReference("loader").hide(),s)for(t=0;t<s.length;t+=1)s[t]=s[t].split(" ").splice(-1)[0];else for(s=[],n=0;n<e.length;n+=1)for(a in e[n])e[n].hasOwnProperty(a)&&"time_trunc"!==a&&"time"!==a&&s.indexOf(a)<0&&s.push(a);for(t=0;t<s.length;t+=1){for(o=[],n=0;n<e.length;n+=1)o.push([e[n].time_trunc.time,e[n][s[t]]||0]);this.chart.get("series-"+s[t])?this.chart.get("series-"+s[t]).update({data:o,type:i.styles[r].styleType,color:l[t]||void 0,fillOpacity:"AREA_STACKED"===r||"BAR_STACKED"===r?1:.5,grouping:i.styles[r].grouping||!1,stacking:i.styles[r].stacking||void 0,pointPadding:i.styles[r].overlapped?(s.length<=3?.1:.075)*t:.1,visible:!("total"===s[t]&&i.styles[r].stacking)}):this.chart.addSeries({id:"series-"+s[t],name:s[t],data:o,type:i.styles[r].styleType,color:l[t]||void 0,fillOpacity:"AREA_STACKED"===r||"BAR_STACKED"===r?1:.5,grouping:i.styles[r].grouping||!1,stacking:i.styles[r].stacking||void 0,pointPlacement:0,pointPadding:i.styles[r].overlapped?(s.length<=3?.12:.075)*(t+1):.1,visible:!("total"===s[t]&&i.styles[r].stacking)},!1,!1)}this.chart.redraw()},onSetStyle:function(){var e=this,t=e.getViewModel().get("entry.timeStyle"),n=e.getViewModel().get("entry.colors")||this.defaultColors;if(this.chart){var a=this.chart.series.length;this.chart.series.forEach(function(i,o){i.update({type:e.styles[t].styleType,color:n[o]||void 0,fillOpacity:"AREA_STACKED"===t||"BAR_STACKED"===t?1:.5,grouping:e.styles[t].grouping||!1,stacking:e.styles[t].stacking||void 0,pointPadding:e.styles[t].overlapped?(a<=3?.15:.075)*o:.1,visible:!("total"===i.name&&e.styles[t].stacking)})})}},onBeginFetchData:function(){this.getView().lookupReference("loader").show()}}),Ext.define("Ung.chart.TimeChart",{extend:"Ext.container.Container",alias:"widget.timechart",requires:["Ung.chart.TimeChartController"],controller:"timechart",viewModel:!0,config:{widget:null,entry:null},listeners:{afterrender:"onAfterRender",resize:"onResize",setseries:"onSetSeries",beginfetchdata:"onBeginFetchData"},items:[{xtype:"component",reference:"timechart",cls:"chart"},{xtype:"component",reference:"loader",cls:"loader",hideMode:"visibility"}]}),Ext.define("Ung.chart.PieChartController",{extend:"Ext.app.ViewController",alias:"controller.piechart",styles:{LINE:{styleType:"spline"},AREA:{styleType:"areaspline"},AREA_STACKED:{styleType:"areaspline",stacking:!0},BAR:{styleType:"column",grouping:!0},BAR_OVERLAPPED:{styleType:"column",overlapped:!0},BAR_STACKED:{styleType:"column",stacking:!0}},init:function(){this.defaultColors=["#00b000","#3030ff","#009090","#00ffff","#707070","#b000b0","#fff000","#b00000","#ff0000","#ff6347","#c0c0c0"]},onAfterRender:function(e){var t=this;this.entry=e.getViewModel().get("entry")||this.getView().getEntry(),this.chart=new Highcharts.Chart({chart:{type:t.entry.get("pieStyle").indexOf("COLUMN")>=0?"column":"pie",renderTo:e.lookupReference("piechart").getEl().dom,marginTop:10,marginRight:0,marginLeft:0,backgroundColor:"transparent",style:{fontFamily:"Source Sans Pro",fontSize:"12px"},options3d:{enabled:!1,alpha:45,beta:5}},title:null,lang:{noData:""},noData:{style:{fontSize:"12px",fontWeight:"normal",color:"#CCC"}},colors:null!==t.entry.get("colors")&&t.entry.get("colors")>0?t.entry.get("colors"):this.defaultColors,credits:{enabled:!1},navigation:{buttonOptions:{enabled:!1}},xAxis:{type:"category",crosshair:!0,alternateGridColor:"rgba(220, 220, 220, 0.1)",labels:{style:{fontSize:"11px"}},lineColor:"#C0D0E0",lineWidth:1,tickLength:3,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",maxPadding:0,minPadding:0},yAxis:{lineColor:"#C0D0E0",lineWidth:1,gridLineWidth:1,gridLineDashStyle:"dash",gridLineColor:"#EEE",tickLength:5,tickWidth:1,tickPosition:"inside",showFirstLabel:!1,showLastLabel:!0,endOnTick:!0,labels:{align:"left",useHTML:!0,padding:0,style:{fontFamily:"Source Sans Pro",color:"#555",fontSize:"11px",fontWeight:600,background:"rgba(255, 255, 255, 0.6)",padding:"0 1px",borderRadius:"2px",lineHeight:"11px"},x:9,y:6,formatter:function(){return this.isLast?'<span style="color: #555; font-size: 12px;"><strong>'+this.value+"</strong> ("+t.entry.get("units")+")</span>":this.value}}},tooltip:{headerFormat:'<span style="font-size: 14px; font-weight: bold;">aaa : {point.key}</span><br/>',hideDelay:0},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",center:["50%","50%"],showInLegend:!0,colorByPoint:!0,minSize:150,borderWidth:1,borderColor:"#EEE",dataLabels:{enabled:!0,distance:5,padding:0,reserveSpace:!1,style:{fontSize:"11px",color:"#777",fontFamily:"Source Sans Pro",fontWeight:400},formatter:function(){return this.point.percentage<3?null:this.point.name.length>25?this.point.name.substring(0,25)+"...":this.point.name}}},column:{borderWidth:0,colorByPoint:!0,depth:25,dataLabels:{enabled:!1,align:"center"}},series:{animation:!1}},legend:{enabled:!1,backgroundColor:"#EEE",borderRadius:3,padding:15,style:{overflow:"hidden"},title:{text:"aaa",style:{fontSize:"14px"}},itemStyle:{fontSize:"11px",width:"120px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},useHTML:!0,layout:"vertical",align:"left",verticalAlign:"top",symbolHeight:8,symbolWidth:8,symbolRadius:4}})},onResize:function(){this.chart.reflow()},onSetSeries:function(e){for(this.getView().lookupReference("loader").hide();this.chart.series.length>0;)this.chart.series[0].remove(!0);var t,n=[],a=0;for(t=0;t<e.length;t+=1)t<this.entry.get("pieNumSlices")?n.push({name:void 0!==e[t][this.entry.get("pieGroupColumn")]?e[t][this.entry.get("pieGroupColumn")]:"None",y:e[t].value}):a+=e[t].value;a>0&&n.push({name:"Other",color:"#DDD",y:a}),this.chart.addSeries({name:"aaa",type:this.entry.get("pieStyle").indexOf("COLUMN")>=0?"column":"pie",colors:this.entry.get("colors")||this.defaultColors,innerSize:this.entry.get("pieStyle").indexOf("DONUT")>=0?"50%":0,data:n},!0,!0)},onSetStyle:function(){var e=this,t=e.getViewModel().get("entry.pieStyle"),n=e.getViewModel().get("entry.colors")||this.defaultColors;this.chart&&this.chart.series[0].update({type:t.indexOf("COLUMN")>=0?"column":"pie",colors:n,innerSize:t.indexOf("DONUT")>=0?"50%":0})},onBeginFetchData:function(){this.getView().lookupReference("loader").show()}}),Ext.define("Ung.chart.PieChart",{extend:"Ext.container.Container",alias:"widget.piechart",requires:["Ung.chart.PieChartController"],controller:"piechart",viewModel:!0,config:{widget:null,entry:null},listeners:{afterrender:"onAfterRender",resize:"onResize",setseries:"onSetSeries",beginfetchdata:"onBeginFetchData"},items:[{xtype:"component",reference:"piechart",cls:"chart"},{xtype:"component",reference:"loader",cls:"loader",hideMode:"visibility",html:'<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>'}]}),Ext.define("Ung.chart.EventChartController",{extend:"Ext.app.ViewController",alias:"controller.eventchart",control:{"#":{setdata:"onSetData",beginfetchdata:"onBeforeData"}},onBeforeData:function(){this.getView().setLoading("Querying Database...".t())},onSetData:function(e){this.getView().setLoading(!1),this.getViewModel().set("customData",e)}}),Ext.define("Ung.util.TableConfig",{alternateClassName:"Ung.TableConfig",singleton:!0,columnWidth:{hostname:120,ip:100,port:70,timestamp:135,username:120},table:{sessions:["session_id","time_stamp","end_time","bypassed","entitled","protocol","icmp_type","hostname","username","policy_id","policy_rule_id","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","client_intf","server_intf","client_country","client_latitude","client_longitude","server_country","server_latitude","server_longitude","c2p_bytes","p2c_bytes","s2p_bytes","p2s_bytes","filter_prefix","firewall_blocked","firewall_flagged","firewall_rule_index","application_control_lite_blocked","application_control_lite_protocol","captive_portal_rule_index","captive_portal_blocked","application_control_application","application_control_protochain","application_control_category","application_control_flagged","application_control_blocked","application_control_confidence","application_control_detail","application_control_ruleid","bandwidth_control_priority","bandwidth_control_rule","ssl_inspector_status","ssl_inspector_detail","ssl_inspector_ruleid"],
session_minutes:["session_id","time_stamp","end_time","bypassed","entitled","protocol","icmp_type","hostname","username","policy_id","policy_rule_id","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","client_intf","server_intf","client_country","client_latitude","client_longitude","server_country","server_latitude","server_longitude","c2p_bytes","p2c_bytes","s2p_bytes","p2s_bytes","filter_prefix","firewall_blocked","firewall_flagged","firewall_rule_index","application_control_lite_blocked","application_control_lite_protocol","captive_portal_rule_index","captive_portal_blocked","application_control_application","application_control_protochain","application_control_category","application_control_flagged","application_control_blocked","application_control_confidence","application_control_detail","application_control_ruleid","bandwidth_control_priority","bandwidth_control_rule","ssl_inspector_status","ssl_inspector_detail","ssl_inspector_ruleid"],http_events:["request_id","policy_id","time_stamp","session_id","client_intf","server_intf","c_client_addr","c_client_port","c_server_addr","c_server_port","s_client_addr","s_client_port","s_server_addr","s_server_port","username","hostname","method","domain","host","uri","referer","c2s_content_length","s2c_content_length","s2c_content_type","web_filter_lite_blocked","web_filter_blocked","web_filter_lite_flagged","web_filter_flagged","web_filter_lite_category","web_filter_category","web_filter_lite_reason","web_filter_reason","ad_blocker_action","ad_blocker_cookie_ident","virus_blocker_clean","virus_blocker_name","virus_blocker_lite_clean","virus_blocker_lite_name"]},getColumns:function(){return{c_client_port:{header:"Client Port".t(),width:this.columnWidth.port,renderer:function(e){return Ung.TableConfig.protocols[e]||e}},hostname:{header:"Hostname".t(),width:this.columnWidth.hostname},protocol:{header:"Protocol".t(),width:this.columnWidth.port,renderer:function(e){return Ung.TableConfig.protocols[e]||e}},s_server_addr:{header:"Server".t(),width:this.columnWidth.ip},s_server_port:{header:"Server Port".t(),width:this.columnWidth.port},session_id:{header:"Session Id".t()},time_stamp:{header:"Timestamp".t(),width:this.columnWidth.timestamp,renderer:function(e){var t=new Date(e.time);return Ext.Date.format(t,"M d, H:i:s.u")}},username:{header:"Username".t(),width:this.columnWidth.username}}},protocols:{0:"HOPOPT (0)",1:"ICMP (1)",2:"IGMP (2)",3:"GGP (3)",4:"IP-in-IP (4)",5:"ST (5)",6:"TCP (6)",7:"CBT (7)",8:"EGP (8)",9:"IGP (9)",10:"BBN-RCC-MON (10)",11:"NVP-II (11)",12:"PUP (12)",13:"ARGUS (13)",14:"EMCON (14)",15:"XNET (15)",16:"CHAOS (16)",17:"UDP (17)",18:"MUX (18)",19:"DCN-MEAS (19)",20:"HMP (20)",21:"PRM (21)",22:"XNS-IDP (22)",23:"TRUNK-1 (23)",24:"TRUNK-2 (24)",25:"LEAF-1 (25)",26:"LEAF-2 (26)",27:"RDP (27)",28:"IRTP (28)",29:"ISO-TP4 (29)",30:"NETBLT (30)",31:"MFE-NSP (31)",32:"MERIT-INP (32)",33:"DCCP (33)",34:"3PC (34)",35:"IDPR (35)",36:"XTP (36)",37:"DDP (37)",38:"IDPR-CMTP (38)",39:"TP++ (39)",40:"IL (40)",41:"IPv6 (41)",42:"SDRP (42)",43:"IPv6-Route (43)",44:"IPv6-Frag (44)",45:"IDRP (45)",46:"RSVP (46)",47:"GRE (47)",48:"MHRP (48)",49:"BNA (49)",50:"ESP (50)",51:"AH (51)",52:"I-NLSP (52)",53:"SWIPE (53)",54:"NARP (54)",55:"MOBILE (55)",56:"TLSP (56)",57:"SKIP (57)",58:"IPv6-ICMP (58)",59:"IPv6-NoNxt (59)",60:"IPv6-Opts (60)",62:"CFTP (62)",64:"SAT-EXPAK (64)",65:"KRYPTOLAN (65)",66:"RVD (66)",67:"IPPC (67)",69:"SAT-MON (69)",70:"VISA (70)",71:"IPCU (71)",72:"CPNX (72)",73:"CPHB (73)",74:"WSN (74)",75:"PVP (75)",76:"BR-SAT-MON (76)",77:"SUN-ND (77)",78:"WB-MON (78)",79:"WB-EXPAK (79)",80:"ISO-IP (80)",81:"VMTP (81)",82:"SECURE-VMTP (82)",83:"VINES (83)",84:"TTP (84)",85:"NSFNET-IGP (85)",86:"DGP (86)",87:"TCF (87)",88:"EIGRP (88)",89:"OSPF (89)",90:"Sprite-RPC (90)",91:"LARP (91)",92:"MTP (92)",93:"AX.25 (93)",94:"IPIP (94)",95:"MICP (95)",96:"SCC-SP (96)",97:"ETHERIP (97)",98:"ENCAP (98)",100:"GMTP (100)",101:"IFMP (101)",102:"PNNI (102)",103:"PIM (103)",104:"ARIS (104)",105:"SCPS (105)",106:"QNX (106)",107:"A/N (107)",108:"IPComp (108)",109:"SNP (109)",110:"Compaq-Peer (110)",111:"IPX-in-IP (111)",112:"VRRP (112)",113:"PGM (113)",115:"L2TP (115)",116:"DDX (116)",117:"IATP (117)",118:"STP (118)",119:"SRP (119)",120:"UTI (120)",121:"SMP (121)",122:"SM (122)",123:"PTP (123)",124:"IS-IS (124)",125:"FIRE (125)",126:"CRTP (126)",127:"CRUDP (127)",128:"SSCOPMCE (128)",129:"IPLT (129)",130:"SPS (130)",131:"PIPE (131)",132:"SCTP (132)",133:"FC (133)",134:"RSVP-E2E-IGNORE (134)",135:"Mobility (135)",136:"UDPLite (136)",137:"MPLS-in-IP (137)",138:"manet (138)",139:"HIP (139)",140:"Shim6 (140)",141:"WESP (141)",142:"ROHC (142)"}}),Ext.define("Ung.chart.EventChart",{extend:"Ext.grid.Panel",alias:"widget.eventchart",requires:["Ung.chart.EventChartController","Ung.util.TableConfig"],controller:"eventchart",viewModel:{stores:{store:{data:"{customData}"}}},plugins:"gridfilters",config:{entry:null},bind:{store:"{store}"},border:!1,initComponent:function(){var e,t=this,n=[],a=Ung.TableConfig.getColumns();Ung.TableConfig.table[t.getEntry().get("table")].forEach(function(i){e=a[i]||{header:i},Ext.apply(e,{dataIndex:i,hidden:!Ext.Array.contains(t.getEntry().get("defaultColumns"),i)}),n.push(e)}),Ext.apply(this,{columns:n}),this.callParent(arguments)}}),Ext.define("Ung.widget.Report",{extend:"Ext.container.Container",alias:"widget.reportwidget",requires:["Ung.widget.ReportModel","Ung.chart.TimeChart","Ung.chart.PieChart","Ung.chart.EventChart"],controller:"widget",viewModel:{type:"reportwidget"},config:{widget:null,entry:null},hidden:!0,bind:{hidden:"{!widget.enabled}"},layout:{type:"vbox",align:"stretch"},border:!1,baseCls:"widget adding",items:[{xtype:"component",cls:"header",itemId:"header",bind:{html:'{title}<button class="action-btn"><i class="fa fa-refresh" data-action="refresh"></i></button>'}}],fetchData:function(){var e=this,t=this.getViewModel();if(t){var n=t.get("entry"),a=t.get("widget.timeframe");"EVENT_LIST"===n.get("type")?e.fireEvent("afterdata"):(this.lookupReference("chart").fireEvent("beginfetchdata"),Rpc.getReportData(n.getData(),a).then(function(t){e.fireEvent("afterdata"),e.lookupReference("chart").fireEvent("setseries",t.list)},function(t){e.fireEvent("afterdata"),e.lookupReference("chart").lookupReference("loader").hide(),console.log(t),e.down("#exception")&&e.remove("exception"),e.add({xtype:"component",itemId:"exception",cls:"exception",scrollable:!0,html:'<h3><i class="material-icons">error</i> <span>'+"Widget error".t()+"</span></h3><p>"+"There was an issue while fetching data!".t()+"</p>"})}))}}}),Ext.define("Ung.view.dashboard.Dashboard",{extend:"Ext.container.Container",xtype:"ung.dashboard",itemId:"dashboard",requires:["Ung.view.dashboard.DashboardController","Ung.view.dashboard.Queue","Ung.widget.Report","Ung.view.grid.ActionColumn","Ung.widget.WidgetController","Ung.widget.Information","Ung.widget.Resources","Ung.widget.CpuLoad","Ung.widget.NetworkInformation","Ung.widget.NetworkLayout","Ung.widget.MapDistribution"],controller:"dashboard",viewModel:!0,config:{settings:null},layout:"border",defaults:{border:!1},items:[{region:"west",title:"Manage Widgets".t(),width:300,collapsible:!0,bodyBorder:!0,animCollapse:!1,collapsed:!0,titleCollapse:!0,floatable:!1,cls:"widget-manager",split:!0,xtype:"grid",reference:"dashboardNav",hideHeaders:!0,store:"widgets",bodyStyle:{border:0},viewConfig:{plugins:{ptype:"gridviewdragdrop",dragText:"Drag and drop to reorganize".t(),dragZone:{onBeforeDrag:function(e,t){return Ext.get(t.target).hasCls("drag-handle")}}},stripeRows:!1,getRowClass:function(e){return e.get("enabled")?"":"disabled"},listeners:{drop:"onDrop"}},columns:[{width:14,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,tdCls:"drag-handle"},{width:30,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,dataIndex:"enabled",renderer:"enableRenderer"},{dataIndex:"entryId",renderer:"widgetTitleRenderer",flex:1},{xtype:"actioncolumn",width:30,align:"center",sortable:!1,hideable:!1,resizable:!1,menuDisabled:!0,handler:"removeWidget",renderer:function(e,t,n){return'<i class="fa fa-times" style="color: #999; font-size: 20px;"></i>'}}],listeners:{itemmouseleave:"onItemLeave",cellclick:"onItemClick"},tbar:[{itemId:"addWidgetBtn",text:"Add".t(),iconCls:"fa fa-plus-circle"},"->",{text:"Import".t(),iconCls:"fa fa-download"},{text:"Export".t(),iconCls:"fa fa-upload"}],bbar:[{text:"Reset".t(),iconCls:"fa fa-rotate-left",handler:"resetDashboard"},"->",{text:"Apply".t(),iconCls:"fa fa-floppy-o",handler:"applyChanges"}]},{xtype:"container",region:"center",reference:"dashboard",cls:"dashboard",padding:8,scrollable:!0}],listeners:{showwidgeteditor:"showWidgetEditor"}}),Ext.define("Ung.view.main.Main",{extend:"Ext.panel.Panel",itemId:"main",requires:["Ung.view.main.MainController","Ung.view.main.MainModel","Ung.view.dashboard.Dashboard","Ung.view.apps.Apps","Ung.view.config.Config","Ung.view.reports.Reports"],controller:"main",viewModel:{type:"main"},layout:"card",border:!1,bind:{activeItem:"{activeItem}"},items:[{xtype:"ung.dashboard"},{xtype:"ung.apps"},{xtype:"ung.config"},{xtype:"ung.reports"},{},{}],dockedItems:[{xtype:"toolbar",ui:"navigation",dock:"top",border:!1,defaults:{xtype:"button",border:!1,enableToggle:!0,iconAlign:"top",hrefTarget:"_self"},items:[{html:'<img src="'+resourcesBaseHref+'/images/BrandingLogo.png" style="height: 40px;"/>',cls:"logo"},{text:"Dashboard".t(),iconCls:"fa fa-home",cls:"upper",href:"#",bind:{pressed:'{selectedNavItem === "dashboard"}'}},{text:"Apps".t(),iconCls:"fa fa-th",cls:"upper",bind:{href:"#apps/{policyId}",pressed:'{selectedNavItem === "apps"}'}},{text:"Config".t(),iconCls:"fa fa-sliders",cls:"upper",href:"#config",bind:{pressed:'{selectedNavItem === "config"}'}},{text:"Reports".t(),iconCls:"fa fa-line-chart",cls:"upper",href:"#reports",bind:{pressed:'{selectedNavItem === "reports"}'}},"->",{text:"Sessions".t(),iconCls:"fa fa-list",href:"#sessions",bind:{pressed:'{selectedNavItem === "sessions"}'}},{text:"Hosts".t(),iconCls:"fa fa-th-list",href:"#hosts",bind:{pressed:'{selectedNavItem === "hosts"}'}},{text:"Devices".t(),iconCls:"fa fa-desktop",href:"#devices",bind:{pressed:'{selectedNavItem === "devices"}'}},"-",{text:"Help".t(),iconCls:"fa fa-question-circle"},{text:"Account".t(),iconCls:"fa fa-user-circle"}]}]}),Ext.define("Ung.store.Metrics",{extend:"Ext.data.Store",storeId:"metrics",proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Hosts",{extend:"Ext.data.Store",storeId:"hosts",fields:[{name:"address",type:"string"}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Conditions",{extend:"Ext.data.Store",storeId:"conditions",fields:["name","displayName","type"],data:[{name:"DST_ADDR",displayName:"Destination Address".t(),editorType:"textfield",vtype:"ipall",visible:!0},{name:"DST_PORT",displayName:"Destination Port".t(),editorType:"textfield",vtype:"port",visible:!0},{name:"DST_INTF",displayName:"Destination Interface".t(),editorType:"checkgroup",visible:!0},{name:"SRC_ADDR",displayName:"Source Address".t(),editorType:"textfield",visible:!0,vtype:"ipall"},{name:"SRC_PORT",displayName:"Source Port".t(),editorType:"textfield",vtype:"portMatcher",visible:rpc.isExpertMode},{name:"SRC_INTF",displayName:"Source Interface".t(),editorType:"checkgroup",visible:!0},{name:"PROTOCOL",displayName:"Protocol".t(),editorType:"checkgroup",values:[["TCP","TCP"],["UDP","UDP"],["any","any"]],visible:!0},{name:"USERNAME",displayName:"Username".t(),editorType:"userselection",visible:!0},{name:"CLIENT_HOSTNAME",displayName:"Client Hostname".t(),editorType:"textfield",visible:!0},{name:"SERVER_HOSTNAME",displayName:"Server Hostname".t(),editorType:"textfield",visible:rpc.isExpertMode},{name:"SRC_MAC",displayName:"Client MAC Address".t(),editorType:"textfield",visible:!0},{name:"DST_MAC",displayName:"Server MAC Address".t(),editorType:"textfield",visible:!0},{name:"CLIENT_MAC_VENDOR",displayName:"Client MAC Vendor".t(),editorType:"textfield",visible:!0},{name:"SERVER_MAC_VENDOR",displayName:"Server MAC Vendor".t(),editorType:"textfield",visible:!0},{name:"CLIENT_IN_PENALTY_BOX",displayName:"Client in Penalty Box".t(),editorType:"boolean",visible:!0},{name:"SERVER_IN_PENALTY_BOX",displayName:"Server in Penalty Box".t(),editorType:"boolean",visible:!0},{name:"CLIENT_HAS_NO_QUOTA",displayName:"Client has no Quota".t(),editorType:"boolean",visible:!0},{name:"SERVER_HAS_NO_QUOTA",displayName:"Server has no Quota".t(),editorType:"boolean",visible:!0},{name:"CLIENT_QUOTA_EXCEEDED",displayName:"Client has exceeded Quota".t(),editorType:"boolean",visible:!0},{name:"SERVER_QUOTA_EXCEEDED",displayName:"Server has exceeded Quota".t(),editorType:"boolean",visible:!0},{name:"CLIENT_QUOTA_ATTAINMENT",displayName:"Client Quota Attainment".t(),editorType:"textfield",visible:!0},{name:"SERVER_QUOTA_ATTAINMENT",displayName:"Server Quota Attainment".t(),editorType:"textfield",visible:!0},{name:"HTTP_HOST",displayName:"HTTP: Hostname".t(),editorType:"textfield",visible:!0},{name:"HTTP_REFERER",displayName:"HTTP: Referer".t(),editorType:"textfield",visible:!0},{name:"HTTP_URI",displayName:"HTTP: URI".t(),editorType:"textfield",visible:!0},{name:"HTTP_URL",displayName:"HTTP: URL".t(),editorType:"textfield",visible:!0},{name:"HTTP_CONTENT_TYPE",displayName:"HTTP: Content Type".t(),editorType:"textfield",visible:!0},{name:"HTTP_CONTENT_LENGTH",displayName:"HTTP: Content Length".t(),editorType:"textfield",visible:!0},{name:"HTTP_USER_AGENT",displayName:"HTTP: Client User Agent".t(),editorType:"textfield",visible:!0},{name:"HTTP_USER_AGENT_OS",displayName:"HTTP: Client User OS".t(),editorType:"textfield",visible:!1},{name:"APPLICATION_CONTROL_APPLICATION",displayName:"Application Control: Application".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_CATEGORY",displayName:"Application Control: Application Category".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_PROTOCHAIN",displayName:"Application Control: Protochain".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_DETAIL",displayName:"Application Control: Detail".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_CONFIDENCE",displayName:"Application Control: Confidence".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_PRODUCTIVITY",displayName:"Application Control: Productivity".t(),editorType:"textfield",visible:!0},{name:"APPLICATION_CONTROL_RISK",displayName:"Application Control: Risk".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_SIGNATURE",displayName:"Application Control Lite: Signature".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_CATEGORY",displayName:"Application Control Lite: Category".t(),editorType:"textfield",visible:!0},{name:"PROTOCOL_CONTROL_DESCRIPTION",displayName:"Application Control Lite: Description".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_CATEGORY",displayName:"Web Filter: Category".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_CATEGORY_DESCRIPTION",displayName:"Web Filter: Category Description".t(),editorType:"textfield",visible:!0},{name:"WEB_FILTER_FLAGGED",displayName:"Web Filter: Website is Flagged".t(),editorType:"boolean",visible:!0},{name:"DIRECTORY_CONNECTOR_GROUP",displayName:"Directory Connector: User in Group".t(),type:"editor",visible:!0},{name:"CLIENT_COUNTRY",displayName:"Client Country".t(),editorType:"countryselector",visible:!0},{name:"SERVER_COUNTRY",displayName:"Server Country".t(),editorType:"countryselector",visible:!0}]}),Ext.define("Ung.store.Countries",{extend:"Ext.data.Store",storeId:"countries",data:[{code:"AF",name:"Afghanistan".t()},{code:"AX",name:"Aland Islands".t()},{code:"AL",name:"Albania".t()},{code:"DZ",name:"Algeria".t()},{code:"AS",name:"American Samoa".t()},{code:"AD",name:"Andorra".t()},{code:"AO",name:"Angola".t()},{code:"AI",name:"Anguilla".t()},{code:"AQ",name:"Antarctica".t()},{code:"AG",name:"Antigua and Barbuda".t()},{code:"AR",name:"Argentina".t()},{code:"AM",name:"Armenia".t()},{code:"AW",name:"Aruba".t()},{code:"AU",name:"Australia".t()},{code:"AT",name:"Austria".t()},{code:"AZ",name:"Azerbaijan".t()},{code:"BS",name:"Bahamas".t()},{code:"BH",name:"Bahrain".t()},{code:"BD",name:"Bangladesh".t()},{code:"BB",name:"Barbados".t()},{code:"BY",name:"Belarus".t()},{code:"BE",name:"Belgium".t()},{code:"BZ",name:"Belize".t()},{code:"BJ",name:"Benin".t()},{code:"BM",name:"Bermuda".t()},{code:"BT",name:"Bhutan".t()},{code:"BO",name:"Bolivia, Plurinational State of".t()},{code:"BQ",name:"Bonaire, Sint Eustatius and Saba".t()},{code:"BA",name:"Bosnia and Herzegovina".t()},{code:"BW",name:"Botswana".t()},{code:"BV",name:"Bouvet Island".t()},{code:"BR",name:"Brazil".t()},{code:"IO",name:"British Indian Ocean Territory".t()},{code:"BN",name:"Brunei Darussalam".t()},{code:"BG",name:"Bulgaria".t()},{code:"BF",name:"Burkina Faso".t()},{code:"BI",name:"Burundi".t()},{code:"KH",name:"Cambodia".t()},{code:"CM",name:"Cameroon".t()},{code:"CA",name:"Canada".t()},{code:"CV",name:"Cape Verde".t()},{code:"KY",name:"Cayman Islands".t()},{code:"CF",name:"Central African Republic".t()},{code:"TD",name:"Chad".t()},{code:"CL",name:"Chile".t()},{code:"CN",name:"China".t()},{code:"CX",name:"Christmas Island".t()},{code:"CC",name:"Cocos (Keeling) Islands".t()},{code:"CO",name:"Colombia".t()},{code:"KM",name:"Comoros".t()},{code:"CG",name:"Congo".t()},{code:"CD",name:"Congo, the Democratic Republic of the".t()},{code:"CK",name:"Cook Islands".t()},{code:"CR",name:"Costa Rica".t()},{code:"CI",name:"Cote d'Ivoire".t()},{code:"HR",name:"Croatia".t()},{code:"CU",name:"Cuba".t()},{code:"CW",name:"Curacao".t()},{code:"CY",name:"Cyprus".t()},{code:"CZ",name:"Czech Republic".t()},{code:"DK",name:"Denmark".t()},{code:"DJ",name:"Djibouti".t()},{code:"DM",name:"Dominica".t()},{code:"DO",name:"Dominican Republic".t()},{code:"EC",name:"Ecuador".t()},{code:"EG",name:"Egypt".t()},{code:"SV",name:"El Salvador".t()},{code:"GQ",name:"Equatorial Guinea".t()},{code:"ER",name:"Eritrea".t()},{code:"EE",name:"Estonia".t()},{code:"ET",name:"Ethiopia".t()},{code:"FK",name:"Falkland Islands (Malvinas)".t()},{code:"FO",name:"Faroe Islands".t()},{code:"FJ",name:"Fiji".t()},{code:"FI",name:"Finland".t()},{code:"FR",name:"France".t()},{code:"GF",name:"French Guiana".t()},{code:"PF",name:"French Polynesia".t()},{code:"TF",name:"French Southern Territories".t()},{code:"GA",name:"Gabon".t()},{code:"GM",name:"Gambia".t()},{code:"GE",name:"Georgia".t()},{code:"DE",name:"Germany".t()},{code:"GH",name:"Ghana".t()},{code:"GI",name:"Gibraltar".t()},{code:"GR",name:"Greece".t()},{code:"GL",name:"Greenland".t()},{code:"GD",name:"Grenada".t()},{code:"GP",name:"Guadeloupe".t()},{code:"GU",name:"Guam".t()},{code:"GT",name:"Guatemala".t()},{code:"GG",name:"Guernsey".t()},{code:"GN",name:"Guinea".t()},{code:"GW",name:"Guinea-Bissau".t()},{code:"GY",name:"Guyana".t()},{code:"HT",name:"Haiti".t()},{code:"HM",name:"Heard Island and McDonald Islands".t()},{code:"VA",name:"Holy See (Vatican City State)".t()},{code:"HN",name:"Honduras".t()},{code:"HK",name:"Hong Kong".t()},{code:"HU",name:"Hungary".t()},{code:"IS",name:"Iceland".t()},{code:"IN",name:"India".t()},{code:"ID",name:"Indonesia".t()},{code:"IR",name:"Iran, Islamic Republic of".t()},{code:"IQ",name:"Iraq".t()},{code:"IE",name:"Ireland".t()},{code:"IM",name:"Isle of Man".t()},{code:"IL",name:"Israel".t()},{code:"IT",name:"Italy".t()},{code:"JM",name:"Jamaica".t()},{code:"JP",name:"Japan".t()},{code:"JE",name:"Jersey".t()},{code:"JO",name:"Jordan".t()},{code:"KZ",name:"Kazakhstan".t()},{code:"KE",name:"Kenya".t()},{code:"KI",name:"Kiribati".t()},{code:"KP",name:"Korea, Democratic People's Republic of".t()},{code:"KR",name:"Korea, Republic of".t()},{code:"KW",name:"Kuwait".t()},{code:"KG",name:"Kyrgyzstan".t()},{code:"LA",name:"Lao People's Democratic Republic".t()},{code:"LV",name:"Latvia".t()},{code:"LB",name:"Lebanon".t()},{code:"LS",name:"Lesotho".t()},{code:"LR",name:"Liberia".t()},{code:"LY",name:"Libya".t()},{code:"LI",name:"Liechtenstein".t()},{code:"LT",name:"Lithuania".t()},{code:"LU",name:"Luxembourg".t()},{code:"MO",name:"Macao".t()},{code:"MK",name:"Macedonia, the Former Yugoslav Republic of".t()},{code:"MG",name:"Madagascar".t()},{code:"MW",name:"Malawi".t()},{code:"MY",name:"Malaysia".t()},{code:"MV",name:"Maldives".t()},{code:"ML",name:"Mali".t()},{code:"MT",name:"Malta".t()},{code:"MH",name:"Marshall Islands".t()},{code:"MQ",name:"Martinique".t()},{code:"MR",name:"Mauritania".t()},{code:"MU",name:"Mauritius".t()},{code:"YT",name:"Mayotte".t()},{code:"MX",name:"Mexico".t()},{code:"FM",name:"Micronesia, Federated States of".t()},{code:"MD",name:"Moldova, Republic of".t()},{code:"MC",name:"Monaco".t()},{code:"MN",name:"Mongolia".t()},{code:"ME",name:"Montenegro".t()},{code:"MS",name:"Montserrat".t()},{code:"MA",name:"Morocco".t()},{code:"MZ",name:"Mozambique".t()},{code:"MM",name:"Myanmar".t()},{code:"NA",name:"Namibia".t()},{code:"NR",name:"Nauru".t()},{code:"NP",name:"Nepal".t()},{code:"NL",name:"Netherlands".t()},{code:"NC",name:"New Caledonia".t()},{code:"NZ",name:"New Zealand".t()},{code:"NI",name:"Nicaragua".t()},{code:"NE",name:"Niger".t()},{code:"NG",name:"Nigeria".t()},{code:"NU",name:"Niue".t()},{code:"NF",name:"Norfolk Island".t()},{code:"MP",name:"Northern Mariana Islands".t()},{code:"NO",name:"Norway".t()},{code:"OM",name:"Oman".t()},{code:"PK",name:"Pakistan".t()},{code:"PW",name:"Palau".t()},{code:"PS",name:"Palestine, State of".t()},{code:"PA",name:"Panama".t()},{code:"PG",name:"Papua New Guinea".t()},{code:"PY",name:"Paraguay".t()},{code:"PE",name:"Peru".t()},{code:"PH",name:"Philippines".t()},{code:"PN",name:"Pitcairn".t()},{code:"PL",name:"Poland".t()},{code:"PT",name:"Portugal".t()},{code:"PR",name:"Puerto Rico".t()},{code:"QA",name:"Qatar".t()},{code:"RE",name:"Reunion".t()},{code:"RO",name:"Romania".t()},{code:"RU",name:"Russian Federation".t()},{code:"RW",name:"Rwanda".t()},{code:"BL",name:"Saint Barthelemy".t()},{code:"SH",name:"Saint Helena, Ascension and Tristan da Cunha".t()},{code:"KN",name:"Saint Kitts and Nevis".t()},{code:"LC",name:"Saint Lucia".t()},{code:"MF",name:"Saint Martin (French part)".t()},{code:"PM",name:"Saint Pierre and Miquelon".t()},{code:"VC",name:"Saint Vincent and the Grenadines".t()},{code:"WS",name:"Samoa".t()},{code:"SM",name:"San Marino".t()},{code:"ST",name:"Sao Tome and Principe".t()},{code:"SA",name:"Saudi Arabia".t()},{code:"SN",name:"Senegal".t()},{code:"RS",name:"Serbia".t()},{code:"SC",name:"Seychelles".t()},{code:"SL",name:"Sierra Leone".t()},{code:"SG",name:"Singapore".t()},{code:"SX",name:"Sint Maarten (Dutch part)".t()},{code:"SK",name:"Slovakia".t()},{code:"SI",name:"Slovenia".t()},{code:"SB",name:"Solomon Islands".t()},{code:"SO",name:"Somalia".t()},{code:"ZA",name:"South Africa".t()},{code:"GS",name:"South Georgia and the South Sandwich Islands".t()},{code:"SS",name:"South Sudan".t()},{code:"ES",name:"Spain".t()},{code:"LK",name:"Sri Lanka".t()},{code:"SD",name:"Sudan".t()},{code:"SR",name:"Suriname".t()},{code:"SJ",name:"Svalbard and Jan Mayen".t()},{code:"SZ",name:"Swaziland".t()},{code:"SE",name:"Sweden".t()},{code:"CH",name:"Switzerland".t()},{code:"SY",name:"Syrian Arab Republic".t()},{code:"TW",name:"Taiwan, Province of China".t()},{code:"TJ",name:"Tajikistan".t()},{code:"TZ",name:"Tanzania, United Republic of".t()},{code:"TH",name:"Thailand".t()},{code:"TL",name:"Timor-Leste".t()},{code:"TG",name:"Togo".t()},{code:"TK",name:"Tokelau".t()},{code:"TO",name:"Tonga".t()},{code:"TT",name:"Trinidad and Tobago".t()},{code:"TN",name:"Tunisia".t()},{code:"TR",name:"Turkey".t()},{code:"TM",name:"Turkmenistan".t()},{code:"TC",name:"Turks and Caicos Islands".t()},{code:"TV",name:"Tuvalu".t()},{code:"UG",name:"Uganda".t()},{code:"UA",name:"Ukraine".t()},{code:"AE",name:"United Arab Emirates".t()},{code:"GB",name:"United Kingdom".t()},{code:"US",name:"United States".t()},{code:"UM",name:"United States Minor Outlying Islands".t()},{code:"UY",name:"Uruguay".t()},{code:"UZ",name:"Uzbekistan".t()},{code:"VU",name:"Vanuatu".t()},{code:"VE",name:"Venezuela, Bolivarian Republic of".t()},{code:"VN",name:"Viet Nam".t()},{code:"VG",name:"Virgin Islands, British".t()},{code:"VI",name:"Virgin Islands, U.S.".t()},{code:"WF",name:"Wallis and Futuna".t()},{code:"EH",name:"Western Sahara".t()},{code:"YE",name:"Yemen".t()},{code:"ZM",name:"Zambia".t()},{code:"ZW",name:"Zimbabwe".t()}]}),Ext.define("Ung.store.UnavailableApps",{extend:"Ext.data.Store",storeId:"unavailableApps",alias:"store.unavailableApps",proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.model.Policy",{extend:"Ext.data.Model",fields:[{name:"policyId",type:"int"},{name:"displayName",type:"string",convert:function(e,t){return"Policy "+t.get("policyId")}}],hasMany:{model:"Ung.model.NodeProperty",name:"nodeProperties"},proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Policies",{extend:"Ext.data.Store",alias:"store.policies",storeId:"policies",model:"Ung.model.Policy"}),Ext.define("Ung.model.Stat",{extend:"Ext.data.Model",proxy:{type:"memory",reader:{type:"json"}},fields:["numCpus","cpuModel","MemFree","MemTotal","SwapFree","SwapTotal","freeDiskSpace","totalDiskSpace","uptime",{name:"hostname",calculate:function(){return rpc.hostname}},{name:"version",calculate:function(){return rpc.fullVersion}},{name:"appliance",calculate:function(){return void 0===rpc.applianceModel||null===rpc.applianceModel||""===rpc.applianceModel?"custom".t():rpc.applianceModel}},{name:"totalMemory",calculate:function(e){return Ung.Util.formatBytes(e.MemTotal,2)}},{name:"freeMemory",calculate:function(e){return Ung.Util.formatBytes(e.MemFree,2)}},{name:"freeMemoryPercent",calculate:function(e){return(e.MemFree/e.MemTotal*100).toFixed(1)}},{name:"usedMemory",calculate:function(e){return Ung.Util.formatBytes(e.MemTotal-e.MemFree,2)}},{name:"usedMemoryPercent",calculate:function(e){return(100*(1-e.MemFree/e.MemTotal)).toFixed(1)}},{name:"totalSwap",calculate:function(e){return Ung.Util.formatBytes(e.SwapTotal,2)}},{name:"freeSwap",calculate:function(e){return Ung.Util.formatBytes(e.SwapFree,2)}},{name:"freeSwapPercent",calculate:function(e){return(e.SwapFree/e.SwapTotal*100).toFixed(1)}},{name:"usedSwap",calculate:function(e){return Ung.Util.formatBytes(e.SwapTotal-e.SwapFree,2)}},{name:"usedSwapPercent",calculate:function(e){return(100*(1-e.SwapFree/e.SwapTotal)).toFixed(1)}},{name:"totalDisk",calculate:function(e){return Ung.Util.formatBytes(e.totalDiskSpace,2)}},{name:"freeDisk",calculate:function(e){return Ung.Util.formatBytes(e.freeDiskSpace,2)}},{name:"freeDiskPercent",calculate:function(e){return(e.freeDiskSpace/e.totalDiskSpace*100).toFixed(1)}},{name:"usedDisk",calculate:function(e){return Ung.Util.formatBytes(e.totalDiskSpace-e.freeDiskSpace,2)}},{name:"usedDiskPercent",calculate:function(e){return(100*(1-e.freeDiskSpace/e.totalDiskSpace)).toFixed(1)}},{name:"uptimeFormatted",calculate:function(e){var t=Math.floor(e.uptime%31536e3/86400),n=Math.floor(e.uptime%31536e3%86400/3600),a=Math.floor(e.uptime%31536e3%86400%3600/60),i="";return t>0&&(i+=t+"d "),n>0&&(i+=n+"h "),a>0&&(i+=a+"m"),i}}]}),Ext.define("Ung.store.Stats",{extend:"Ext.data.Store",alias:"store.stats",storeId:"stats",model:"Ung.model.Stat"}),Ext.define("Ung.model.Report",{extend:"Ext.data.Model",fields:["category","colors","conditions","defaultColumns","description","displayOrder","enabled","javaClass","orderByColumn","orderDesc","pieGroupColumn","pieNumSlices","pieStyle","pieSumColumn","readOnly","seriesRenderer","table","textColumns","textString","timeDataColumns","timeDataDynamicAggregationFunction","timeDataDynamicAllowNull","timeDataDynamicColumn","timeDataDynamicLimit","timeDataDynamicValue","timeDataInterval","timeStyle","title","type","uniqueId","units",{name:"icon",calculate:function(e){var t;switch(e.type){case"TEXT":t="fa-align-left";break;case"EVENT_LIST":t="fa-list-ul";break;case"PIE_GRAPH":t="fa-pie-chart","COLUMN"===e.pieStyle||"COLUMN_3D"===e.pieStyle?t="fa-bar-chart":"DONUT"!==e.pieStyle&&"DONUT_3D"!==e.pieStyle||(t="fa-pie-chart");break;case"TIME_GRAPH":case"TIME_GRAPH_DYNAMIC":t="fa-line-chart",e.timeStyle.indexOf("BAR")>=0?t="fa-bar-chart":e.timeStyle.indexOf("AREA")>=0&&(t="fa-area-chart");break;default:t="fa-align-left"}return t}}],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Reports",{extend:"Ext.data.Store",storeId:"reports",model:"Ung.model.Report",sorters:[{property:"displayOrder",direction:"ASC"}]}),Ext.define("Ung.model.Widget",{extend:"Ext.data.Model",fields:[{name:"displayColumns",type:"auto",default:null},{name:"enabled",type:"auto",default:!0},{name:"entryId",type:"auto",default:null},{name:"javaClass",type:"string",defaultValue:"com.untangle.uvm.DashboardWidgetSettings"},{name:"refreshIntervalSec",type:"auto",default:null},{name:"timeframe",type:"auto",default:null},{name:"type",type:"string"}],proxy:{type:"memory",reader:{type:"json",rootProperty:"list"}}}),Ext.define("Ung.store.Widgets",{extend:"Ext.data.Store",alias:"store.widgets",storeId:"widgets",model:"Ung.model.Widget"}),Ext.define("Ung.model.Session",{extend:"Ext.data.Model",fields:[{name:"protocol",type:"string"},{name:"clientKBps",type:"number",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"serverKBps",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"totalKBps",convert:function(e){return e?Math.round(1e3*e)/1e3:null}},{name:"clientIntf",convert:function(e){return!e||e<0?"":e}},{name:"serverIntf",convert:function(e){return!e||e<0?"":e}}],proxy:{autoLoad:!0,type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Sessions",{extend:"Ext.data.Store",storeId:"sessions",model:"Ung.model.Session"}),Ext.define("Ung.model.Category",{extend:"Ext.data.Model",fields:[{name:"name",type:"string"},{name:"displayName",type:"string"},{name:"icon",type:"string"}],proxy:{type:"memory",reader:{type:"json"}}}),Ext.define("Ung.store.Categories",{extend:"Ext.data.Store",storeId:"categories",model:"Ung.model.Category"}),Ext.define("Ung.controller.Global",{extend:"Ext.app.Controller",namespace:"Ung",requires:["Ung.rpc.Rpc","Ung.util.Util","Ung.util.Metrics","Ung.view.main.Main","Ung.overrides.form.field.VTypes","Ung.view.shd.Sessions","Ung.view.shd.Hosts","Ung.view.shd.Devices","Ung.config.network.Network"],stores:["Policies","Metrics","Stats","Reports","Widgets","Sessions","Hosts","Conditions","Countries","Categories","UnavailableApps","Rule"],config:{control:{"#main":{beforerender:"onBeforeRender"},"#apps":{activate:"onActivate"}},refs:{mainView:"#main",dashboardView:"#dashboard",appsView:"#apps",reportsView:"#reports"},routes:{"":"onDashboard","apps/:policyId":"onApps","apps/:policyId/:node":"onApps",config:"onConfig","config/:configName":"onConfig",reports:"onReports","reports/:category":"onReports","reports/:category/:entry":"onReports",sessions:"onSessions",hosts:"onHosts",devices:"onDevices"},reportsEnabled:!0},onBeforeRender:function(){},onActivate:function(){console.log("activate")},onDashboard:function(){this.getMainView().setActiveItem("dashboard"),this.getMainView().getViewModel().set("selectedNavItem","dashboard")},onApps:function(e,t){console.log(t),this.getMainView().getViewModel().set("selectedNavItem","apps"),this.getMainView().setActiveItem("apps"),t?"install"===t&&(console.log(this.getAppsView()),this.getAppsView().setActiveItem("installableApps")):this.getAppsView().setActiveItem("installedApps")},onConfig:function(e){var t=this;e?(t.getMainView().setLoading(!0),Ext.Loader.loadScript({url:"root/script/config/"+e+".js",onLoad:function(){t.getMainView().setLoading(!1),t.getMainView().add({xtype:"ung.config."+e,region:"center",itemId:"configCard"}),t.getMainView().setActiveItem("configCard")}})):(this.getMainView().getViewModel().set("selectedNavItem","config"),this.getMainView().setActiveItem("config"))},onReports:function(e){
e?this.getReportsView().getViewModel().set("category",e.replace(/-/g," ")):this.getReportsView().getViewModel().set("category",null),this.getMainView().getViewModel().set("selectedNavItem","reports"),this.getMainView().setActiveItem("reports")},onSessions:function(){this.getMainView().add({xtype:"ung.sessions",itemId:"sessions"}),this.getMainView().getViewModel().set("selectedNavItem","sessions"),this.getMainView().setActiveItem("sessions")},onHosts:function(){this.getMainView().add({xtype:"ung.hosts",itemId:"hosts"}),this.getMainView().getViewModel().set("selectedNavItem","hosts"),this.getMainView().setActiveItem("hosts")},onDevices:function(){this.getMainView().add({xtype:"ung.devices",itemId:"devices"}),this.getMainView().getViewModel().set("selectedNavItem","devices"),this.getMainView().setActiveItem("devices")}}),Ext.define("Ung.Application",{extend:"Ext.app.Application",namespace:"Ung",autoCreateViewport:!1,name:"Ung",rpc:null,controllers:["Global"],defaultToken:"",mainView:"Ung.view.main.Main",init:function(){console.timeEnd("resources")},launch:function(){var e=this;Rpc.rpc=e.rpc,Ext.getStore("policies").loadData(e.rpc.appsViews),Ung.util.Metrics.start(),Ext.get("app-loader").destroy(),Ext.Deferred.parallel([Rpc.getDashboardSettings,Rpc.getReports,Rpc.getUnavailableApps]).then(function(e){Ung.dashboardSettings=e[0],Ext.getStore("widgets").loadData(e[0].widgets.list),e[1]&&Ext.getStore("reports").loadData(e[1].list),e[2]&&Ext.getStore("unavailableApps").loadRawData(e[2].map),Ext.fireEvent("init")},function(e){console.log(e)})},loadMainView:function(){Ung.util.Metrics.start();try{Ung.app.setMainView("Ung.view.main.Main")}catch(e){return console.error(e),void Ung.Util.exceptionToast(e)}}});